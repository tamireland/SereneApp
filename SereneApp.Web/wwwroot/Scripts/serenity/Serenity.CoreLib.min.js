var __decorate=this&&this.__decorate||function(t,e,i,r){var n=arguments.length,a=n<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r,o;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(t,e,i,r);else for(var l=t.length-1;l>=0;l--)if(o=t[l])a=(n<3?o(a):n>3?o(e,i,a):o(e,i))||a;return n>3&&a&&Object.defineProperty(e,i,a),a};var __skipExtends={__metadata:true,__typeName:true,__componentFactory:true};var __extends=this&&this.__extends||function(t,e){for(var i in e)if(e.hasOwnProperty(i)&&__skipExtends[i]!==true)t[i]=e[i];function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)};var __assign=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++){e=arguments[i];for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n))t[n]=e[n]}return t};var __rest=function(t,e){var i={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0)i[r]=t[r];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var n=0,r=Object.getOwnPropertySymbols(t);n<r.length;n++)if(e.indexOf(r[n])<0)i[r[n]]=t[r[n]];return i};if(typeof Promise==="undefined"){if(typeof RSVP!=="undefined"){Promise=RSVP}else if(typeof jQuery!=="undefined"){Promise=$.Deferred;Promise.resolve=function(t){return jQuery.Deferred().resolveWith(t)}}}ss.initAssembly({},"App",{});var Q;(function(t){function e(t,e){return ss.coalesce(t,e)}t.coalesce=e;function i(t){return ss.isValue(t)}t.isValue=i;function r(t,e){for(var i=0,r=t;i<r.length;i++){var n=r[i];if(e(n))return true}return false}t.any=r;function n(t,e){var i=0;for(var r=0,n=t;r<n.length;r++){var a=n[r];if(e(a))i++}return i}t.count=n;function a(t,e){for(var i=0,r=t;i<r.length;i++){var n=r[i];if(e(n))return n}throw new Error("first:No element satisfies the condition.!")}t.first=a;function o(t,e){for(var i=0;i<t.length;i++)if(e(t[i]))return i;return-1}t.indexOf=o;function l(t,e,i){ss.insert(t,e,i)}t.insert=l;function s(t){return ss.isArray(t)}t.isArray=s;function u(t,e){var i;var r=false;for(var n=0,a=t;n<a.length;n++){var o=a[n];if(e(o)){if(r)throw new Error("single:sequence contains more than one element.");r=true;i=o}}if(!r)throw new Error("single:No element satisfies the condition.");return i}t.single=u;function c(t,e){var i={};for(var r=0,n=t;r<n.length;r++){var a=n[r];var o=e(a)||"";var l=i[o];if(!l){l=i[o]=[]}l.push(a)}return i}t.toGrouping=c;function d(e,i){var r={byKey:Object.create(null),inOrder:[]};for(var n=0;n<e.length;n++){var a=e[n];var o=t.coalesce(i(a),"");var l=r.byKey[o];if(l===undefined){l={order:r.inOrder.length,key:o,items:[a],start:n};r.byKey[o]=l;r.inOrder.push(l)}else{l.items.push(a)}}return r}t.groupBy=d;function f(t,e){for(var i=0,r=t;i<r.length;i++){var n=r[i];if(e(n))return n}}t.tryFirst=f;function p(t,e){return ss.endsWithString(t,e)}t.endsWith=p;function h(t){return t==null||t.length===0}t.isEmptyOrNull=h;function g(t){return x(t)==null}t.isTrimmedEmpty=g;function v(t){var e;var i=[];for(var r=1;r<arguments.length;r++){i[r-1]=arguments[r]}return(e=ss).formatString.apply(e,[t].concat(i))}t.format=v;function y(t,e,i){if(i===void 0){i=" "}while(t.length<e)t="0"+t;return t}t.padLeft=y;function m(t,e){return ss.startsWithString(t,e)}t.startsWith=m;function b(e){return t.replaceAll(t.replaceAll(_(e),"\r\n"," "),"\n"," ").trim()}t.toSingleLine=b;function C(t){return(t==null?"":t).replace(new RegExp("^\\s+|\\s+$","g"),"")}t.trim=C;function _(t){if(t==null||t.length===0){return""}return C(t)}t.trimToEmpty=_;function x(t){if(t==null||t.length===0){return null}t=C(t);if(t.length===0){return null}else{return t}}t.trimToNull=x;var S;function w(t,e){var i="AaBbCcÇçFfGgĞğHhIıİiJjKkLlMmNnOoÖöPpRrSsŞşTtUuÜüVvYyZz";t=t||"";e=e||"";if(t==e)return 0;if(!S){S={};for(var r=0;r<i.length;r++){S[i.charAt(r)]=r+1}}for(var n=0,a=Math.min(t.length,e.length);n<a;n++){var o=t.charAt(n),l=e.charAt(n);if(o===l)continue;var s=S[o],u=S[l];if(s!=null&&u!=null)return s<u?-1:1;var c=o.localeCompare(l);if(c==0)continue;return c}return t.localeCompare(e)}t.turkishLocaleCompare=w;function T(t){if(!t)return t;return t.replace(/i/g,"İ").replace(/ı/g,"I").toUpperCase()}t.turkishLocaleToUpper=T;function I(t,e,i){return ss.replaceAllString(t,e,i)}t.replaceAll=I;function k(t,e){var i=t.toString();while(i.length<e)i="0"+i;return i}t.zeroPad=k;function F(t,e,i){var r,n,a,o,l;if(null==e)e=100;function s(){var u=Date.now()-o;if(u<e&&u>=0){r=setTimeout(s,e-u)}else{r=null;if(!i){l=t.apply(a,n);a=n=null}}}var u=function(){a=this;n=arguments;o=Date.now();var u=i&&!r;if(!r)r=setTimeout(s,e);if(u){l=t.apply(a,n);a=n=null}return l};u.clear=function(){if(r){clearTimeout(r);r=null}};u.flush=function(){if(r){l=t.apply(a,n);a=n=null;clearTimeout(r);r=null}};return u}t.debounce=F;function Q(t){var e=[];for(var i=1;i<arguments.length;i++){e[i-1]=arguments[i]}var r,n,a,o,l,s,u=arguments[0]||{},c=1,d=arguments.length;if(typeof u!=="object"&&!$.isFunction(u)){u={}}if(c===d){u={};c=0}for(;c<d;c++){if((r=arguments[c])!==null){if($.isArray(r)){u=$.extend(true,[],r)}else{for(n in r){a=u[n];o=r[n];if(u===o){continue}if(o&&($.isPlainObject(o)||(l=$.isArray(o)))){if(l){l=false;s=a&&$.isArray(a)?a:[]}else{s=a&&$.isPlainObject(a)?a:{}}u[n]=Q(s,o)}else if(o!==undefined){u[n]=o}}}}}return u}t.deepClone=Q})(Q||(Q={}));var Q;(function(t){var e;(function(e){e.decimalSeparator=".";e.dateSeparator="/";e.dateOrder="dmy";e.dateFormat="dd/MM/yyyy";e.dateTimeFormat="dd/MM/yyyy HH:mm:ss";function i(){return e.decimalSeparator===","?".":","}e.get_groupSeparator=i;var r=t.trimToNull($("script#ScriptCulture").html());if(r!=null){var n=$.parseJSON(r);if(n.DecimalSeparator!=null)e.decimalSeparator=n.DecimalSeparator;if(n.DateSeparator!=null)e.dateSeparator=n.DateSeparator;if(n.DateOrder!=null)e.dateOrder=n.DateOrder;if(n.DateFormat!=null)e.dateFormat=n.DateFormat;if(n.DateTimeFormat!=null)e.dateTimeFormat=n.DateTimeFormat}})(e=t.Culture||(t.Culture={}));function i(t,i,r,n){var o="-";if(isNaN(t)){return null}r=r||e.decimalSeparator;n=n||e.get_groupSeparator();var l="";if(i.indexOf(".")>-1){var s=r;var u=i.substring(i.lastIndexOf(".")+1);t=a(t,u.length);var c=t%1;var d=new String(c.toFixed(u.length));d=d.substring(d.lastIndexOf(".")+1);for(var f=0;f<u.length;f++){if(u.charAt(f)=="#"&&d.charAt(f)!="0"){s+=d.charAt(f);continue}else if(u.charAt(f)=="#"&&d.charAt(f)=="0"){var p=d.substring(f);if(p.match("[1-9]")){s+=d.charAt(f);continue}else break}else if(u.charAt(f)=="0")s+=d.charAt(f);else s+=u.charAt(f)}l+=s}else t=Math.round(t);var h=Math.floor(t);if(t<0)h=Math.ceil(t);var g="";if(i.indexOf(".")==-1)g=i;else g=i.substring(0,i.indexOf("."));var v="";if(!(h==0&&g.substr(g.length-1)=="#")){var y=new String(Math.abs(h));var m=9999;if(g.lastIndexOf(",")!=-1)m=g.length-g.lastIndexOf(",")-1;var b=0;for(var f=y.length-1;f>-1;f--){v=y.charAt(f)+v;b++;if(b==m&&f!=0){v=n+v;b=0}}if(g.length>v.length){var C=g.indexOf("0");if(C!=-1){var _=g.length-C;var x=g.length-v.length-1;while(v.length<_){var S=g.charAt(x);if(S==",")S=n;v=S+v;x--}}}}if(!v&&g.indexOf("0",g.length-1)!==-1)v="0";l=v+l;if(t<0)l=o+l;if(l.lastIndexOf(r)==l.length-1){l=l.substring(0,l.length-1)}return l}t.formatNumber=i;function r(i){i=t.trim(i.toString());var r=e.get_groupSeparator();if(i&&i.length&&i.indexOf(r)>0){i=i.replace(new RegExp("(\\b\\d{1,3})\\"+r+"(?=\\d{3}(\\D|$))","g"),"$1")}if(!/^[-\+]?\d+$/.test(i))return NaN;return parseInt(i,10)}t.parseInteger=r;function n(i){if(i==null)return null;i=t.trim(i.toString());if(i.length==0)return null;var r=e.get_groupSeparator();if(i&&i.length&&i.indexOf(r)>0){i=i.replace(new RegExp("(\\b\\d{1,3})\\"+r+"(?=\\d{3}(\\D|$))","g"),"$1")}if(!new RegExp("^\\s*([-\\+])?(\\d*)\\"+e.decimalSeparator+"?(\\d*)\\s*$").test(i))return NaN;return parseFloat(i.toString().replace(e.decimalSeparator,"."))}t.parseDecimal=n;function a(t,e){var i=Math.pow(10,e||0);var r=(Math.round(t*i)/i).toString();if(e>0){var n=r.indexOf(".");if(n==-1){r+=".";n=0}else{n=r.length-(n+1)}while(n<e){r+="0";n++}}return parseFloat(r)}function o(t){if(t==null)return null;if(typeof t=="number")return t;t=$.trim(t);if(t==null||!t.length)return null;if(t.length>=15||!/^-?\d+$/.test(t))return t;var e=parseInt(t,10);if(isNaN(e))return t;return e}t.toId=o;function l(i,r){if(!i){return""}var n;if(typeof i=="string"){var a=t.parseDate(i);if(!a)return i;n=a}else n=i;if(r==null||r=="d"){r=e.dateFormat}else{switch(r){case"g":r=e.dateTimeFormat.replace(":ss","");break;case"G":r=e.dateTimeFormat;break;case"s":r="yyyy-MM-ddTHH:mm:ss";break;case"u":return t.formatISODateTimeUTC(n)}}var o=function(e){return t.zeroPad(e,2)};return r.replace(new RegExp("dd?|MM?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|fff|zz?z?|\\/","g"),function(i){switch(i){case"/":return e.dateSeparator;case"hh":return o(n.getHours()<13?n.getHours():n.getHours()-12);case"h":return n.getHours()<13?n.getHours():n.getHours()-12;case"HH":return o(n.getHours());case"H":return n.getHours();case"mm":return o(n.getMinutes());case"m":return n.getMinutes();case"ss":return o(n.getSeconds());case"s":return n.getSeconds();case"yyyy":return n.getFullYear();case"yy":return n.getFullYear().toString().substr(2,4);case"dd":return o(n.getDate());case"d":return n.getDate().toString();case"MM":return o(n.getMonth()+1);case"M":return n.getMonth()+1;case"t":return n.getHours()<12?"A":"P";case"tt":return n.getHours()<12?"AM":"PM";case"fff":return t.zeroPad(n.getMilliseconds(),3);case"zzz":case"zz":case"z":return"";default:return i}})}t.formatDate=l;function s(e){if(e===0)return"0";else if(!e)return"";var i=Math.floor(e/24/60);var r="";if(i>0){r+=i.toString()}var n=t.zeroPad(Math.floor(e%(24*60)/60),2)+":"+t.zeroPad(e%60,2);if(n!="00:00"){if(i>0)r+=".";r+=n}return r}t.formatDayHourAndMin=s;function u(t){if(t==null)return"";var e=function(t){return(t<10?"0":"")+t};var i=t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes());var r=Number(t.getUTCSeconds()+"."+(t.getUTCMilliseconds()<100?"0":"")+e(t.getUTCMilliseconds()));i+=":"+e(r)+"Z";return i}t.formatISODateTimeUTC=u;var c=/(\d{4,})(?:-(\d{1,2})(?:-(\d{1,2})(?:[T ](\d{1,2}):(\d{1,2})(?::(\d{1,2})(?:\.(\d+))?)?(?:(Z)|([+-])(\d{1,2})(?::(\d{1,2}))?)?)?)?)?/;function d(t){if(!t||!t.length)return null;t=t+"";if(typeof t!="string"||t.length===0){return null}var e=t.match(c);if(typeof e=="undefined"||e===null){return null}var i,r,n,a,o,l,s;i=parseInt(e[1],10);if(typeof e[2]=="undefined"||e[2]===""){return new Date(i)}r=parseInt(e[2],10)-1;n=parseInt(e[3],10);if(typeof e[4]=="undefined"||e[4]===""){return new Date(i,r,n)}a=parseInt(e[4],10);o=parseInt(e[5],10);l=typeof e[6]!="undefined"&&e[6]!==""?parseInt(e[6],10):0;if(typeof e[7]!="undefined"&&e[7]!==""){s=Math.round(1e3*parseFloat("0."+e[7]))}else{s=0}if((typeof e[8]=="undefined"||e[8]==="")&&(typeof e[9]=="undefined"||e[9]==="")){return new Date(i,r,n,a,o,l,s)}var u;if(typeof e[9]!="undefined"&&e[9]!==""){u=parseInt(e[10],10)*36e5;if(typeof e[11]!="undefined"&&e[11]!==""){u+=parseInt(e[11],10)*6e4}if(e[9]=="-"){u=-u}}else{u=0}return new Date(Date.UTC(i,r,n,a,o,l,s)-u)}t.parseISODateTime=d;function f(e){var i=t.trim(e);if(i.length<4||i.length>5)return NaN;var n,a;if(i.charAt(1)==":"){n=r(i.substr(0,1));a=r(i.substr(2,2))}else{if(i.charAt(2)!=":")return NaN;n=r(i.substr(0,2));a=r(i.substr(3,2))}if(isNaN(n)||isNaN(a)||n<0||n>23||a<0||a>59)return NaN;return n*60+a}t.parseHourAndMin=f;function p(e){var i;var n=t.trim(e);if(!n)return NaN;var a=n.split(".");if(a.length==0||a.length>2)return NaN;if(a.length==1){i=r(a[0]);if(!isNaN(i))return i*24*60;return f(a[0])}else{i=r(a[0]);var o=f(a[1]);if(isNaN(i)||isNaN(o))return NaN;return i*24*60+o}}t.parseDayHourAndMin=p;function h(i,r){if(!i||!i.length)return null;if(i.length>=10&&i.charAt(4)==="-"&&i.charAt(7)==="-"&&(i.length===10||i.length>10&&i.charAt(10)==="T")){var n=t.parseISODateTime(i);if(n==null)return false;return n}var a;var o;var l,s,u;o=g(i);if(!o)return false;if(o.length==3){r=r||e.dateOrder;switch(r){case"dmy":l=parseInt(o[0],10);s=parseInt(o[1],10)-1;u=parseInt(o[2],10);break;case"ymd":l=parseInt(o[2],10);s=parseInt(o[1],10)-1;u=parseInt(o[0],10);break;case"mdy":default:l=parseInt(o[1],10);s=parseInt(o[0],10)-1;u=parseInt(o[2],10);break}if(isNaN(l)||isNaN(s)||isNaN(u)||l<1||l>31||s<0||s>11||u>9999||u<0)return false;if(u<100){var c=(new Date).getFullYear();var d=c%100+10;u+=c-c%100+(u<=d?0:-100)}try{a=new Date(u,s,l);if(isNaN(a.getFullYear()))return false}catch(f){return false}}else if(o.length==1){try{a=new Date(o[0]);if(isNaN(a.getFullYear()))return false}catch(f){return false}}return a}t.parseDate=h;function g(e){e=t.trim(e);if(!e.length)return;if(e.indexOf("/")>=0)return e.split("/");else if(e.indexOf(".")>=0)return e.split(".");else if(e.indexOf("-")>=0)return e.split("-");else if(e.indexOf("\\")>=0)return e.split("\\");else return[e]}t.splitDateString=g})(Q||(Q={}));var Q;(function(t){function e(t){var e=l.$table[t];if(e==null){e=t||""}return e}t.text=e;function i(t){return function(i){return e("Db."+t+"."+i)}}t.dbText=i;function r(e){return function(i,r){if(i!=null&&!t.startsWith(i,"`")){var n=t.tryGetText(i);if(n!=null){return n}}if(i!=null&&t.startsWith(i,"`")){i=i.substr(1)}if(!t.isEmptyOrNull(e)){var a=typeof r=="function"?r(e):e+r;var o=t.tryGetText(a);if(o!=null){return o}}return i}}t.prefixedText=r;function n(t){return l.$table[t]}t.tryGetText=n;function a(t){return function(i){return e("Db."+t+"."+i)}}t.dbTryText=a;function o(e,i,r){if(typeof window!="undefined"&&window["Proxy"]){return new window["Proxy"](e,{get:function(n,a){var l=r[a];if(l==null)return;if(typeof l=="number")return t.text(i+a);else{var s=e[a];if(s!=null)return s;e[a]=s=o({},i+a+".",l);return s}},ownKeys:function(t){return Object.keys(r)}})}else{for(var n=0,a=Object.keys(r);n<a.length;n++){var l=a[n];if(typeof r[l]=="number")Object.defineProperty(e,l,{get:function(){return t.text(i+l)}});else e[l]=o({},i+l+".",r[l])}return e}}t.proxyTexts=o;var l=function(){function t(t){this.key=t}t.add=function(e,i){if(!e){return}i=i||"";for(var r=0,n=Object.keys(e);r<n.length;r++){var a=n[r];var o=i+a;var l=e[a];if(typeof l==="object"){t.add(l,o+".")}else{t.$table[o]=l}}};t.prototype.get=function(){var e=t.$table[this.key];if(e==null){e=this.key||""}return e};t.prototype.toString=function(){var e=t.$table[this.key];if(e==null){e=this.key||""}return e};t.$table={};t.empty=new t("");t.initializeTextClass=function(e,i){var r=Object.keys(e).slice();for(var n=0;n<r.length;n++){var a=r[n];var o=e[a];if(o instanceof t){var l=o;var s=i+a;t.$table[s]=l.key;e[a]=new t(s)}}};t.getDefault=function(e,i){var r=t.$table[e];if(r==null){r=i;if(r==null){r=e||""}}return r};return t}();t.LT=l})(Q||(Q={}));var Q;(function(t){var e=function(){function e(t,e){this.items=[];this.itemById={};t=t||{};this.textFormatter=t.textFormatter;this.idField=t.idField;this.parentIdField=t.parentIdField;this.textField=t.textField;this.textFormatter=t.textFormatter;if(e!=null)this.update(e)}e.prototype.update=function(e){this.items=[];this.itemById={};if(e){for(var i=0,r=e;i<r.length;i++){var n=r[i];this.items.push(n)}}var a=this.idField;if(!t.isEmptyOrNull(a)){for(var o=0,l=this.items;o<l.length;o++){var s=l[o];var u=s[a];if(u!=null){this.itemById[u]=s}}}};e.prototype.get_idField=function(){return this.idField};e.prototype.get_parentIdField=function(){return this.parentIdField};e.prototype.get_textField=function(){return this.textField};e.prototype.get_textFormatter=function(){return this.textFormatter};e.prototype.get_itemById=function(){return this.itemById};e.prototype.get_items=function(){return this.items};return e}();t.Lookup=e})(Q||(Q={}));var Q;(function(t){var e=0;function i(t){if(e>0){e++;return}$.blockUI(t);e++}function r(t){t=$.extend({baseZ:2e3,message:"",overlayCSS:{opacity:"0.0",zIndex:2e3,cursor:"wait"},fadeOut:0},t);if(t.useTimeout){window.setTimeout(function(){i(t)},0)}else{i(t)}}t.blockUI=r;function n(){if(e>1){e--;return}e--;$.unblockUI({fadeOut:0})}t.blockUndo=n})(Q||(Q={}));var Q;(function(t){function e(t,e,i){$("<option/>").val(e).text(i).appendTo(t)}t.addOption=e;function i(i){e(i,"",t.text("Controls.SelectEditor.EmptyItemText"))}t.addEmptyOption=i;function r(t){t.html("")}t.clearOptions=r;function n(e,i){var r=e.attr("id");if(t.isEmptyOrNull(r)){return $("#"+i)}var n=$("#"+r+i);if(n.length>0){return n}n=$("#"+r+"_"+i);if(n.length>0){return n}while(true){var a=r.lastIndexOf("_");if(a<=0){return $("#"+i)}r=r.substr(0,a);n=$("#"+r+"_"+i);if(n.length>0){return n}}}t.findElementWithRelativeId=n;function a(t){switch(t){case"&":return"&amp;";case">":return"&gt;";case"<":return"&lt;";case"'":return"&apos;";case'"':return"&quot;"}return t}var o=/[><&'"]/g;function l(t){var e=t==null?"":t.toString();if(o.test(e)){return e.replace(o,a)}return e}t.attrEncode=l;function s(t){switch(t){case"&":return"&amp;";case">":return"&gt;";case"<":return"&lt;"}return t}function u(t){var e=t==null?"":t.toString();if(new RegExp("[><&]","g").test(e)){return e.replace(new RegExp("[><&]","g"),s)}return e}t.htmlEncode=u;function c(e,i){if(!e||e.indexOf("{{")<0){return e}if(!$.templates||!$.views){throw new ss.Exception("Please make sure that jsrender.js is included in the page!")}i=i||{};var r=$.templates(e);$.views.converters({text:t.text},r);return r.render(i)}t.jsRender=c;function d(t){window.console&&window.console.log(t)}t.log=d;function f(){return $("<div/>").appendTo(document.body)}t.newBodyDiv=f;function p(t){return $("<i/>").append(t.eq(0).clone()).html()}t.outerHtml=p})(Q||(Q={}));var Q;(function(t){function e(e,i){var r;i=$.extend({htmlEncode:true,okButton:t.text("Dialogs.OkButton"),title:t.text("Dialogs.AlertTitle"),onClose:null,onOpen:null,autoOpen:false,dialogClass:"s-MessageDialog s-AlertDialog",modal:true,width:"40%",maxWidth:"450",minWidth:"180",resizable:false,open:function(){if(i.onOpen)i.onOpen.call(this)},close:function(){r.dialog("destroy");if(i.onClose)i.onClose()}},i);if(i.htmlEncode)e=t.htmlEncode(e);if(!i.buttons){var n=[];n.push({text:i.okButton,click:function(){r.dialog("close")}});i.buttons=n}r=$('<div><div class="message"></div></div>').dialog(i).children(".message").html(e).parent().dialog("open")}t.alert=e;function i(e,i,r){var n;r=$.extend({htmlEncode:true,yesButton:t.text("Dialogs.YesButton"),noButton:t.text("Dialogs.NoButton"),title:t.text("Dialogs.ConfirmationTitle"),onNo:null,onCancel:null,onClose:null,autoOpen:false,modal:true,dialogClass:"s-MessageDialog s-ConfirmDialog",width:"40%",maxWidth:"450",minWidth:"180",resizable:false,open:function(){if(r.onOpen)r.onOpen.call(this)},close:function(){n.dialog("destroy");if(!a&&r.onCancel)r.onCancel()},overlay:{opacity:.77,background:"black"}},r);if(r.htmlEncode)e=t.htmlEncode(e);var a=false;if(!r.buttons){var o=[];o.push({text:r.yesButton,click:function(){a=true;n.dialog("close");if(i)i()}});if(r.noButton)o.push({text:r.noButton,click:function(){a=true;n.dialog("close");if(r.onNo)r.onNo();else if(r.onCancel)r.onCancel()}});r.buttons=o}n=$('<div><div class="message"></div></div>').dialog(r).children(".message").html(e).parent().dialog("open")}t.confirm=i;function r(e){var i;var r=$('<div style="overflow: hidden"><iframe></iframe></div>');var n=$.extend({autoOpen:true,modal:true,width:"60%",height:"400",title:t.text("Dialogs.AlertTitle"),open:function(){i=r.find("iframe").css({border:"none",width:"100%",height:"100%"})[0].contentDocument;i.open();i.write(n.html);i.close()},close:function(){i.open();i.write("");i.close();r.dialog("destroy").html("")}},e);r.dialog(n)}t.iframeDialog=r;function n(e,r,n){i(e,r,$.extend({title:t.text("Dialogs.InformationTitle"),dialogClass:"s-MessageDialog s-InformationDialog",yesButton:t.text("Dialogs.OkButton"),noButton:null},n))}t.information=n;function a(i,r){e(i,$.extend({title:t.text("Dialogs.WarningTitle"),dialogClass:"s-MessageDialog s-WarningDialog"},r))}t.warning=a})(Q||(Q={}));var Q;(function(t){t.defaultNotifyOptions={timeOut:3e3,showDuration:250,hideDuration:500,extendedTimeOut:500,positionClass:"toast-top-full-width"};function e(e){e=$.extend({},t.defaultNotifyOptions,e);o(true);return e}function i(t,i,r){toastr.warning(t,i,e(r))}t.notifyWarning=i;function r(t,i,r){toastr.success(t,i,e(r))}t.notifySuccess=r;function n(t,i,r){toastr.info(t,i,e(r))}t.notifyInfo=n;function a(t,i,r){toastr.error(t,i,e(r))}t.notifyError=a;function o(t){if(typeof toastr==="undefined"){return}var e=$(window.document.body).children(".ui-dialog:visible").last();var i=toastr.getContainer(null,t);if(i.length===0){return}if(e.length>0){var r=e.position();i.addClass("positioned-toast toast-top-full-width");i.css({position:"absolute",top:r.top+28+"px",left:r.left+6+"px",width:e.width()-12+"px"})}else{i.addClass("toast-top-full-width");if(i.hasClass("positioned-toast")){i.removeClass("positioned-toast");i.css({position:"",top:"",left:"",width:""})}}}t.positionToastContainer=o})(Q||(Q={}));var Q;(function(t){var e;(function(e){function i(e){var i;if(e==null){i="??ERROR??"}else{i=e.Message;if(i==null){i=e.Code}}t.alert(i)}e.showServiceError=i;function r(e,i,r,n,a){try{var o=(window.location.host||"").toLowerCase();if(o.indexOf("localhost")<0&&o.indexOf("127.0.0.1")<0)return;if(!window["toastr"])return;var l=JSON.stringify(a||{});e="<p></p><p>Message: "+t.htmlEncode(e)+"</p><p>File: "+t.htmlEncode(i)+", Line: "+r+", Column: "+n+(l!="{}"?"</p><p>Error: ":"")+"</p>";window.setTimeout(function(){try{t.notifyError(e,"SCRIPT ERROR! See browser console (F12) for details.",{escapeHtml:false,timeOut:15e3})}catch(i){}})}catch(s){}}e.runtimeErrorHandler=r})(e=t.ErrorHandling||(t.ErrorHandling={}))})(Q||(Q={}));var Q;(function(t){var e;(function(t){t.applicationPath="/";var e=$("link#ApplicationPath");if(e.length>0){t.applicationPath=e.attr("href")}t.emailAllowOnlyAscii=true;t.responsiveDialogs=false;t.rootNamespaces=["Serenity"];t.notLoggedInHandler=null})(e=t.Config||(t.Config={}))})(Q||(Q={}));var Q;(function(t){function e(t){if($.cookie)return $.cookie(t);t+="=";for(var e=document.cookie.split(/;\s*/),i=e.length-1;i>=0;i--)if(!e[i].indexOf(t))return e[i].replace(t,"")}t.getCookie=e;$.ajaxSetup({beforeSend:function(e){var i=t.getCookie("CSRF-TOKEN");if(i)e.setRequestHeader("X-CSRF-TOKEN",i)}});function i(e){var i=function(i){if(t.Config.notLoggedInHandler!=null&&i&&i.Error&&i.Error.Code=="NotLoggedIn"&&t.Config.notLoggedInHandler(e,i)){return}if(e.onError!=null){e.onError(i);return}t.ErrorHandling.showServiceError(i.Error)};var r=e.service;if(r&&r.length&&r.charAt(0)!="~"&&r.charAt(0)!="/"&&r.indexOf("://")<0)r=s("~/services/")+r;e=$.extend({dataType:"json",contentType:"application/json",type:"POST",cache:false,blockUI:true,url:r,data:$.toJSON(e.request),success:function(i,r,n){try{if(!i.Error&&e.onSuccess){e.onSuccess(i)}}finally{if(e.blockUI){t.blockUndo()}e.onCleanup&&e.onCleanup()}},error:function(r,n,a){try{if(r.status===403){var o=null;try{o=r.getResponseHeader("Location")}catch(l){o=null}if(o){window.top.location.href=o;return}}if((r.getResponseHeader("content-type")||"").toLowerCase().indexOf("application/json")>=0){var s=$.parseJSON(r.responseText);if(s&&s.Error){i(s);return}}var u=r.responseText;if(!u){if(!r.status)t.alert("An unknown AJAX connection error occured! Check browser console for details.");else if(r.status==500)t.alert("HTTP 500: Connection refused! Check browser console for details.");else t.alert("HTTP "+r.status+" error! Check browser console for details.")}else t.iframeDialog({html:u})}finally{if(e.blockUI){t.blockUndo()}e.onCleanup&&e.onCleanup()}}},e);if(e.blockUI){t.blockUI(null)}return $.ajax(e)}t.serviceCall=i;function r(t,e,r,n){return i($.extend({service:t,request:e,onSuccess:r},n))}t.serviceRequest=r;function n(t,e,i){if(t.EqualityFilter==null){t.EqualityFilter={}}t.EqualityFilter[e]=i}t.setEquality=n;function a(t){var e;if(t===undefined)e=location.search.substring(1,location.search.length);else e=t||"";var i={};var r=e.split("&");for(var n=0;n<r.length;n++){var a=r[n].split("=");var o=decodeURIComponent(a[0]);i[o]=a.length>=2?decodeURIComponent(a[1]):o}return i}t.parseQueryString=a;function o(e){var i=$("<form/>").attr("method","POST").attr("action",e.url?s(e.url):s("~/services/"+e.service)).appendTo(document.body);if(e.target)i.attr("target",e.target);var r=$("<div/>").appendTo(i);$("<input/>").attr("type","hidden").attr("name","request").val($["toJSON"](e.request)).appendTo(r);var n=t.getCookie("CSRF-TOKEN");if(n){$("<input/>").attr("type","hidden").attr("name","__RequestVerificationToken").appendTo(r).val(n)}$("<input/>").attr("type","submit").appendTo(r);i.submit();window.setTimeout(function(){i.remove()},0)}t.postToService=o;function l(e){var i=$("<form/>").attr("method","POST").attr("action",s(e.url)).appendTo(document.body);if(e.target)i.attr("target",e.target);var r=$("<div/>").appendTo(i);if(e.params!=null){for(var n in e.params){$("<input/>").attr("type","hidden").attr("name",n).val(e.params[n]).appendTo(r)}}var a=t.getCookie("CSRF-TOKEN");if(a){$("<input/>").attr("type","hidden").attr("name","__RequestVerificationToken").appendTo(r).val(a)}$("<input/>").attr("type","submit").appendTo(r);i.submit();window.setTimeout(function(){i.remove()},0)}t.postToUrl=l;function s(e){if(e&&e.substr(0,2)==="~/"){return t.Config.applicationPath+e.substr(2)}return e}t.resolveUrl=s})(Q||(Q={}));var Q;(function(t){var e;(function(t){var e;var i=[];var r={};function n(){if(e==null&&i.length){e=window.setTimeout(o,100)}}function a(){if(e!=null){window.clearTimeout(e);e=null}}function o(){for(var t=0,e=i;t<e.length;t++){var r=e[t];try{r()}catch(o){console.log(o)}}a();n()}function l(t,e){if(e==null)throw"Layout handler can't be null!";if(r[t]!==undefined)throw"There is already a registered layout handler with key: "+t;if(t!=null)r[t]=i.length;i.push(e);n();return e}t.on=l;function s(t,e,i){var r=e.offsetWidth;var n=e.offsetHeight;l(t,function(){var t=e.offsetWidth;var a=e.offsetHeight;if(t!==r||a!==n){r=t;n=a;i()}});return i}t.onSizeChange=s;function u(t,e,i){var r=e.offsetWidth;l(t,function(){var t=e.offsetWidth;if(t!==r){r=t;i()}});return i}t.onWidthChange=u;function c(t,e,i){var r=e.offsetHeight;l(t,function(){var t=e.offsetHeight;if(t!==r){r=t;i()}});return i}t.onHeightChange=c;function d(t,e){if(t!=null){var n=r[t];if(n!==undefined){delete r[t];if(e==null||e===i[n]){i.splice(n,1);!i.length&&this.clearTimer();return}}}if(e!=null){for(var a=i.length-1;a>=0;a++){if(i[a]===e){i.splice(a,1);!i.length&&this.clearTimer();break}}}}t.off=d})(e=t.LayoutTimer||(t.LayoutTimer={}))})(Q||(Q={}));var Q;(function(t){function e(t){t.css("height","100%");o(t)}t.autoFullHeight=e;function i(e){$("body").addClass("full-height-page");e.addClass("responsive-height");var i=function(){var t=e.parent().hasClass("page-content")||e.parent().is("section.content");if(t){e.css("height","1px").css("overflow","hidden")}n(e);if(t){e.css("overflow","")}e.triggerHandler("layout")};if($("body").hasClass("has-layout-event")){$("body").bind("layout",i)}else if(window.Metronic){window.Metronic.addResizeHandler(i)}else{$(window).resize(i)}i();e.one("remove",function(){$(window).off("layout",i);$("body").off("layout",i)});t.Router.resolve()}t.initFullHeightGridPage=i;function r(t){var e=0;t.parent().children().not(t).each(function(t,i){var r=$(i);if(r.is(":visible")){e+=r.outerHeight(true)}});e=t.parent().height()-e;if(t.css("box-sizing")!=="border-box"){e=e-(t.outerHeight(true)-t.height())}return e}t.layoutFillHeightValue=r;function n(t){var e=r(t);var i=Math.round(e)+"px";if(t.css("height")!=i){t.css("height",i)}}t.layoutFillHeight=n;function a(){var t=navigator.userAgent.indexOf("Mobi")>=0||window.matchMedia("(max-width: 767px)").matches;var e=$(document.body);if(e.hasClass("mobile-device")){if(!t){e.removeClass("mobile-device")}}else if(t){e.addClass("mobile-device")}}t.setMobileDeviceMode=a;function o(t){Serenity.LazyLoadHelper.executeEverytimeWhenShown(t,function(){t.triggerHandler("layout")},true)}t.triggerLayoutOnShow=o;function l(t){if(!t.hasClass("ui-dialog"))t=t.closest(".ui-dialog");t.position({at:"center center",of:window});var e=t.position();if(e.left<0)t.css("left","0px");if(e.top<0)t.css("top","0px")}t.centerDialog=l})(Q||(Q={}));var Q;(function(t){var e;(function(e){var i={};var r={};function n(t,e,i){$(document.body).bind("scriptdatachange."+e,function(e,r){if(r==t){i()}})}e.bindToChange=n;function a(t){$(document.body).triggerHandler("scriptdatachange",[t])}e.triggerChange=a;function o(t){$(document.body).unbind("scriptdatachange."+t)}e.unbindFromChange=o;function l(e,r){return{async:r,cache:true,type:"GET",url:t.resolveUrl("~/DynJS.axd/")+e+".js?"+i[e],data:null,dataType:"text",converters:{"text script":function(t){return t}},success:function(t,e,i){$.globalEval(t)},error:function(i,r,n){var a=t.startsWith(e,"Lookup.");if(i.status==403&&a){t.notifyError('<p>Access denied while trying to load the lookup: "<b>'+e.substr(7)+'</b>". Please check if current user has required permissions for this lookup.</p> '+"<p><em>Lookups use the ReadPermission of their row by default. You may override that for the lookup "+'like [LookupScript("Some.Lookup", Permission = "?")] to grant all '+'authenticated users to read it (or use "*" for public).</em></p>'+"<p><em>Note that this might be a security risk if the lookup contains sensitive data, "+'so it could be better to set a separate permission for lookups, like "MyModule:Lookups".</em></p>',null,{timeOut:1e4,escapeHtml:false});return}t.notifyError("An error occured while trying to load "+(a?' the lookup: "'+e.substr(7):' dynamic script: "'+e)+'"!. Please check the error message displayed in the dialog below for more info.');var o=i.responseText;if(!o){if(!i.status)t.alert("An unknown connection error occured! Check browser console for details.");else if(i.status==500)t.alert("HTTP 500: Connection refused! Check browser console for details.");else t.alert("HTTP "+i.status+" error! Check browser console for details.")}else t.iframeDialog({html:o})}}}function s(e){return Promise.resolve().then(function(){t.blockUI(null);return Promise.resolve($.ajax(l(e,false)).always(function(){t.blockUndo()}))},null)}function u(e){if(i[e]==null){throw new Error(t.format("Script data {0} is not found in registered script list!",e))}$.ajax(l(e,false))}function c(e){return Promise.resolve().then(function(){if(i[e]==null){throw new Error(t.format("Script data {0} is not found in registered script list!",e))}return s(e)},null)}function d(e){var i=r[e];if(i==null){u(e)}i=r[e];if(i==null)throw new Error(t.format("Can't load script data: {0}!",e));return i}e.ensure=d;function f(e){return Promise.resolve().then(function(){var i=r[e];if(i!=null){return Promise.resolve(i)}return c(e).then(function(){i=r[e];if(i==null){throw new Error(t.format("Can't load script data: {0}!",e))}return i},null)},null)}e.ensureAsync=f;function p(e){if(i[e]==null){throw new Error(t.format("Script data {0} is not found in registered script list!",e))}i[e]=(new Date).getTime().toString();u(e);var n=r[e];return n}e.reload=p;function h(e){return Promise.resolve().then(function(){if(i[e]==null){throw new Error(t.format("Script data {0} is not found in registered script list!",e))}i[e]=(new Date).getTime().toString();return c(e).then(function(){return r[e]},null)},null)}e.reloadAsync=h;function g(t){return r[t]!=null||i[t]!=null}e.canLoad=g;function v(t){i={};var e=(new Date).getTime();for(var r in t){i[r]=t[r]||e}}e.setRegisteredScripts=v;function y(t,e){r[t]=e;a(t)}e.set=y})(e=t.ScriptData||(t.ScriptData={}));function i(t){return e.ensure("RemoteData."+t)}t.getRemoteData=i;function r(t){return e.ensureAsync("RemoteData."+t)}t.getRemoteDataAsync=r;function n(i){var r="Lookup."+i;if(!e.canLoad(r)){var n='No lookup with key "'+i+'" is registered. Please make sure you have a'+' [LookupScript("'+i+'")] attribute in server side code on top of a row / custom lookup and '+" its key is exactly the same.";t.notifyError(n);throw new Error(n)}return e.ensure("Lookup."+i)}t.getLookup=n;function a(t){return e.ensureAsync("Lookup."+t)}t.getLookupAsync=a;function o(t){e.reload("Lookup."+t)
}t.reloadLookup=o;function l(t){return e.reloadAsync("Lookup."+t)}t.reloadLookupAsync=l;function s(t){return e.ensure("Columns."+t)}t.getColumns=s;function u(t){return e.ensureAsync("Columns."+t)}t.getColumnsAsync=u;function c(t){return e.ensure("Form."+t)}t.getForm=c;function d(t){return e.ensureAsync("Form."+t)}t.getFormAsync=d;function f(t){return e.ensure("Template."+t)}t.getTemplate=f;function p(t){return e.ensureAsync("Template."+t)}t.getTemplateAsync=p;function h(t){return e.canLoad(t)}t.canLoadScriptData=h})(Q||(Q={}));var Q;(function(t){function e(t,e){for(var i=0;i<e.length-1;i+=2){(function(e,i){Object.defineProperty(t.prototype,e,{get:function(){return this.w(e,i)},enumerable:true,configurable:true})})(e[i],e[i+1])}}t.initFormType=e;function i(t,e,i,r){i=i||"get_"+e;r=r||"set_"+e;Object.defineProperty(t.prototype,e,{get:function(){return this[i]()},set:function(t){return this[r](t)},configurable:true,enumerable:true})}t.prop=i;function r(t,e){if(!t)return null;var i=t.split(".");var r=e||window;for(var n=0;n<i.length;n++){r=r[i[n]];if(r==null)return null}if(typeof r!="function")return null;return r}t.typeByFullName=r;function n(t,e,i){function r(t,e,n){if(!t)return;if($.isArray(t)||t instanceof Date)return;var a=typeof t;if(a=="string"||a=="number")return;if($.isFunction(t)||t.__enum&&t.__register)i(t,e);if(n>3)return;for(var o=0,l=Object.keys(t);o<l.length;o++){var s=l[o];if(s.charAt(0)<"A"||s.charAt(0)>"Z")continue;if(s.indexOf("$")>=0)continue;if(s=="prototype")continue;r(t[s],e+"."+s,n+1)}}for(var n=0,a=e;n<a.length;n++){var o=a[n];if(o==null||!o.length){continue}if(o.indexOf(".")>=0){var l=t;var s=o.split(".");for(var u=0,c=s;u<c.length;u++){var d=c[u];if(!d.length)continue;l=l[d];if(!l)continue}r(l,o,0)}r(t[o],o,0)}}(function(e){e.Q$Externals=t;e.Q$Config=t.Config;e.Q$Culture=t.Culture;e.Q$Lookup=t.Lookup;e.Q$ScriptData=t.ScriptData;e.Q$LT=t.LT;function i(){n(e,t.Config.rootNamespaces,function(t,e){if(t.hasOwnProperty("__typeName")&&!t.__register)return;if(!t.__interfaces&&t.prototype.format&&e.substr(-9)=="Formatter"){t.__class=true;t.__interfaces=[Serenity.ISlickFormatter]}if(!t.__class){var i=ss.getBaseType(t);if(i&&i.__class)t.__class=true}if(t.__class||t.__enum||t.__interface){t.__typeName=e;if(!t.__assembly){t.__assembly=ss.__assemblies["App"]}t.__assembly.__types[e]=t}delete t.__register})}$(function(){i();t.setMobileDeviceMode();$(e).bind("resize",function(){t.setMobileDeviceMode()})})})(window||{})})(Q||(Q={}));var Q;(function(t){var e;(function(e){function i(t){if(t==null)return false;if(t=="*")return true;if(t==""||t=="?")return e.isLoggedIn;var i=e.userDefinition;if(i&&i.IsAdmin)return true;if(i&&i.Permissions){var r=i.Permissions;if(r[t])return true;var n=t.split("|");for(var a=0,o=n;a<o.length;a++){var l=o[a];if(!l)continue;var s=l.split("&");if(!s.length)continue;var u=false;for(var c=0,d=s;c<d.length;c++){var f=d[c];if(!r[f]){u=true;break}}if(!u)return true}}return false}e.hasPermission=i;function r(e){if(!i(e)){t.notifyError(t.text("Authorization.AccessDenied"));throw new Error(t.text("Authorization.AccessDenied"))}}e.validatePermission=r})(e=t.Authorization||(t.Authorization={}));Object.defineProperty(t.Authorization,"userDefinition",{get:function(){return t.getRemoteData("UserData")}});Object.defineProperty(t.Authorization,"isLoggedIn",{get:function(){var t=e.userDefinition;return t&&!!t.Username}});Object.defineProperty(t.Authorization,"username",{get:function(){var t=e.userDefinition;if(t)return t.Username;return null}})})(Q||(Q={}));var Q;(function(t){var e;(function(e){var i;var r=0;var n=0;var a;var o=0;var l=0;e.enabled=true;function s(t,e){return t==e||t==e+"#"||e==t+"#"}function u(t,n,a){if(!e.enabled||r>0)return;t=t||"";t=t.replace(/^#/,"");t=!t?"":"#"+t;var o=window.location.href.replace(/#$/,"").replace(/#.*$/,"")+t;if(o!=window.location.href){if(n&&i!=null&&s(i,o)){if(a)y();var l=window.location.href;i=null;window.history.back();return}if(a)y();i=window.location.href;window.location.hash=t}}e.navigate=u;function c(t,e){u(t,e,true)}e.replace=c;function d(t,i){if(!e.enabled)return;var r=window.location.hash||"";if(r.charAt(0)=="#")r=r.substr(1,r.length-1);var n=r.split("/+/");if(n.length>1){if(t&&t.length){n[n.length-1]=t;t=n.join("/+/")}else{n.splice(n.length-1,1);t=n.join("/+/")}}c(t,i)}e.replaceLast=d;function f(){return $(".ui-dialog-content:visible, .ui-dialog.panel-hidden>.ui-dialog-content, .s-Panel").toArray().sort(function(t,e){return($(t).data("qrouterorder")||0)-($(e).data("qrouterorder")||0)})}function p(e,i,r){var n=[];var a=e.hasClass(".ui-dialog-content")||e.hasClass(".s-Panel");var o=a?e:e.closest(".ui-dialog-content, .s-Panel");var l=r();var s;if(o.length){var u=f();var p=u.indexOf(o[0]);for(var h=0;h<=p;h++){var g=$(u[h]).data("qroute");if(g&&g.length)n.push(g)}if(!a){s=o.attr("id");if(s){s+="_";var v=e.attr("id");if(v&&t.startsWith(v,s))l=v.substr(s.length)+"@"+l}}}else{var v=e.attr("id");if(v&&(!e.hasClass("route-handler")||$(".route-handler").first().attr("id")!=v))l=v+"@"+l}n.push(l);i.data("qroute",l);c(n.join("/+/"));i.bind("dialogclose.qrouter panelclose.qrouter",function(t){i.data("qroute",null);i.unbind(".qrouter");var e=i.data("qprhash");var r=$(t.target).closest(".s-MessageDialog").length>0||t&&t.originalEvent&&(t.originalEvent.type=="keydown"&&t.originalEvent.keyCode==27||$(t.originalEvent.target).hasClass("ui-dialog-titlebar-close")||$(t.originalEvent.target).hasClass("panel-titlebar-close"));if(e!=null)c(e,r);else d("",r)})}function h(t,i,r){if(!e.enabled)return;i.on("dialogopen.qrouter panelopen.qrouter",function(e){p(t,i,r)})}e.dialog=h;function g(i){if(!e.enabled)return;r++;try{i=t.coalesce(t.coalesce(i,window.location.hash),"");if(i.charAt(0)=="#")i=i.substr(1,i.length-1);var n=f();var a=i.split("/+/");var o=n.map(function(t){return $(t).data("qroute")});var l=0;while(l<n.length&&l<a.length&&o[l]==a[l]){l++}for(var s=l;s<n.length;s++){var u=$(n[s]);if(u.hasClass("ui-dialog-content"))u.dialog("close");else if(u.hasClass("s-Panel"))Serenity.TemplatedDialog.closePanel(u)}for(var s=l;s<a.length;s++){var c=a[s];var d=c.split("@");var p;if(d.length==2){var h=s>0?$(n[s-1]):$([]);if(h.length){var g=h.attr("id");if(g){p=$("#"+g+"_"+d[0]);if(p.length){c=d[1]}}}if(!p||!p.length){p=$("#"+d[0]);if(p.length){c=d[1]}}}if(!p||!p.length){p=s>0?$(n[s-1]):$(".route-handler").first()}p.triggerHandler("handleroute",{handled:false,route:c,parts:a,index:s})}}finally{r--}}e.resolve=g;function v(t,e){if(o>0){if((new Date).getTime()-l>1e3){o=0}else{o--;return}}g()}function y(){o++;l=(new Date).getTime()}window.addEventListener("hashchange",v,false);var m=1;$(document).on("dialogopen panelopen",".ui-dialog-content, .s-Panel",function(t,i){if(!e.enabled)return;var r=$(t.target);r.data("qrouterorder",m++);if(r.data("qroute"))return;r.data("qprhash",window.location.hash);var a=$(f).not(r).last();if(!a.length)a=$("html");p(a,r,function(){return"!"+(++n).toString(36)})})})(e=t.Router||(t.Router={}))})(Q||(Q={}));var Serenity;(function(t){var e;(function(t){function e(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function i(t,i){if(!t||!i)return(t||i||[]).slice();return e(t.concat(i))}function r(t,e,r){if(e!=null){t.__typeName=e;t.__assembly=ss.__assemblies["App"];t.__assembly.__types[e]=t}else if(!t.__typeName)t.__register=true;if(r)t.__interfaces=i(t.__interfaces,r)}function n(t,e){return function(i){if(typeof t=="string")r(i,t,e);else r(i,null,t);i.__class=true}}t.registerClass=n;function a(t,e){return function(i){if(typeof t=="string")r(i,t,e);else r(i,null,t);i.__interface=true;i.isAssignableFrom=function(t){return ss.contains(ss.getInterfaces(t),this)}}}t.registerInterface=a;function o(t,e){return n(t,e)}t.registerEditor=o})(e=t.Decorators||(t.Decorators={}))})(Serenity||(Serenity={}));var System;(function(t){var e;(function(t){var e=function(){function t(t){this.displayName=t}t=__decorate([Serenity.Decorators.registerClass("System.DisplayNameAttribute")],t);return t}();t.DisplayNameAttribute=e})(e=t.ComponentModel||(t.ComponentModel={}))})(System||(System={}));(function(t){var e=function(){function e(){}e=__decorate([t.Decorators.registerInterface("Serenity.ISlickFormatter")],e);return e}();t.ISlickFormatter=e;function i(e){return t.Decorators.registerClass("Serenity."+e+"Attribute")}var r=function(){function t(t){this.category=t}t=__decorate([i("Category")],t);return t}();t.CategoryAttribute=r;var n=function(){function t(t){this.value=t}t=__decorate([i("ColumnsKey")],t);return t}();t.ColumnsKeyAttribute=n;var a=function(){function t(t){this.cssClass=t}t=__decorate([i("CssClass")],t);return t}();t.CssClassAttribute=a;var o=function(){function t(t){this.value=t}t=__decorate([i("DefaultValue")],t);return t}();t.DefaultValueAttribute=o;var l=function(){function t(t){this.value=t}t=__decorate([i("DialogType")],t);return t}();t.DialogTypeAttribute=l;var s=function(){function t(){}t=__decorate([i("Editor")],t);return t}();t.EditorAttribute=s;var u=function(){function t(t,e){this.key=t;this.value=e}t=__decorate([i("EditorOption")],t);return t}();t.EditorOptionAttribute=u;var c=function(){function e(t){this.editorType=t}e.prototype.setParams=function(t){};e=__decorate([t.Decorators.registerClass("Serenity.EditorTypeAttributeBase")],e);return e}();t.EditorTypeAttributeBase=c;var d=function(t){__extends(e,t);function e(e){return t.call(this,e)||this}e=__decorate([i("EditorType")],e);return e}(c);t.EditorTypeAttribute=d;var f=function(){function t(t){this.value=t}t=__decorate([i("Element")],t);return t}();t.ElementAttribute=f;var p=function(){function t(t){this.value=t}t=__decorate([i("EntityType")],t);return t}();t.EntityTypeAttribute=p;var h=function(){function t(t){this.value=t}t=__decorate([i("EnumKey")],t);return t}();t.EnumKeyAttribute=h;var g=function(){function t(t){if(t===void 0){t=true}this.value=t}t=__decorate([i("Flexify")],t);return t}();t.FlexifyAttribute=g;var v=function(){function t(t){if(t===void 0){t=true}this.value=t}t=__decorate([i("Filterable")],t);return t}();t.FilterableAttribute=v;var y=function(){function t(t){this.value=t}t=__decorate([i("FormKey")],t);return t}();t.FormKeyAttribute=y;var m=function(){function t(t){this.origin=t}t=__decorate([i("GeneratedCode")],t);return t}();t.GeneratedCodeAttribute=m;var b=function(){function t(){}t=__decorate([i("Hidden")],t);return t}();t.HiddenAttribute=b;var C=function(){function t(t){this.hint=t}t=__decorate([i("Hint")],t);return t}();t.HintAttribute=C;var _=function(){function t(t){this.value=t}t=__decorate([i("IdProperty")],t);return t}();t.IdPropertyAttribute=_;var x=function(){function t(t){if(t===void 0){t=true}this.value=t}t=__decorate([i("Insertable")],t);return t}();t.InsertableAttribute=x;var S=function(){function t(t){this.value=t}t=__decorate([i("IsActiveProperty")],t);return t}();t.IsActivePropertyAttribute=S;var w=function(){function t(t){this.value=t}t=__decorate([i("ItemName")],t);return t}();t.ItemNameAttribute=w;var T=function(){function t(t){this.value=t}t=__decorate([i("LocalTextPrefix")],t);return t}();t.LocalTextPrefixAttribute=T;var I=function(){function t(t){if(t===void 0){t=true}this.value=t}t=__decorate([i("Maximizable")],t);return t}();t.MaximizableAttribute=I;var k=function(){function t(t){this.maxLength=t}t=__decorate([i("MaxLength")],t);return t}();t.MaxLengthAttribute=k;var F=function(){function t(t){this.value=t}t=__decorate([i("NameProperty")],t);return t}();t.NamePropertyAttribute=F;var Q=function(){function t(){}t=__decorate([i("OneWay")],t);return t}();t.OneWayAttribute=Q;var D=function(){function t(){}t=__decorate([i("Option")],t);return t}();t.OptionAttribute=D;var E=function(){function t(t){this.value=t}t=__decorate([i("OptionsType")],t);return t}();t.OptionsTypeAttribute=E;var O=function(){function t(t){if(t===void 0){t=true}this.value=t}t=__decorate([i("Panel")],t);return t}();t.PanelAttribute=O;var P=function(){function t(t){this.value=t}t=__decorate([i("Placeholder")],t);return t}();t.PlaceholderAttribute=P;var A=function(){function t(t){if(t===void 0){t=true}this.value=t}t=__decorate([i("ReadOnly")],t);return t}();t.ReadOnlyAttribute=A;var N=function(){function t(t){if(t===void 0){t=true}this.isRequired=t}t=__decorate([i("Required")],t);return t}();t.RequiredAttribute=N;var $=function(){function t(t){if(t===void 0){t=true}this.value=t}t=__decorate([i("Resizable")],t);return t}();t.ResizableAttribute=$;var V=function(){function t(t){if(t===void 0){t=true}this.value=t}t=__decorate([i("Responsive")],t);return t}();t.ResponsiveAttribute=V;var R=function(){function t(t){this.value=t}t=__decorate([i("Service")],t);return t}();t.ServiceAttribute=R;var L=function(){function t(t){if(t===void 0){t=true}this.value=t}t=__decorate([i("Updatable")],t);return t}();t.UpdatableAttribute=L})(Serenity||(Serenity={}));(function(t){var e;(function(e){function i(i,r){if(i===void 0){i=[t.ISlickFormatter]}if(r===void 0){r=[t.ISlickFormatter]}return e.registerClass(i,r)}e.registerFormatter=i;function r(t,e){t.__metadata=t.__metadata||{};t.__metadata.attr=t.__metadata.attr||[];t.__metadata.attr.push(e)}e.addAttribute=r;function n(e){return function(i){r(i,new t.DialogTypeAttribute(e))}}e.dialogType=n;function a(e){return function(i){var n=new t.EditorAttribute;if(e!==undefined)n.key=e;r(i,n)}}e.editor=a;function o(e){return function(i){r(i,new t.ElementAttribute(e))}}e.element=o;function l(e){return function(i){r(i,new t.EnumKeyAttribute(e))}}e.enumKey=l;function s(e){if(e===void 0){e=true}return function(i){r(i,new t.FlexifyAttribute(e))}}e.flexify=s;function u(e,i,n){if(!e.__enum){Object.defineProperty(e,"__enum",{get:function(){return true}});e.prototype=e.prototype||{};for(var a=0,o=Object.keys(e);a<o.length;a++){var l=o[a];if(isNaN(Q.parseInteger(l))&&e[l]!=null&&!isNaN(Q.parseInteger(e[l])))e.prototype[l]=e[l]}if(n!=null){e.__typeName=n;e.__assembly=ss.__assemblies["App"];e.__assembly.__types[n]=e}else if(!e.__typeName)e.__register=true;if(i)r(e,new t.EnumKeyAttribute(i))}}e.registerEnum=u;function c(t,e,i){u(t,Q.coalesce(i,e),e)}e.registerEnumType=c;function d(e){if(e===void 0){e=true}return function(i){r(i,new t.FilterableAttribute(e))}}e.filterable=d;function f(e){return function(i){r(i,new t.ItemNameAttribute(e))}}e.itemName=f;function p(e){if(e===void 0){e=true}return function(i){r(i,new t.MaximizableAttribute(e))}}e.maximizable=p;function h(){return function(e,i){var r=Q.startsWith(i,"get_")||Q.startsWith(i,"set_");var n=r?i.substr(4):i;var a=e.constructor;a.__metadata=a.__metadata||{};a.__metadata.members=a.__metadata.members||[];var o=undefined;for(var l=0,s=a.__metadata.members;l<s.length;l++){var u=s[l];if(u.name==n){o=u;break}}if(!o){o={attr:[new t.OptionAttribute],name:n,returnType:Object};if(r){o.type=16;o.getter={name:"get_"+n,type:8,sname:"get_"+n,returnType:Object,params:[]};o.setter={name:"set_"+n,type:8,sname:"set_"+n,returnType:Object,params:[Object]}}else{o.type=4;o.sname=n}a.__metadata.members.push(o)}else{o.attr=o.attr||[];o.attr.push(new t.OptionAttribute)}}}e.option=h;function g(e){return function(i){r(i,new t.OptionsTypeAttribute(e))}}e.optionsType=g;function v(e){if(e===void 0){e=true}return function(i){r(i,new t.PanelAttribute(e))}}e.panel=v;function y(e){if(e===void 0){e=true}return function(i){r(i,new t.ResizableAttribute(e))}}e.resizable=y;function m(e){if(e===void 0){e=true}return function(i){r(i,new t.ResponsiveAttribute(e))}}e.responsive=m;function b(e){return function(i){r(i,new t.ServiceAttribute(e))}}e.service=b})(e=t.Decorators||(t.Decorators={}))})(Serenity||(Serenity={}));var Serenity;(function(t){function e(t){return[t]}t.Criteria=e;(function(t){var e=t;function i(t){return t==null||t.length===0||t.length===1&&typeof t[0]=="string"&&t[0].length===0}t.isEmpty=i;function r(t,i,r){if(e.isEmpty(t))return r;if(e.isEmpty(r))return t;return[t,i,r]}t.join=r;function n(t){return e.isEmpty(t)?t:["()",t]}t.paren=n;function a(t,e){var i=[];for(var n=2;n<arguments.length;n++){i[n-2]=arguments[n]}var a=r(t,"and",e);if(i){for(var o=0,l=i;o<l.length;o++){var s=l[o];a=r(a,"and",s)}}return a}t.and=a;function o(t,e){var i=[];for(var n=2;n<arguments.length;n++){i[n-2]=arguments[n]}var a=r(t,"or",e);if(i){for(var o=0,l=i;o<l.length;o++){var s=l[o];a=r(a,"or",s)}}return a}t.or=o})(e=t.Criteria||(t.Criteria={}))})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(){function e(t){var e=this;this.include={};this.grid=t;this.idField=t.getView().idField;t.getGrid().onClick.subscribe(function(i,r){if($(i.target).hasClass("select-item")){i.preventDefault();var n=t.getView().getItem(r.row);var a=n[e.idField].toString();if(e.include[a]){delete e.include[a]}else{e.include[a]=true}for(var o=0;o<t.getView().getLength();o++){t.getGrid().updateRow(o)}e.updateSelectAll()}});t.getGrid().onHeaderClick.subscribe(function(i,r){if(i.isDefaultPrevented()){return}if($(i.target).hasClass("select-all-items")){i.preventDefault();var n=t.getView();if(Object.keys(e.include).length>0){ss.clearKeys(e.include)}else{var a=t.getView().getItems();for(var o=0,l=a;o<l.length;o++){var s=l[o];var u=s[e.idField];e.include[u]=true}}e.updateSelectAll();t.getView().setItems(t.getView().getItems(),true)}});t.getView().onRowsChanged.subscribe(function(){return e.updateSelectAll()})}e.prototype.updateSelectAll=function(){var t=this.grid.getElement().find(".select-all-header .slick-column-name .select-all-items");if(t){var e=Object.keys(this.include);t.toggleClass("checked",e.length>0&&this.grid.getView().getItems().length===e.length)}};e.prototype.clear=function(){ss.clearKeys(this.include);this.updateSelectAll()};e.prototype.resetCheckedAndRefresh=function(){this.include={};this.updateSelectAll();this.grid.getView().populate()};e.prototype.selectKeys=function(t){for(var e=0,i=t;e<i.length;e++){var r=i[e];this.include[r]=true}this.updateSelectAll()};e.prototype.getSelectedKeys=function(){return Object.keys(this.include)};e.prototype.getSelectedAsInt32=function(){return Object.keys(this.include).map(function(t){return parseInt(t,10)})};e.prototype.getSelectedAsInt64=function(){return Object.keys(this.include).map(function(t){return parseInt(t,10)})};e.prototype.setSelectedKeys=function(t){this.clear();for(var e=0,i=t;e<i.length;e++){var r=i[e];this.include[r]=true}this.updateSelectAll()};e.createSelectColumn=function(t){return{name:'<span class="select-all-items check-box no-float "></span>',toolTip:" ",field:"__select__",width:26,minWidth:26,headerCssClass:"select-all-header",sortable:false,format:function(e){var i=e.item;var r=t();if(!r){return""}var n=r.include[e.item[r.idField]];return'<span class="select-item check-box no-float '+(n?" checked":"")+'"></span>'}}};e=__decorate([t.Decorators.registerClass("Serenity.GridRowSelectionMixin")],e);return e}();t.GridRowSelectionMixin=e;var i=function(){function e(t){var e=this;this.include={};this.grid=t;this.idField=t.getView().idField;t.getGrid().onClick.subscribe(function(i,r){if($(i.target).hasClass("rad-select-item")){i.preventDefault();var n=t.getView().getItem(r.row);var a=n[e.idField].toString();if(e.include[a]==true){ss.clearKeys(e.include)}else{ss.clearKeys(e.include);e.include[a]=true}for(var o=0;o<t.getView().getLength();o++){t.getGrid().updateRow(o)}}})}e.prototype.clear=function(){ss.clearKeys(this.include)};e.prototype.resetCheckedAndRefresh=function(){this.include={};this.grid.getView().populate()};e.prototype.getSelectedKey=function(){var t=Object.keys(this.include);if(t!=null&&t.length>0){return t[0]}return null};e.prototype.getSelectedAsInt32=function(){var t=Object.keys(this.include).map(function(t){return parseInt(t,10)});if(t!=null&&t.length>0){return t[0]}return null};e.prototype.getSelectedAsInt64=function(){var t=Object.keys(this.include).map(function(t){return parseInt(t,10)});if(t!=null&&t.length>0){return t[0]}return null};e.prototype.setSelectedKey=function(t){this.clear();this.include[t]=true};e.createSelectColumn=function(t){return{name:"",toolTip:" ",field:"__select__",width:26,minWidth:26,headerCssClass:"",sortable:false,formatter:function(e,i,r,n,a){var o=t();if(!o){return""}var l=o.include[a[o.idField]];return'<input type="radio" name="radio-selection-group" class="rad-select-item no-float" style="cursor: pointer;width: 13px; height:13px;" '+(l?" checked":"")+" /> "}}};e=__decorate([t.Decorators.registerClass("Serenity.GridRadioSelectionMixin")],e);return e}();t.GridRadioSelectionMixin=i;var r;(function(e){function i(e,i){var r=e.element.children(".s-Toolbar");if(r.length===0){return}var n=r.getWidget(t.Toolbar).findButton("select-all-button");var a=e.getView().getItems();n.toggleClass("checked",a.length>0&&!a.some(function(t){return!i(t)}))}e.update=i;function r(e,i,r,n,a,o){if(a==null){a=Q.coalesce(Q.tryGetText("Controls.CheckTreeEditor.SelectAll"),"Select All")}return{title:a,cssClass:"select-all-button",onClick:function(){var r=e();var a=r.getView();var l=r.element.children(".s-Toolbar").getWidget(t.Toolbar).findButton("select-all-button");var s=!l.hasClass("checked");a.beginUpdate();try{for(var u=0,c=a.getItems();u<c.length;u++){var d=c[u];n(d,s);a.updateItem(i(d),d)}o&&o()}finally{a.endUpdate()}l.toggleClass("checked",s)}}}e.define=r})(r=t.GridSelectAllButtonHelper||(t.GridSelectAllButtonHelper={}));var n;(function(e){function i(t,e,i,r,n){var a=$('<div><a href="#"></a></div>').addClass("s-ToggleButton").addClass(e).prependTo(t);a.children("a").click(function(t){t.preventDefault();a.toggleClass("pressed");var e=a.hasClass("pressed");i&&i(e)}).attr("title",Q.coalesce(r,""));if(n){a.addClass("pressed")}}e.addToggleButton=i;function r(t,e,r,n){var a=false;var o=e.onSubmit;e.onSubmit=function(t){t.params.IncludeDeleted=a;if(o!=null){return o(t)}return true};if(r==null)r=Q.text("Controls.EntityGrid.IncludeDeletedToggle");i(t,"s-IncludeDeletedToggle",function(t){a=t;e.seekToPage=1;e.populate()},r,n);t.bind("remove",function(){e.onSubmit=null;o=null})}e.addIncludeDeletedToggle=r;function n(t,e,i){var r=e.onSubmit;var n="";var o="";e.onSubmit=function(t){if(n!=null&&n.length>0){t.params.ContainsText=n}else{delete t.params["ContainsText"]}if(o!=null&&o.length>0){t.params.ContainsField=o}else{delete t.params["ContainsField"]}if(r!=null)return r(t);return true};var l=null;a(t,function(t,i,r){n=i;o=t;e.seekToPage=1;l=r;e.populate()},i);e.onDataLoaded.subscribe(function(t,i){if(l!=null){l(e.getLength()>0);l=null}})}e.addQuickSearchInput=n;function a(e,i,r){var n=$('<div><input type="text"/></div>').addClass("s-QuickSearchBar").prependTo(e);if(r!=null&&r.length>0){n.addClass("has-quick-search-fields")}new t.QuickSearchInput(n.children(),{fields:r,onSearch:i})}e.addQuickSearchInputCustom=a;function o(t,e){var i=new Slick.RowMoveManager({cancelEditOnDrag:true});i.onBeforeMoveRows.subscribe(function(t,e){for(var i=0;!!(i<e.rows.length);i++){if(!!(e.rows[i]===e.insertBefore||e.rows[i]===e.insertBefore-1)){t.stopPropagation();return false}}return true});i.onMoveRows.subscribe(function(i,r){e(r.rows,r.insertBefore);try{t.setSelectedRows([])}catch(n){}});t.registerPlugin(i)}e.makeOrderable=o;function l(t,e,i,r,n){o(t.slickGrid,function(a,o){if(a.length===0){return}var l;var s=o;if(s<0){l=1}else if(o>=t.rowCount()){l=Q.coalesce(i(t.itemAt(t.rowCount()-1)),0);if(l===0){l=o+1}else{l=l+1}}else{l=Q.coalesce(i(t.itemAt(o)),0);if(l===0){l=o+1}}var u=0;var c=null;c=function(){Q.serviceCall({service:r,request:n(e(t.itemAt(a[u])),l++),onSuccess:function(e){u++;if(u<a.length){c()}else{t.view.populate()}}})};c()})}e.makeOrderableWithUpdateRequest=l})(n=t.GridUtils||(t.GridUtils={}));var a;(function(e){function i(t){var e=[];if(t==null){return e}for(var i=0;i<t.length;i++){e.push(r(t[i]))}return e}e.toSlickColumns=i;function r(e){var i={field:e.name,sourceItem:e,cssClass:e.cssClass,headerCssClass:e.headerCssClass,sortable:e.sortable!==false,sortOrder:Q.coalesce(e.sortOrder,0),width:e.width!=null?e.width:80,minWidth:Q.coalesce(e.minWidth,30),maxWidth:e.maxWidth==null||e.maxWidth===0?null:e.maxWidth,resizable:e.resizable==null||!!e.resizable};i.visible=e.visible!==false&&e.filterOnly!==true&&(e.readPermission==null||Q.Authorization.hasPermission(e.readPermission));var r=Q.tryGetText(e.title);if(r==null)r=e.title;i.name=r;if(e.alignment!=null&&e.alignment.length>0){if(!Q.isEmptyOrNull(i.cssClass)){i.cssClass+=" align-"+e.alignment}else{i.cssClass="align-"+e.alignment}}if(e.formatterType!=null&&e.formatterType.length>0){var n=ss.cast(ss.createInstance(t.FormatterTypeRegistry.get(e.formatterType)),t.ISlickFormatter);if(e.formatterParams!=null){t.ReflectionOptionsSetter.set(n,e.formatterParams)}var a=ss.safeCast(n,t.IInitializeColumn);if(a!=null){a.initializeColumn(i)}i.format=function(t){return n.format(t)}}return i}e.toSlickColumn=r})(a=t.PropertyItemSlickConverter||(t.PropertyItemSlickConverter={}));var o;(function(e){function i(e,i){return t.EnumFormatter.getText(e,i)}e.getEnumText=i;function r(t,e,i){return function(r){var n=i(r);var a=t();var o=Q.coalesce(r.item._indent,0);var l='<span class="s-TreeIndent" style="width:'+15*o+'px"></span>';var s=e(r.item);var u=a.getIdxById(s);var c=a.getItemByIdx(u+1);if(c!=null){var d=Q.coalesce(c._indent,0);if(d>o){if(!!!!r.item._collapsed){return l+'<span class="s-TreeToggle s-TreeExpand"></span>'+n}else{return l+'<span class="s-TreeToggle s-TreeCollapse"></span>'+n}}}return l+'<span class="s-TreeToggle"></span>'+n}}e.treeToggle=r;function n(e){if(e==null){e=Q.Culture.dateFormat}return function(i){return Q.htmlEncode(t.DateFormatter.format(i.value,e))}}e.date=n;function a(e){if(e==null){e=Q.Culture.dateTimeFormat}return function(i){return Q.htmlEncode(t.DateFormatter.format(i.value,e))}}e.dateTime=a;function o(){return function(t){return'<span class="check-box no-float '+(!!t.value?" checked":"")+'"></span>'}}e.checkBox=o;function l(e){return function(i){return t.NumberFormatter.format(i.value,e)}}e.number=l;function s(t){return t.data("item-type")}e.getItemType=s;function u(t){var e=t.data("item-id");return e==null?null:e.toString()}e.getItemId=u;function c(t,e,i,r,n){return"<a"+(e!=null?' href="#'+Q.replaceAll(t,".","-")+"/"+e+'"':"")+' data-item-type="'+Q.attrEncode(t)+'"'+' data-item-id="'+Q.attrEncode(e)+'"'+' class="s-EditLink s-'+Q.replaceAll(t,".","-")+"Link"+(Q.isEmptyOrNull(r)?"":" "+r)+'">'+(n?Q.htmlEncode(Q.coalesce(i,"")):Q.coalesce(i,""))+"</a>"}e.itemLinkText=c;function d(t,e,i,r,n){return function(a){return c(t,a.item[e],i==null?a.value:i(a),r==null?"":r(a),n)}}e.itemLink=d})(o=t.SlickFormatting||(t.SlickFormatting={}));var l;(function(t){function e(t,e){for(var r=0,n=t;r<n.length;r++){var a=n[r];a.sortable=a.sortable!=null?a.sortable:true;var o=a.id;if(o==null){o=a.field}a.id=o;if(e!=null&&a.id!=null&&(a.name==null||Q.startsWith(a.name,"~"))){var l=a.name!=null?a.name.substr(1):a.id;a.name=Q.text(e+l)}if(a.formatter==null&&a.format!=null){a.formatter=i(a.format)}else if(a.formatter==null){a.formatter=function(t,e,i,r,n){return Q.htmlEncode(i)}}}return t}t.setDefaults=e;function i(t){if(t==null){return null}else{return function(e,i,r,n,a){return t({row:e,cell:i,value:r,column:n,item:a})}}}t.convertToFormatter=i})(l=t.SlickHelper||(t.SlickHelper={}));var s;(function(t){function e(t,e){var i=e(t);var r=0;while(i!=null){if(!!i._collapsed){return false}i=e(i);if(r++>1e3){throw new ss.InvalidOperationException("Possible infinite loop, check parents has no circular reference!")}}return true}t.filterCustom=e;function i(t,i,r){return e(t,function(t){var e=r(t);if(e==null){return null}return i.getItemById(e)})}t.filterById=i;function r(t,e){if(t!=null){for(var i=0,r=t;i<r.length;i++){var n=r[i];n._collapsed=e}}}t.setCollapsed=r;function n(t,e){t._collapsed=e}t.setCollapsedFlag=n;function a(t,e,i,r){var n=0;var a={};for(var o=0;o<t.length;o++){var l=t[o];if(o>0){var s=i(l);if(s!=null&&s===e(t[o-1])){n+=1}else if(s==null){n=0}else if(s!==i(t[o-1])){if(a[s]!=null){n=a[s]+1}else{n=0}}}a[e(l)]=n;l._indent=n;if(r!=null){l._collapsed=r}}}t.setIndents=a;function o(t,e,i,n,a){var o=$(t.target);if(!o.hasClass("s-TreeToggle")){return}if(o.hasClass("s-TreeCollapse")||o.hasClass("s-TreeExpand")){var l=n.getItem(e);if(l!=null){if(!!!l._collapsed){l._collapsed=true}else{l._collapsed=false}n.updateItem(a(l),l)}if(t.shiftKey){n.beginUpdate();try{r(n.getItems(),!!l._collapsed);n.setItems(n.getItems(),true)}finally{n.endUpdate()}}}}t.toggleClick=o})(s=t.SlickTreeHelper||(t.SlickTreeHelper={}))})(Serenity||(Serenity={}));var Serenity;(function(t){var e;(function(t){var e=0;function i(t,i){e++;var r="ExecuteOnceWhenShown"+e;var n=false;if(t.is(":visible")){i()}else{var a=t.closest(".ui-tabs");if(a.length>0){a.bind("tabsshow."+r,function(e){if(t.is(":visible")){a.unbind("tabsshow."+r);if(!n){n=true;t.unbind("shown."+r);i()}}})}var o=t.closest(".nav-tabs");if(o.length>0){o.one("shown.bs.tab",function(e){if(!n&&t.is(":visible")){n=true;i()}})}var l;if(t.hasClass("ui-dialog")){l=t.children(".ui-dialog-content")}else{l=t.closest(".ui-dialog-content, .s-TemplatedDialog")}if(l.length>0){l.bind("dialogopen."+r+" panelopen."+r,function(){l.unbind("dialogopen."+r);l.unbind("panelopen."+r);if(t.is(":visible")&&!n){n=true;t.unbind("shown."+r);i()}})}t.bind("shown."+r,function(){if(t.is(":visible")){t.unbind("shown."+r);if(!n){n=true;i()}}})}}t.executeOnceWhenShown=i;function r(t,i,r){e++;var n="ExecuteEverytimeWhenShown"+e;var a=t.is(":visible");if(a&&r){i()}var o=function(e){if(t.is(":visible")){if(!a){a=true;i()}}else{a=false}};var l=t.closest(".ui-tabs");if(l.length>0){l.bind("tabsactivate."+n,o)}var s=t.closest(".ui-dialog-content, .s-TemplatedDialog");if(s.length>0){s.bind("dialogopen."+n+" panelopen."+n,o)}t.bind("shown."+n,o)}t.executeEverytimeWhenShown=r})(e=t.LazyLoadHelper||(t.LazyLoadHelper={}))})(Serenity||(Serenity={}));var Serenity;(function(t){var e;(function(t){function e(t,e,i,r){var n=e.widgetName;t.element.bind("ondatachange."+n,function(t,e){if(r){window.setTimeout(function(){i(t,e)},0)}else{i(t,e)}}).bind("remove."+n,function(){t.element.unbind("ondatachange."+n)});return t}t.bindToDataChange=e;function i(t){t.element.triggerHandler("ondatachange");return t}t.triggerDataChange=i;function r(t){t.triggerHandler("ondatachange");return t}t.triggerDataChanged=r;function n(t,i,r){return e(t,i,function(t,e){i.element.triggerHandler("ondatachange")},r)}t.bubbleDataChange=n;function a(t,e){t.element.one("dialogopen",function(i){t.element.dialog().dialog("option","position",o(e))});return t}t.cascade=a;function o(t){return{my:"left top",at:"left+20 top+20",of:t[0]}}t.cascadedDialogOffset=o})(e=t.SubDialogHelper||(t.SubDialogHelper={}))})(Serenity||(Serenity={}));var Serenity;(function(t){var e;(function(t){function e(t,e,i){if(!t)return;var r=n(t);if(!r)return;var a=r[e];if(a==null){return}if(i&&a===t.tabs("option","active")){t.tabs("option","active",0)}t.tabs(i?"disable":"enable",a)}t.setDisabled=e;function i(t,e,i){if(!t)return;var r=n(t);if(!r)return;var a=r[e];if(a==null){return}if(!i&&a===t.tabs("option","active")){t.tabs("option","active",0)}t.children("ul").children("li").eq(a).toggle(i)}t.toggle=i;function r(t){var e=t.children("ul").children("li").eq(t.tabs("option","active")).children("a").attr("href").toString();var i="_Tab";var r=e.lastIndexOf(i);if(r>=0){e=e.substr(r+i.length)}return e}t.activeTabKey=r;function n(t){var e=t.data("indexByKey");if(!e){e={};t.children("ul").children("li").children("a").each(function(t,i){var r=i.getAttribute("href").toString();var n="_Tab";var a=r.lastIndexOf(n);if(a>=0){r=r.substr(a+n.length)}e[r]=t});t.data("indexByKey",e)}return e}t.indexByKey=n;function a(t,e){var i=n(t);if(!i)return;var r=i[e];if(r==null){return}if(r!==t.tabs("option","active")){t.tabs("option","active",r)}}t.selectTab=a})(e=t.TabsExtensions||(t.TabsExtensions={}))})(Serenity||(Serenity={}));var Serenity;(function(t){var e;(function(t){function e(t){t.container.addClass("fileinput-button");var e=$("<input/>").attr("type","file").attr("name",t.inputName+"[]").attr("data-url",Q.resolveUrl("~/File/TemporaryUpload")).attr("multiple","multiple").appendTo(t.container);
if(t.allowMultiple){e.attr("multiple","multiple")}e.fileupload({dataType:"json",dropZone:t.zone,pasteZone:t.zone,done:function(e,i){var r=i.result;if(t.fileDone!=null){t.fileDone(r,i.files[0].name,i)}},start:function(){Q.blockUI(null);if(t.progress!=null){t.progress.show()}},stop:function(){Q.blockUndo();if(t.progress!=null){t.progress.hide()}},progress:function(e,i){if(t.progress!=null){var r=i.loaded/i.total*100;t.progress.children().css("width",r.toString()+"%")}}});return e}t.addUploadInput=e;function i(e,i){if(!e.IsImage&&!i.allowNonImage){Q.alert(Q.text("Controls.ImageUpload.NotAnImageFile"));return false}if(i.minSize>0&&e.Size<i.minSize){Q.alert(Q.format(Q.text("Controls.ImageUpload.UploadFileTooSmall"),t.fileSizeDisplay(i.minSize)));return false}if(i.maxSize>0&&e.Size>i.maxSize){Q.alert(Q.format(Q.text("Controls.ImageUpload.UploadFileTooBig"),t.fileSizeDisplay(i.maxSize)));return false}if(!e.IsImage){return true}if(i.minWidth>0&&e.Width<i.minWidth){Q.alert(Q.format(Q.text("Controls.ImageUpload.MinWidth"),i.minWidth));return false}if(i.maxWidth>0&&e.Width>i.maxWidth){Q.alert(Q.format(Q.text("Controls.ImageUpload.MaxWidth"),i.maxWidth));return false}if(i.minHeight>0&&e.Height<i.minHeight){Q.alert(Q.format(Q.text("Controls.ImageUpload.MinHeight"),i.minHeight));return false}if(i.maxHeight>0&&e.Height>i.maxHeight){Q.alert(Q.format(Q.text("Controls.ImageUpload.MaxHeight"),i.maxHeight));return false}return true}t.checkImageConstraints=i;function r(t,e){return t+" ("+n(e)+")"}t.fileNameSizeDisplay=r;function n(t){var e=ss.round(t*100/1024)*.01;var i="KB";if(e>1e3){e=ss.round(e*.001*100)*.01;i="MB"}var r=e.toString().split(String.fromCharCode(46));var n;if(r.length>1){n=r[0]+"."+r[1].substr(0,2)}else{n=r[0]}return n+" "+i}t.fileSizeDisplay=n;function a(t){if(Q.isEmptyOrNull(t)){return false}t=t.toLowerCase();return Q.endsWith(t,".jpg")||Q.endsWith(t,".jpeg")||Q.endsWith(t,".gif")||Q.endsWith(t,".png")}t.hasImageExtension=a;function o(t){t=Q.coalesce(t,"");var e=t.lastIndexOf(".");if(e>=0){t=t.substr(0,e)}return t+"_t.jpg"}t.thumbFileName=o;function l(t){t=Q.replaceAll(Q.coalesce(t,""),"\\","/");return Q.resolveUrl("~/upload/")+t}t.dbFileUrl=l;function s(t,e){t.colorbox({current:Q.text("Controls.ImageUpload.ColorboxCurrent"),previous:Q.text("Controls.ImageUpload.ColorboxPrior"),next:Q.text("Controls.ImageUpload.ColorboxNext"),close:Q.text("Controls.ImageUpload.ColorboxClose")})}t.colorBox=s;function u(t,e,i,r){e=e||[];t.html("");for(var n=0;n<e.length;n++){var u=e[n];var c=$("<li/>").addClass("file-item").data("index",n);var d=a(u.Filename);if(d){c.addClass("file-image")}else{c.addClass("file-binary")}var f="#"+n;var p=$("<a/>").addClass("thumb").appendTo(c);var h=Q.coalesce(u.OriginalName,"");var g=u.Filename;if(r!=null&&g!=null&&!Q.startsWith(g,"temporary/")){g=r+g}p.attr("href",l(g));p.attr("target","_blank");if(!Q.isEmptyOrNull(h)){p.attr("title",h)}if(d){p.css("backgroundImage","url('"+l(o(u.Filename))+"')");s(p,new Object)}if(i){$("<div/>").addClass("filename").text(h).attr("title",h).appendTo(c)}c.appendTo(t)}}t.populateFileSymbols=u})(e=t.UploadHelper||(t.UploadHelper={}))})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(){function e(){}e=__decorate([t.Decorators.registerInterface("Serenity.IAsyncInit")],e);return e}();t.IAsyncInit=e;if(typeof React==="undefined"){if(window["preact"]!=null){window["React"]=window["ReactDOM"]=window["preact"];React.Fragment=Q.coalesce(React.Fragment,"x-fragment")}else if(window["Nerv"]!=null){window["React"]=window["ReactDOM"]=window["Nerv"];React.Fragment=Q.coalesce(React.Fragment,"x-fragment")}else{window["React"]={Component:function(){},Fragment:"x-fragment",createElement:function(){return{_reactNotLoaded:true}}};window["ReactDOM"]={render:function(){throw Error("To use React, it should be included before Serenity.CoreLib.js")}}}}var i=function(e){__extends(i,e);function i(t,i){var n=e.call(this,i)||this;n.element=t;n.options=i||{};n.widgetName=r.getWidgetName(ss.getInstanceType(n));n.uniqueName=n.widgetName+(r.nextWidgetNumber++).toString();if(t.data(n.widgetName)){throw new ss.Exception(Q.format("The element already has widget '{0}'!",n.widgetName))}t.bind("remove."+n.widgetName,function(t){if(t.bubbles||t.cancelable){return}n.destroy()}).data(n.widgetName,n);n.addCssClass();if(n.isAsyncWidget()){window.setTimeout(function(){if(t&&!n.asyncPromise){n.asyncPromise=n.initializeAsync()}},0)}return n}r=i;i.prototype.destroy=function(){this.element.removeClass("s-"+ss.getTypeName(ss.getInstanceType(this)));this.element.unbind("."+this.widgetName).unbind("."+this.uniqueName).removeData(this.widgetName);this.element=null;this.asyncPromise=null};i.prototype.addCssClass=function(){this.element.addClass(this.getCssClass())};i.prototype.getCssClass=function(){var t=ss.getInstanceType(this);var e="s-"+ss.getTypeName(t);var i=Q.replaceAll(ss.getTypeFullName(t),".","-");for(var r=0,n=Q.Config.rootNamespaces;r<n.length;r++){var a=n[r];if(Q.startsWith(i,a+"-")){i=i.substr(a.length+1);break}}i="s-"+i;if(e===i){return e}return e+" "+i};i.prototype.initializeAsync=function(){return Promise.resolve()};i.prototype.isAsyncWidget=function(){return ss.isInstanceOfType(this,t.IAsyncInit)};i.getWidgetName=function(t){return Q.replaceAll(ss.getTypeFullName(t),".","_")};i.elementFor=function(e){var i=ss.getAttributes(e,t.ElementAttribute,true);var r=i.length>0?i[0].value:"<input/>";return $(r)};i.create=function(e){var i;if(ss.isAssignableFrom(t.IDialog,e.type)){i=new e.type(e.options);if(e.container)i.element.appendTo(e.container);e.element&&e.element(i.element)}else{var n=r.elementFor(e.type);if(e.container)n.appendTo(e.container);e.element&&e.element(n);i=new e.type(n,e.options)}if(i.isAsyncWidget())i.init(e.init);else{i.init(null);e.init&&e.init(i)}return i};i.prototype.init=function(t){var e=this;var i=this.initialize();if(t){i.then(function(){return t(e)})}return this};i.prototype.initialize=function(){if(!this.isAsyncWidget()){return Promise.resolve()}if(!this.asyncPromise){this.asyncPromise=this.initializeAsync()}return this.asyncPromise};var r;i.nextWidgetNumber=0;i.__isWidgetType=true;i=r=__decorate([t.Decorators.registerClass()],i);return i}(React.Component);t.Widget=i;i.prototype.addValidationRule=function(e,i){return t.VX.addValidationRule(this.element,e,i)}})(Serenity||(Serenity={}));var Serenity;(function(t){var e;(function(t){function e(t,e,i){var r=t.validate();var n=r.settings;if(n.abortHandler){return false}if(e!=null&&e()===false){return false}n["abortHandler"]=Q.validatorAbortHandler;n["submitHandler"]=function(){if(i!=null){i()}return false};t.trigger("submit");return true}t.asyncSubmit=e;function i(t,e,i){var r=t.validate();var n=r.settings;if(n.abortHandler!=null){return false}if(e!=null&&e()===false){return false}if(!r.form()){return false}if(i!=null){i()}return true}t.submit=i;function r(t){var e=t.closest("form");if(e.length===0){return null}return e.data("validator")}t.getValidator=r})(e=t.ValidationHelper||(t.ValidationHelper={}));var i;(function(t){function e(t,e,i){if(t.length===0){return t}if(i==null){throw new ss.Exception("rule is null!")}t.addClass("customValidate").bind("customValidate."+e,i);return t}t.addValidationRule=e;function i(t,e){t.unbind("customValidate."+e);return t}t.removeValidationRule=i;function r(t,e){return t.element(e.element[0])}t.validateElement=r})(i=t.VX||(t.VX={}))})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t,i)||this;r.idPrefix=r.uniqueName+"_";var n=r.getTemplate().replace(new RegExp("~_","g"),r.idPrefix);var a=0;while(true){var o=n.indexOf('{{text:"',a);if(o<0)break;var a=n.indexOf('"}}',o);if(a<0)break;var l=n.substr(o+8,a-o-8);var s=Q.text(l);n=n.substr(0,o)+s+n.substr(a+3);a=o+s.length}r.element.html(n);return r}r=i;i.prototype.byId=function(t){return $("#"+this.idPrefix+t)};i.prototype.byID=function(e,i){return t.WX.getWidget(this.byId(e),i)};i.noGeneric=function(t){var e=t.indexOf("$");if(e>=0){return t.substr(0,e)}return t};i.prototype.getDefaultTemplateName=function(){return r.noGeneric(ss.getTypeName(ss.getInstanceType(this)))};i.prototype.getTemplateName=function(){var e=ss.getInstanceType(this);var i=ss.getTypeFullName(e);var n=r.templateNames;var a=r.templateNames[i];if(a!=null){return a}while(e&&e!==t.Widget){var o=r.noGeneric(ss.getTypeFullName(e));for(var l=0,s=Q.Config.rootNamespaces;l<s.length;l++){var u=s[l];if(Q.startsWith(o,u+".")){o=o.substr(u.length+1);break}}if(Q.canLoadScriptData("Template."+o)){n[i]=o;return o}o=Q.replaceAll(o,".","_");if(Q.canLoadScriptData("Template."+o)||$("script#Template_"+o).length>0){n[i]=o;return o}o=r.noGeneric(ss.getTypeName(e));if(Q.canLoadScriptData("Template."+o)||$("script#Template_"+o).length>0){r.templateNames[i]=o;return o}e=ss.getBaseType(e)}n[i]=a=this.getDefaultTemplateName();return a};i.prototype.getFallbackTemplate=function(){return null};i.prototype.getTemplate=function(){var t=this.getTemplateName();var e=$("script#Template_"+t);if(e.length>0){return e.html()}var i;if(!Q.canLoadScriptData("Template."+t)&&this.getDefaultTemplateName()==t){i=this.getFallbackTemplate();if(i!=null)return i}i=Q.getTemplate(t);if(i==null){throw new Error(Q.format("Can't locate template for widget '{0}' with name '{1}'!",ss.getTypeName(ss.getInstanceType(this)),t))}return i};var r;i.templateNames={};i=r=__decorate([t.Decorators.registerClass()],i);return i}(t.Widget);t.TemplatedWidget=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(){function e(){}e=__decorate([t.Decorators.registerInterface()],e);return e}();t.IBooleanValue=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(){function e(){}e=__decorate([t.Decorators.registerInterface()],e);return e}();t.IDoubleValue=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(){function e(){}e=__decorate([t.Decorators.registerInterface()],e);return e}();t.IGetEditValue=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(){function e(){}e=__decorate([t.Decorators.registerInterface()],e);return e}();t.ISetEditValue=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(){function e(){}e=__decorate([t.Decorators.registerInterface()],e);return e}();t.IStringValue=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(){function e(){}e=__decorate([t.Decorators.registerInterface("Serenity.IReadOnly")],e);return e}();t.IReadOnly=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e;(function(t){t[t["Disabled"]=-1]="Disabled";t[t["None"]=0]="None";t[t["Sum"]=1]="Sum";t[t["Avg"]=2]="Avg";t[t["Min"]=3]="Min";t[t["Max"]=4]="Max"})(e=t.SummaryType||(t.SummaryType={}));t.Decorators.registerEnum(e,"Serenity.SummaryType")})(Serenity||(Serenity={}));var Serenity;(function(t){var e=t.Decorators.option;var i=function(i){__extends(r,i);function r(e){var r=i.call(this,e)||this;e.addClass("dateQ");e.datepicker({showOn:"button",beforeShow:function(t,i){return!e.hasClass("readonly")},yearRange:Q.coalesce(r.yearRange,"-100:+50")});e.bind("keyup."+r.uniqueName,function(e){if(e.which===32&&!r.get_readOnly()){if(r.get_valueAsDate()!=ss.today()){r.set_valueAsDate(ss.today());r.element.trigger("change")}}else{t.DateEditor.dateInputKeyup(e)}});e.bind("change."+r.uniqueName,t.DateEditor.dateInputChange);t.VX.addValidationRule(e,r.uniqueName,function(t){var e=r.get_value();if(Q.isEmptyOrNull(e)){return null}if(!Q.isEmptyOrNull(r.get_minValue())&&ss.compareStrings(e,r.get_minValue())<0){return Q.format(Q.text("Validation.MinDate"),Q.formatDate(r.get_minValue(),null))}if(!Q.isEmptyOrNull(r.get_maxValue())&&ss.compareStrings(e,r.get_maxValue())>=0){return Q.format(Q.text("Validation.MaxDate"),Q.formatDate(r.get_maxValue(),null))}return null});r.set_sqlMinMax(true);return r}r.prototype.get_value=function(){var t=this.element.val().trim();if(t!=null&&t.length===0){return null}return Q.formatDate(t,"yyyy-MM-dd")};Object.defineProperty(r.prototype,"value",{get:function(){return this.get_value()},set:function(t){this.set_value(t)},enumerable:true,configurable:true});r.prototype.set_value=function(t){if(t==null){this.element.val("")}else if(t.toLowerCase()==="today"||t.toLowerCase()==="now"){this.element.val(Q.formatDate(ss.today(),null))}else{this.element.val(Q.formatDate(t,null))}};r.prototype.get_valueAsDate=function(){if(Q.isEmptyOrNull(this.get_value())){return null}return Q.parseISODateTime(this.get_value())};Object.defineProperty(r.prototype,"valueAsDate",{get:function(){return this.get_valueAsDate()},set:function(t){this.set_valueAsDate(t)},enumerable:true,configurable:true});r.prototype.set_valueAsDate=function(t){if(t==null){this.set_value(null)}this.set_value(Q.formatDate(t,"yyyy-MM-dd"))};r.prototype.get_readOnly=function(){return this.element.hasClass("readonly")};r.prototype.set_readOnly=function(t){if(t!==this.get_readOnly()){if(t){this.element.addClass("readonly").attr("readonly","readonly");this.element.nextAll(".ui-datepicker-trigger").css("opacity","0.1")}else{this.element.removeClass("readonly").removeAttr("readonly");this.element.nextAll(".ui-datepicker-trigger").css("opacity","1")}}};r.prototype.get_minValue=function(){return this.minValue};r.prototype.set_minValue=function(t){this.minValue=t};r.prototype.get_maxValue=function(){return this.maxValue};r.prototype.set_maxValue=function(t){this.maxValue=t};r.prototype.get_minDate=function(){return Q.parseISODateTime(this.get_minValue())};r.prototype.set_minDate=function(t){this.set_minValue(Q.formatDate(t,"yyyy-MM-dd"))};r.prototype.get_maxDate=function(){return Q.parseISODateTime(this.get_maxValue())};r.prototype.set_maxDate=function(t){this.set_maxValue(Q.formatDate(t,"yyyy-MM-dd"))};r.prototype.get_sqlMinMax=function(){return this.get_minValue()==="1753-01-01"&&this.get_maxValue()==="9999-12-31"};r.prototype.set_sqlMinMax=function(t){if(t){this.set_minValue("1753-01-01");this.set_maxValue("9999-12-31")}else{this.set_minValue(null);this.set_maxValue(null)}};r.dateInputKeyup=function(t){if(Q.Culture.dateOrder!=="dmy"){return}var e=$(t.target);if(!e.is(":input")){return}if(e.is("[readonly]")||e.is(":disabled")){return}var i=Q.coalesce(e.val(),"");if(!!(i.length===0||e[0].selectionEnd!==i.length)){return}if(i.indexOf(Q.Culture.dateSeparator+Q.Culture.dateSeparator)!==-1){e.val(Q.replaceAll(i,Q.Culture.dateSeparator+Q.Culture.dateSeparator,Q.Culture.dateSeparator));return}function r(t){return t>=48&&t<=57}if(t.which===47||t.which===111){if(i.length>=2&&i.charAt(i.length-1)===Q.Culture.dateSeparator&&i.charAt(i.length-2)===Q.Culture.dateSeparator){e.val(i.substr(0,i.length-1));return}if(i.charAt(i.length-1)!==Q.Culture.dateSeparator){return}switch(i.length){case 2:{if(r(i.charCodeAt(0))){i="0"+i;break}else{return}}case 4:{if(r(i.charCodeAt(0))&&r(i.charCodeAt(2))&&i.charAt(1)==Q.Culture.dateSeparator){i="0"+i.charAt(0)+Q.Culture.dateSeparator+"0"+i.charAt(2)+Q.Culture.dateSeparator;break}else{return}}case 5:{if(r(i.charCodeAt(0))&&r(i.charCodeAt(2))&&r(i.charCodeAt(3))&&i.charAt(1)===Q.Culture.dateSeparator){i="0"+i;break}else if(r(i.charCodeAt(0))&&r(i.charCodeAt(1))&&r(i.charCodeAt(3))&&i.charAt(2)===Q.Culture.dateSeparator){i=i.charAt(0)+i.charAt(1)+Q.Culture.dateSeparator+"0"+i.charAt(3)+Q.Culture.dateSeparator;break}else{break}}default:{return}}e.val(i)}if(i.length<6&&(t.which>=48&&t.which<=57||t.which>=96&&t.which<=105)&&r(i.charCodeAt(i.length-1))){switch(i.length){case 1:{if(i.charCodeAt(0)<=51){return}i="0"+i;break}case 2:{if(!r(i.charCodeAt(0))){return}break}case 3:{if(!r(i.charCodeAt(0))||i.charAt(1)!==Q.Culture.dateSeparator||i.charCodeAt(2)<=49){return}i="0"+i.charAt(0)+Q.Culture.dateSeparator+"0"+i.charAt(2);break}case 4:{if(i.charAt(1)==Q.Culture.dateSeparator){if(!r(i.charCodeAt(0))||!r(i.charCodeAt(2))){return}i="0"+i;break}else if(i.charAt(2)==Q.Culture.dateSeparator){if(!r(i.charCodeAt(0))||!r(i.charCodeAt(1))||i.charCodeAt(3)<=49){return}i=i.charAt(0)+i.charAt(1)+Q.Culture.dateSeparator+"0"+i.charAt(3);break}else{return}}case 5:{if(i.charAt(2)!==Q.Culture.dateSeparator||!r(i.charCodeAt(0))||!r(i.charCodeAt(1))||!r(i.charCodeAt(3))){return}break}default:{return}}e.val(i+Q.Culture.dateSeparator)}};r.dateInputChange=function(t){if(Q.Culture.dateOrder!=="dmy"){return}var e=$(t.target);if(!e.is(":input")){return}var i=Q.coalesce(e.val(),"");var r={};if(i.length>=6&&ss.Int32.tryParse(i,r)){e.val(i.substr(0,2)+Q.Culture.dateSeparator+i.substr(2,2)+Q.Culture.dateSeparator+i.substr(4))}i=Q.coalesce(e.val(),"");if(!!(i.length>=5&&Q.parseDate(i)!==false)){var n=Q.parseDate(i);e.val(Q.formatDate(n,null))}};__decorate([e()],r.prototype,"yearRange",void 0);__decorate([e()],r.prototype,"get_minValue",null);__decorate([e()],r.prototype,"get_maxValue",null);__decorate([e()],r.prototype,"get_maxDate",null);__decorate([e()],r.prototype,"get_sqlMinMax",null);r=__decorate([t.Decorators.registerEditor("Serenity.DateEditor",[t.IStringValue,t.IReadOnly]),t.Decorators.element('<input type="text"/>')],r);return r}(t.Widget);t.DateEditor=i})(Serenity||(Serenity={}));var Serenity;(function(t){var e=t.Decorators.option;var i=function(i){__extends(r,i);function r(e,r){var a=i.call(this,e,r)||this;e.addClass("dateQ s-DateTimeEditor").datepicker({showOn:"button",beforeShow:function(){return!e.hasClass("readonly")},yearRange:Q.coalesce(a.options.yearRange,"-100:+50")});e.bind("keyup."+a.uniqueName,function(e){if(e.which===32&&!a.get_readOnly()){if(a.get_valueAsDate()!==new Date){a.set_valueAsDate(new Date);a.element.trigger("change")}}else{t.DateEditor.dateInputKeyup(e)}});e.bind("change."+a.uniqueName,t.DateEditor.dateInputChange);a.time=$("<select/>").addClass("editor s-DateTimeEditor time");var o=e.next(".ui-datepicker-trigger");if(o.length>0){a.time.insertAfter(o)}else{o=e.prev(".ui-datepicker-trigger");if(o.length>0){a.time.insertBefore(o)}else{a.time.insertAfter(e)}}var l=n.getTimeOptions(Q.coalesce(a.options.startHour,0),0,Q.coalesce(a.options.endHour,23),59,Q.coalesce(a.options.intervalMinutes,5));for(var s=0,u=l;s<u.length;s++){var c=u[s];Q.addOption(a.time,c,c)}t.VX.addValidationRule(e,a.uniqueName,function(t){var e=a.get_value();if(Q.isEmptyOrNull(e)){return null}if(!Q.isEmptyOrNull(a.get_minValue())&&ss.compareStrings(e,a.get_minValue())<0){return Q.format(Q.text("Validation.MinDate"),Q.formatDate(a.get_minValue(),null))}if(!Q.isEmptyOrNull(a.get_maxValue())&&ss.compareStrings(e,a.get_maxValue())>=0){return Q.format(Q.text("Validation.MaxDate"),Q.formatDate(a.get_maxValue(),null))}return null});a.set_sqlMinMax(true);$("<div class='inplace-button inplace-now'><b></b></div>").attr("title","set to now").insertAfter(a.time).click(function(t){if(a.element.hasClass("readonly")){return}a.set_valueAsDate(new Date);e.triggerHandler("change")});a.time.on("change",function(t){e.triggerHandler("change")});return a}n=r;r.prototype.get_value=function(){var t=this.element.val().trim();if(t!=null&&t.length===0){return null}var e=Q.formatDate(t,"yyyy-MM-dd");var i=this.time.val();var r=e+"T"+i+":00.000";if(this.options.useUtc){r=Q.formatISODateTimeUTC(Q.parseISODateTime(r))}return r};Object.defineProperty(r.prototype,"value",{get:function(){return this.get_value()},set:function(t){this.set_value(t)},enumerable:true,configurable:true});r.prototype.set_value=function(e){if(Q.isEmptyOrNull(e)){this.element.val("");this.time.val("00:00")}else if(e.toLowerCase()==="today"){this.element.val(Q.formatDate(ss.today(),null));this.time.val("00:00")}else{var i=e.toLowerCase()==="now"?new Date:Q.parseISODateTime(e);i=t.DateTimeEditor.roundToMinutes(i,Q.coalesce(this.options.intervalMinutes,5));this.element.val(Q.formatDate(i,null));this.time.val(Q.formatDate(i,"HH:mm"))}};r.prototype.get_valueAsDate=function(){if(Q.isEmptyOrNull(this.get_value())){return null}return Q.parseISODateTime(this.get_value())};Object.defineProperty(r.prototype,"valueAsDate",{get:function(){return this.get_valueAsDate()},set:function(t){this.set_valueAsDate(t)},enumerable:true,configurable:true});r.prototype.set_valueAsDate=function(t){if(t==null){this.set_value(null)}this.set_value(Q.formatDate(t,"yyyy-MM-ddTHH:mm"))};r.prototype.get_minValue=function(){return this.minValue};r.prototype.set_minValue=function(t){this.minValue=t};r.prototype.get_maxValue=function(){return this.maxValue};r.prototype.set_maxValue=function(t){this.maxValue=t};r.prototype.get_minDate=function(){return Q.parseISODateTime(this.get_minValue())};r.prototype.set_minDate=function(t){this.set_minValue(Q.formatDate(t,"yyyy-MM-ddTHH:mm:ss"))};r.prototype.get_maxDate=function(){return Q.parseISODateTime(this.get_maxValue())};r.prototype.set_maxDate=function(t){this.set_maxValue(Q.formatDate(t,"yyyy-MM-ddTHH:mm:ss"))};r.prototype.get_sqlMinMax=function(){return this.get_minValue()==="1753-01-01"&&this.get_maxValue()==="9999-12-31"};r.prototype.set_sqlMinMax=function(t){if(t){this.set_minValue("1753-01-01");this.set_maxValue("9999-12-31")}else{this.set_minValue(null);this.set_maxValue(null)}};r.prototype.get_readOnly=function(){return this.element.hasClass("readonly")};r.prototype.set_readOnly=function(e){if(e!==this.get_readOnly()){if(e){this.element.addClass("readonly").attr("readonly","readonly");this.element.nextAll(".ui-datepicker-trigger").css("opacity","0.1");this.element.nextAll(".inplace-now").css("opacity","0.1")}else{this.element.removeClass("readonly").removeAttr("readonly");this.element.nextAll(".ui-datepicker-trigger").css("opacity","1");this.element.nextAll(".inplace-now").css("opacity","1")}t.EditorUtils.setReadonly(this.time,e)}};r.roundToMinutes=function(t,e){t=new Date(t.getTime());var i=ss.Int32.trunc(ss.round(t.getMinutes()/e)*e);t.setMinutes(i);t.setSeconds(0);t.setMilliseconds(0);return t};var n;r.getTimeOptions=function(t,e,i,r,n){var a=[];if(i>=23){i=23}if(r>=60){r=59}var o=t;var l=e;while(true){if(o>i||o===i&&l>r){break}var s=(o>=10?"":"0")+o+":"+(l>=10?"":"0")+l;a.push(s);l+=n;if(l>=60){l-=60;o++}}return a};__decorate([e()],r.prototype,"get_minValue",null);__decorate([e()],r.prototype,"get_maxValue",null);__decorate([e()],r.prototype,"get_maxDate",null);__decorate([e()],r.prototype,"get_sqlMinMax",null);r=n=__decorate([t.Decorators.registerEditor("Serenity.DateTimeEditor",[t.IStringValue,t.IReadOnly]),t.Decorators.element('<input type="text"/>')],r);return r}(t.Widget);t.DateTimeEditor=i})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(i,r){var n=e.call(this,i,r)||this;n.pageSize=100;n.items=[];n.itemById={};var a=n.emptyItemText();if(a!=null){i.attr("placeholder",a)}var o=n.getSelect2Options();i.select2(o);i.attr("type","text");i.bind("change."+n.uniqueName,function(e,r){if(!!(t.WX.hasOriginalEvent(e)||!r)){if(t.ValidationHelper.getValidator(i)!=null){i.valid()}}});n.setCascadeFrom(n.options.cascadeFrom);if(n.useInplaceAdd())n.addInplaceCreate(Q.text("Controls.SelectEditor.InplaceAdd"),null);return n}i.prototype.destroy=function(){if(this.element!=null){this.element.select2("destroy")}e.prototype.destroy.call(this)};i.prototype.emptyItemText=function(){return Q.coalesce(this.element.attr("placeholder"),Q.text("Controls.SelectEditor.EmptyItemText"))};i.prototype.allowClear=function(){return this.options.allowClear!=null?!!this.options.allowClear:this.emptyItemText()!=null};i.prototype.isMultiple=function(){return!!this.options.multiple};i.prototype.getSelect2Options=function(){var t=this;var e=this.emptyItemText();var i={data:this.items,multiple:this.isMultiple(),placeHolder:!Q.isEmptyOrNull(e)?e:null,allowClear:this.allowClear(),createSearchChoicePosition:"bottom",query:function(e){var i=Q.isEmptyOrNull(e.term)?"":Select2.util.stripDiacritics(Q.coalesce(e.term,"")).toUpperCase();var r=t.items.filter(function(t){return i==null||Q.startsWith(Select2.util.stripDiacritics(Q.coalesce(t.text,"")).toUpperCase(),i)});r.push.apply(r,t.items.filter(function(t){return i!=null&&!Q.startsWith(Select2.util.stripDiacritics(Q.coalesce(t.text,"")).toUpperCase(),i)&&Select2.util.stripDiacritics(Q.coalesce(t.text,"")).toUpperCase().indexOf(i)>=0}));e.callback({results:r.slice((e.page-1)*t.pageSize,e.page*t.pageSize),more:r.length>=e.page*t.pageSize})},initSelection:function(e,i){var r=e.val();var n=t.isAutoComplete();if(t.isMultiple()){var a=[];var o=r.split(",");for(var l=0;l<o.length;l++){var s=o[l];var u=t.itemById[s];if(u==null&&n){u={id:s,text:s};t.addItem(u)}if(u!=null){a.push(u)}}i(a);return}var c=t.itemById[r];if(c==null&&n){c={id:r,text:r};t.addItem(c)}i(c)}};if(this.options.minimumResultsForSearch!=null)i.minimumResultsForSearch=this.options.minimumResultsForSearch;if(this.isAutoComplete()||this.useInplaceAdd())i.createSearchChoice=this.getCreateSearchChoice(null);return i};i.prototype.get_delimited=function(){return!!this.options.delimited};i.prototype.clearItems=function(){ss.clear(this.items);this.itemById={}};i.prototype.addItem=function(t){this.items.push(t);this.itemById[t.id]=t};i.prototype.addOption=function(t,e,i,r){this.addItem({id:t,text:e,source:i,disabled:r})};i.prototype.addInplaceCreate=function(e,i){var r=this;var n=this;e=Q.coalesce(e,Q.text("Controls.SelectEditor.InplaceAdd"));i=Q.coalesce(i,Q.text("Controls.SelectEditor.InplaceEdit"));var a=$("<a><b/></a>").addClass("inplace-button inplace-create").attr("title",e).insertAfter(this.element).click(function(t){n.inplaceCreateClick(t)});this.get_select2Container().add(this.element).addClass("has-inplace-button");t.WX.change(this,function(t){var n=r.isMultiple()||Q.isEmptyOrNull(r.get_value());a.attr("title",n?e:i).toggleClass("edit",!n)});t.WX.changeSelect2(this,function(t){if(r.isMultiple()){var e=r.get_values();if(e.length>0&&e[e.length-1]==(-2147483648).toString()){r.set_values(e.slice(0,e.length-1));r.inplaceCreateClick(t)}}else if(r.get_value()==(-2147483648).toString()){r.set_value(null);r.inplaceCreateClick(t)}});if(this.isMultiple()){this.get_select2Container().on("dblclick."+this.uniqueName,".select2-search-choice",function(t){var e=$(t.target);if(!e.hasClass("select2-search-choice")){e=e.closest(".select2-search-choice")}var i=e.index();var n=r.get_values();if(i<0||i>=r.get_values().length){return}t["editItem"]=n[i];r.inplaceCreateClick(t)})}};i.prototype.useInplaceAdd=function(){return!this.isAutoComplete()&&this.options.inplaceAdd&&(this.options.inplaceAddPermission==null||Q.Authorization.hasPermission(this.options.inplaceAddPermission))};i.prototype.isAutoComplete=function(){return!!this.options.autoComplete};i.prototype.getCreateSearchChoice=function(t){var e=this;return function(i){e.lastCreateTerm=i;i=Q.coalesce(Select2.util.stripDiacritics(i),"").toLowerCase();if(Q.isTrimmedEmpty(i)){return null}if(Q.any(e.get_items(),function(e){var r=t?t(e.source):e.text;return Select2.util.stripDiacritics(Q.coalesce(r,"")).toLowerCase()==i}))return null;if(!Q.any(e.get_items(),function(t){return Q.coalesce(Select2.util.stripDiacritics(t.text),"").toLowerCase().indexOf(i)!==-1})){if(e.isAutoComplete()){return{id:e.lastCreateTerm,text:e.lastCreateTerm}}return{id:(-2147483648).toString(),text:Q.text("Controls.SelectEditor.NoResultsClickToDefine")}}if(e.isAutoComplete()){return{id:e.lastCreateTerm,text:e.lastCreateTerm}}return{id:(-2147483648).toString(),text:Q.text("Controls.SelectEditor.ClickToDefine")}}};i.prototype.setEditValue=function(t,e){var i=t[e.name];if(Q.isArray(i)){this.set_values(i)}else{this.set_value(i==null?null:i.toString())}};i.prototype.getEditValue=function(t,e){if(!this.isMultiple()||this.get_delimited()){e[t.name]=this.get_value()}else{e[t.name]=this.get_values()}};i.prototype.get_select2Container=function(){return this.element.prevAll(".select2-container")};i.prototype.get_items=function(){return this.items};i.prototype.get_itemByKey=function(){return this.itemById};i.prototype.get_value=function(){var t;if(this.element.data("select2")){t=this.element.select2("val");if(t!=null&&Q.isArray(t)){return t.join(",")}}else t=this.element.val();return t};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(t){this.set_value(t)},enumerable:true,configurable:true});i.prototype.set_value=function(t){if(t!=this.get_value()){var e=t;if(!Q.isEmptyOrNull(t)&&this.isMultiple()){e=t.split(String.fromCharCode(44)).map(function(t){return Q.trimToNull(t)}).filter(function(t){return t!=null})}this.element.select2("val",e).triggerHandler("change",[true]);this.updateInplaceReadOnly()}};Object.defineProperty(i.prototype,"selectedItem",{get:function(){var t=this.get_value();if(t&&this.itemById){var e=this.itemById[t];if(e)return e.source}return null},enumerable:true,configurable:true});i.prototype.get_values=function(){var t=this.element.select2("val");if(t==null){return[]}if(Q.isArray(t)){return t}var e=t;if(Q.isEmptyOrNull(e)){return[]}return[e]};Object.defineProperty(i.prototype,"values",{get:function(){return this.get_values()},set:function(t){this.set_values(t)},enumerable:true,configurable:true});i.prototype.set_values=function(t){if(t==null||t.length===0){this.set_value(null);return}this.set_value(t.join(","))};i.prototype.get_text=function(){return Q.coalesce(this.element.select2("data"),{}).text};Object.defineProperty(i.prototype,"text",{get:function(){return this.get_text()},enumerable:true,configurable:true});i.prototype.get_readOnly=function(){return!Q.isEmptyOrNull(this.element.attr("readonly"))};Object.defineProperty(i.prototype,"readOnly",{get:function(){return this.get_readOnly()},set:function(t){this.set_readOnly(t)},enumerable:true,configurable:true});i.prototype.updateInplaceReadOnly=function(){var t=this.get_readOnly()&&(this.isMultiple()||!this.value);this.element.nextAll(".inplace-create").attr("disabled",t?"disabled":"").css("opacity",t?"0.1":"").css("cursor",t?"default":"")};i.prototype.set_readOnly=function(e){if(e!==this.get_readOnly()){t.EditorUtils.setReadonly(this.element,e);this.updateInplaceReadOnly()}};i.prototype.getCascadeFromValue=function(e){return t.EditorUtils.getValue(e)};i.prototype.setCascadeFrom=function(e){var i=this;if(Q.isEmptyOrNull(e)){if(this.cascadeLink!=null){this.cascadeLink.set_parentID(null);this.cascadeLink=null}this.options.cascadeFrom=null;return}this.cascadeLink=new t.CascadedWidgetLink(t.Widget,this,function(t){i.set_cascadeValue(i.getCascadeFromValue(t))});this.cascadeLink.set_parentID(e);this.options.cascadeFrom=e};i.prototype.get_cascadeFrom=function(){return this.options.cascadeFrom};Object.defineProperty(i.prototype,"cascadeFrom",{get:function(){return this.get_cascadeFrom()},set:function(t){this.set_cascadeFrom(t)},enumerable:true,configurable:true});i.prototype.set_cascadeFrom=function(t){if(t!==this.options.cascadeFrom){this.setCascadeFrom(t);this.updateItems()}};i.prototype.get_cascadeField=function(){return Q.coalesce(this.options.cascadeField,this.options.cascadeFrom)};Object.defineProperty(i.prototype,"cascadeField",{get:function(){return this.get_cascadeField()},set:function(t){this.set_cascadeField(t)},enumerable:true,configurable:true});i.prototype.set_cascadeField=function(t){this.options.cascadeField=t};i.prototype.get_cascadeValue=function(){return this.options.cascadeValue};Object.defineProperty(i.prototype,"cascadeValue",{get:function(){return this.get_cascadeValue()},set:function(t){this.set_cascadeValue(t)},enumerable:true,configurable:true});i.prototype.set_cascadeValue=function(t){if(this.options.cascadeValue!==t){this.options.cascadeValue=t;this.set_value(null);this.updateItems()}};i.prototype.get_filterField=function(){return this.options.filterField};Object.defineProperty(i.prototype,"filterField",{get:function(){return this.get_filterField()},set:function(t){this.set_filterField(t)},enumerable:true,configurable:true});i.prototype.set_filterField=function(t){this.options.filterField=t};i.prototype.get_filterValue=function(){return this.options.filterValue};Object.defineProperty(i.prototype,"filterValue",{get:function(){return this.get_filterValue()},set:function(t){this.set_filterValue(t)},enumerable:true,configurable:true});
i.prototype.set_filterValue=function(t){if(this.options.filterValue!==t){this.options.filterValue=t;this.set_value(null);this.updateItems()}};i.prototype.cascadeItems=function(e){var i=this.get_cascadeValue();if(i==null||i===""){if(!Q.isEmptyOrNull(this.get_cascadeField())){return[]}return e}var r=i.toString();var n=this.get_cascadeField();return e.filter(function(e){var i=Q.coalesce(e[n],t.ReflectionUtils.getPropertyValue(e,n));return!!(i!=null&&i.toString()===r)})};i.prototype.filterItems=function(e){var i=this.get_filterValue();if(i==null||i===""){return e}var r=i.toString();var n=this.get_filterField();return e.filter(function(e){var i=Q.coalesce(e[n],t.ReflectionUtils.getPropertyValue(e,n));return!!(i!=null&&i.toString()===r)})};i.prototype.updateItems=function(){};i.prototype.getDialogTypeKey=function(){if(this.options.dialogType!=null){return this.options.dialogType}return null};i.prototype.createEditDialog=function(e){var i=this.getDialogTypeKey();var r=t.DialogTypeRegistry.get(i);t.Widget.create({type:r,init:function(t){return e(t)}})};i.prototype.initNewEntity=function(t){if(!Q.isEmptyOrNull(this.get_cascadeField())){t[this.get_cascadeField()]=this.get_cascadeValue()}if(!Q.isEmptyOrNull(this.get_filterField())){t[this.get_filterField()]=this.get_filterValue()}if(this.onInitNewEntity!=null){this.onInitNewEntity(t)}};i.prototype.setEditDialogReadOnly=function(t){t.element&&t.element.find(".tool-button.delete-button").addClass("disabled").unbind("click")};i.prototype.editDialogDataChange=function(){};i.prototype.setTermOnNewEntity=function(t,e){};i.prototype.inplaceCreateClick=function(e){var i=this;if(this.get_readOnly()&&(this.isMultiple()&&!e["editItem"]||!this.value))return;this.createEditDialog(function(r){if(i.get_readOnly())i.setEditDialogReadOnly(r);t.SubDialogHelper.bindToDataChange(r,i,function(t,e){i.editDialogDataChange();i.updateItems();i.lastCreateTerm=null;if((e.type==="create"||e.type==="update")&&e.entityId!=null){var r=e.entityId.toString();if(i.isMultiple()){var n=i.get_values().slice();if(n.indexOf(r)<0){n.push(r)}i.set_values(null);i.set_values(n.slice())}else{i.set_value(null);i.set_value(r)}}else if(i.isMultiple()&&e.type==="delete"&&e.entityId!=null){var a=e.entityId.toString();var o=i.get_values().slice();var l=o.indexOf(a);if(l>=0)o.splice(l,1);i.set_values(o.slice())}else if(!i.isMultiple()){i.set_value(null)}},true);var n=e["editItem"];if(n!=null){r.load(n,function(){r.dialogOpen(i.openDialogAsPanel)},null)}else if(i.isMultiple()||Q.isEmptyOrNull(i.get_value())){var a={};i.setTermOnNewEntity(a,Q.trimToEmpty(i.lastCreateTerm));i.initNewEntity(a);r.load(a,function(){r.dialogOpen(i.openDialogAsPanel)},null)}else{r.load(i.get_value(),function(){r.dialogOpen(i.openDialogAsPanel)},null)}})};i=__decorate([t.Decorators.registerClass("Serenity.Select2Editor",[t.ISetEditValue,t.IGetEditValue,t.IStringValue,t.IReadOnly]),t.Decorators.element('<input type="hidden"/>')],i);return i}(t.Widget);t.Select2Editor=e;var i=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t,i)||this;r.updateItems();return r}i.prototype.getItems=function(){return this.options.items||[]};i.prototype.emptyItemText=function(){if(!Q.isEmptyOrNull(this.options.emptyOptionText)){return this.options.emptyOptionText}return e.prototype.emptyItemText.call(this)};i.prototype.updateItems=function(){var t=this.getItems();this.clearItems();if(t.length>0){var e=typeof t[0]==="string";for(var i=0,r=t;i<r.length;i++){var n=r[i];var a=e?n:n[0];var o=e?n:Q.coalesce(n[1],n[0]);this.addOption(a,o,n,false)}}};i=__decorate([t.Decorators.registerClass("Serenity.SelectEditor")],i);return i}(e);t.SelectEditor=i})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t,i)||this;r.updateItems();return r}i.prototype.getItems=function(){var t=this.options;if(t.items!=null&&t.items.length>=1){return t.items}var e=[];var i=(new Date).getFullYear();var r=(new Date).getFullYear();t.minYear=Q.coalesce(t.minYear,"-10").toString();if(Q.startsWith(t.minYear,"-")){i-=parseInt(t.minYear.substr(1),10)}else if(Q.startsWith(t.minYear,"+")){i+=parseInt(t.minYear.substr(1),10)}else{i=parseInt(t.minYear,10)}t.maxYear=Q.coalesce(t.maxYear,"+10").toString();if(Q.startsWith(t.maxYear,"-")){r-=parseInt(t.maxYear.substr(1),10)}else if(Q.startsWith(t.maxYear,"+")){r+=parseInt(t.maxYear.substr(1),10)}else{r=parseInt(t.maxYear,10)}if(t.descending){for(var n=r;n>=i;n--){e.push(n.toString())}}else{for(var a=i;a<=r;a++){e.push(a.toString())}}return e};i=__decorate([t.Decorators.registerEditor("Serenity.DateYearEditor")],i);return i}(t.SelectEditor);t.DateYearEditor=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t,i)||this;var n=r;if(!r.isAsyncWidget()){r.updateItems();Q.ScriptData.bindToChange("Lookup."+r.getLookupKey(),r.uniqueName,function(){n.updateItems()})}return r}i.prototype.initializeAsync=function(){var t=this;return this.updateItemsAsync().then(function(){Q.ScriptData.bindToChange("Lookup."+t.getLookupKey(),t.uniqueName,function(){t.updateItemsAsync()})},null)};i.prototype.destroy=function(){Q.ScriptData.unbindFromChange(this.uniqueName);e.prototype.destroy.call(this)};i.prototype.getLookupKey=function(){if(this.options.lookupKey!=null){return this.options.lookupKey}var t=ss.getTypeFullName(ss.getInstanceType(this));var e=t.indexOf(".");if(e>=0){t=t.substring(e+1)}if(Q.endsWith(t,"Editor")){t=t.substr(0,t.length-6)}return t};i.prototype.getLookup=function(){return Q.getLookup(this.getLookupKey())};i.prototype.getLookupAsync=function(){var t=this;return Promise.resolve().then(function(){var e=t.getLookupKey();return Q.getLookupAsync(e)},null)};i.prototype.getItems=function(t){return this.filterItems(this.cascadeItems(t.items))};i.prototype.getItemText=function(t,e){var i=e.textFormatter?e.textFormatter(t):t[e.textField];return i==null?"":i.toString()};i.prototype.getItemDisabled=function(t,e){return false};i.prototype.updateItems=function(){var t=this.getLookup();this.clearItems();var e=this.getItems(t);for(var i=0;i<e.length;i++){var r=e[i];var n=this.getItemText(r,t);var a=this.getItemDisabled(r,t);var o=r[t.idField];var l=o==null?"":o.toString();this.addItem({id:l,text:n,source:r,disabled:a})}};i.prototype.updateItemsAsync=function(){var t=this;return this.getLookupAsync().then(function(e){t.clearItems();var i=t.getItems(e);for(var r=0;r<i.length;r++){var n=i[r];var a=t.getItemText(n,e);var o=t.getItemDisabled(n,e);var l=n[e.idField];var s=l==null?"":l.toString();t.addItem({id:s,text:a,source:n,disabled:o})}},null)};i.prototype.getDialogTypeKey=function(){var t=e.prototype.getDialogTypeKey.call(this);if(t)return t;return this.getLookupKey()};i.prototype.setCreateTermOnNewEntity=function(t,e){t[this.getLookup().textField]=e};i.prototype.editDialogDataChange=function(){Q.reloadLookup(this.getLookupKey())};i=__decorate([t.Decorators.registerEditor("Serenity.LookupEditorBase")],i);return i}(t.Select2Editor);t.LookupEditorBase=e;var i=function(e){__extends(i,e);function i(t,i){return e.call(this,t,i)||this}i=__decorate([t.Decorators.registerEditor("Serenity.LookupEditor")],i);return i}(e);t.LookupEditor=i})(Serenity||(Serenity={}));var Serenity;(function(t){var e=t.Decorators.option;var i;(function(e){var i;function r(t){if(Q.isEmptyOrNull(t)){throw new ss.ArgumentNullException("key")}n();var e=i[t.toLowerCase()];if(e==null){var r=Q.typeByFullName(t);if(r!=null){i[t.toLowerCase()]=r;return r}throw new ss.Exception(Q.format("Can't find {0} editor type!",t))}return e}e.get=r;function n(){if(i!=null)return;i={};var e=ss.getAssemblies();for(var r=0,n=e;r<n.length;r++){var a=n[r];for(var l=0,s=ss.getAssemblyTypes(a);l<s.length;l++){var u=s[l];if(!(u.prototype instanceof t.Widget)){continue}if(ss.isGenericTypeDefinition(u)){continue}var c=ss.getTypeFullName(u).toLowerCase();i[c]=u;var d=ss.getAttributes(u,t.EditorAttribute,false);if(d!=null&&d.length>0){var f=d[0].key;if(!Q.isEmptyOrNull(f)){i[f.toLowerCase()]=u}}for(var p=0,h=Q.Config.rootNamespaces;p<h.length;p++){var g=h[p];if(Q.startsWith(c,g.toLowerCase()+".")){var v=c.substr(g.length+1).toLowerCase();if(i[v]==null){i[v]=u}}}}}o()}function a(){i=null}e.reset=a;function o(){var t="editor";var e=Object.keys(i);for(var r=0,n=e;r<n.length;r++){var a=n[r];l(a,i[a])}}function l(t,e){var r="editor";if(!Q.endsWith(t,r))return;var n=t.substr(0,t.length-r.length);if(Q.isEmptyOrNull(n))return;if(i[n]!=null)return;i[n]=i[t]}})(i=t.EditorTypeRegistry||(t.EditorTypeRegistry={}));var r;(function(e){function i(t){var e=t.element.data("select2");if(e!=null){var i=t.element.select2("data");if(i==null)return"";return Q.coalesce(i.text,"")}var r=n(t);if(r==null){return""}if(typeof r==="string")return r;if(r instanceof Boolean)return!!r?Q.coalesce(Q.tryGetText("Controls.FilterPanel.OperatorNames.true"),"True"):Q.coalesce(Q.tryGetText("Controls.FilterPanel.OperatorNames.true"),"False");return r.toString()}e.getDisplayText=i;var r={name:"_"};function n(t){var e={};a(t,r,e);return e["_"]}e.getValue=n;function a(e,i,r){var n=ss.safeCast(e,t.IGetEditValue);if(n!=null){n.getEditValue(i,r);return}var a=ss.safeCast(e,t.IStringValue);if(a!=null){r[i.name]=a.get_value();return}var o=ss.safeCast(e,t.IBooleanValue);if(o!=null){r[i.name]=o.get_value();return}var l=ss.safeCast(e,t.IDoubleValue);if(l!=null){var s=l.get_value();r[i.name]=isNaN(s)?null:s;return}if(e.getEditValue!=null){e.getEditValue(i,r);return}if(e.element.is(":input")){r[i.name]=e.element.val();return}}e.saveValue=a;function o(t,e){var i={_:e};l(t,r,i)}e.setValue=o;function l(e,i,r){var n=ss.safeCast(e,t.ISetEditValue);if(n!=null){n.setEditValue(r,i);return}var a=ss.safeCast(e,t.IStringValue);if(a!=null){var o=r[i.name];if(o!=null){o=o.toString()}a.set_value(ss.cast(o,String));return}var l=ss.safeCast(e,t.IBooleanValue);if(l!=null){var s=r[i.name];if(typeof s==="number"){l.set_value(s>0)}else{l.set_value(!!s)}return}var u=ss.safeCast(e,t.IDoubleValue);if(u!=null){var c=r[i.name];if(!!(c==null||ss.isInstanceOfType(c,String)&&Q.isTrimmedEmpty(ss.cast(c,String)))){u.set_value(null)}else if(ss.isInstanceOfType(c,String)){u.set_value(ss.cast(Q.parseDecimal(ss.cast(c,String)),Number))}else if(ss.isInstanceOfType(c,Boolean)){u.set_value(!!c?1:0)}else{u.set_value(ss.cast(c,Number))}return}if(e.setEditValue!=null){e.setEditValue(r,i);return}if(e.element.is(":input")){var d=r[i.name];if(d==null){e.element.val("")}else{e.element.val(d)}return}}e.loadValue=l;function s(t,e){t.each(function(t,i){var r=$(i);var n=r.attr("type");if(r.is("select")||n==="radio"||n==="checkbox"){if(e){r.addClass("readonly").attr("disabled","disabled")}else{r.removeClass("readonly").removeAttr("disabled")}}else if(e){r.addClass("readonly").attr("readonly","readonly")}else{r.removeClass("readonly").removeAttr("readonly")}return true});return t}e.setReadonly=s;function u(e,i){var r=ss.safeCast(e,t.IReadOnly);if(r!=null){r.set_readOnly(i)}else if(e.element.is(":input")){s(e.element,i)}}e.setReadOnly=u;function c(e,i){var r=ss.safeCast(e,t.IValidateRequired);if(r!=null){r.set_required(i)}else if(e.element.is(":input")){e.element.toggleClass("required",!!i)}var n=t.WX.getGridField(e);var a=n.find("sup").get().length>0;if(i&&!a){$("<sup>*</sup>").attr("title",Q.text("Controls.PropertyGrid.RequiredHint")).prependTo(n.find(".caption")[0])}else if(!i&&a){$(n.find("sup")[0]).remove()}}e.setRequired=c})(r=t.EditorUtils||(t.EditorUtils={}));function n(e,i){return t.Decorators.registerEditor("Serenity."+e+"Editor",i)}var a=t.Decorators.element;var o=function(e){__extends(i,e);function i(t){var i=e.call(this,t)||this;t.removeClass("flexify");return i}Object.defineProperty(i.prototype,"value",{get:function(){return this.element.is(":checked")},set:function(t){this.element.prop("checked",!!t)},enumerable:true,configurable:true});i.prototype.get_value=function(){return this.value};i.prototype.set_value=function(t){this.value=t};i=__decorate([n("Boolean",[t.IBooleanValue]),a('<input type="checkbox"/>')],i);return i}(t.Widget);t.BooleanEditor=o;var l=function(e){__extends(i,e);function i(i,r){var n=e.call(this,i,r)||this;i.addClass("decimalQ");var a=$.extend(t.DecimalEditor.defaultAutoNumericOptions(),{vMin:Q.coalesce(n.options.minValue,n.options.allowNegatives?n.options.maxValue!=null?"-"+n.options.maxValue:"-999999999999.99":"0.00"),vMax:Q.coalesce(n.options.maxValue,"999999999999.99")});if(n.options.decimals!=null){a.mDec=n.options.decimals}if(n.options.padDecimals!=null){a.aPad=n.options.padDecimals}i.autoNumeric(a);return n}i.prototype.get_value=function(){var t=this.element.autoNumeric("get");if(!!(t==null||t===""))return null;return parseFloat(t)};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(t){this.set_value(t)},enumerable:true,configurable:true});i.prototype.set_value=function(t){if(t==null||t===""){this.element.val("")}else{this.element.autoNumeric("set",t)}};i.prototype.get_isValid=function(){return!isNaN(this.get_value())};i.defaultAutoNumericOptions=function(){return{aDec:Q.Culture.decimalSeparator,altDec:Q.Culture.decimalSeparator==="."?",":".",aSep:Q.Culture.decimalSeparator==="."?",":".",aPad:true}};i=__decorate([n("Decimal",[t.IDoubleValue]),a('<input type="text"/>')],i);return i}(t.Widget);t.DecimalEditor=l;var s=function(e){__extends(i,e);function i(i,r){var n=e.call(this,i,r)||this;i.addClass("integerQ");var a=$.extend(t.DecimalEditor.defaultAutoNumericOptions(),{vMin:Q.coalesce(n.options.minValue,n.options.allowNegatives?n.options.maxValue!=null?"-"+n.options.maxValue:"-2147483647":"0"),vMax:Q.coalesce(n.options.maxValue,2147483647),aSep:null});i.autoNumeric(a);return n}i.prototype.get_value=function(){var t=this.element.autoNumeric("get");if(!!Q.isTrimmedEmpty(t)){return null}else{return parseInt(t,10)}};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(t){this.set_value(t)},enumerable:true,configurable:true});i.prototype.set_value=function(t){if(t==null||t===""){this.element.val("")}else{this.element.autoNumeric("set",t)}};i.prototype.get_isValid=function(){return!isNaN(this.get_value())};i=__decorate([n("Integer",[t.IDoubleValue]),a('<input type="text"/>')],i);return i}(t.Widget);t.IntegerEditor=s;var u=function(e){__extends(i,e);function i(t,i){var n=e.call(this,t,i)||this;r.registerValidationMethods();t.addClass("emailuser").removeClass("flexify");var a=$("<span/>").text("@").addClass("emailat").insertAfter(t);var o=$('<input type="text"/>').addClass("emaildomain").addClass("flexify").insertAfter(a);o.bind("blur."+n.uniqueName,function(){var e=o.closest("form").data("validator");if(e!=null){e.element(t[0])}});if(!Q.isEmptyOrNull(n.options.domain)){o.val(n.options.domain)}if(n.options.readOnlyDomain){o.attr("readonly","readonly").addClass("disabled").attr("tabindex","-1")}t.bind("keypress."+n.uniqueName,function(t){if(t.which===64){t.preventDefault();if(!n.options.readOnlyDomain){o.focus();o.select()}}});o.bind("keypress."+n.uniqueName,function(t){if(t.which===64){t.preventDefault()}});if(!n.options.readOnlyDomain){t.change(function(e){return n.set_value(t.val())})}return n}r=i;i.registerValidationMethods=function(){if($.validator.methods["emailuser"]!=null)return;$.validator.addMethod("emailuser",function(t,e){var i=$(e).nextAll(".emaildomain");if(i.length>0&&i.attr("readonly")==null){if(this.optional(e)&&this.optional(i[0])){return true}t=t+"@"+i.val();if(Q.Config.emailAllowOnlyAscii){return new RegExp("^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}"+"[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$").test(t)}return new RegExp("^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|"+"[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|"+"[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|"+"((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|"+"\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|"+"[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|"+"[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])"+"([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)"+"+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|"+"[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))$","i").test(t)}else{if(Q.Config.emailAllowOnlyAscii){return this.optional(e)||new RegExp("^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+$").test(t)}return this.optional(e)||new RegExp("^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+"+"(\\.([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*"+"(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-"+"\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*"+"(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))$","i").test(t)}},Q.text("Validation.Email"))};i.prototype.get_value=function(){var t=this.element.nextAll(".emaildomain");var e=this.element.val();var i=t.val();if(Q.isEmptyOrNull(e)){if(this.options.readOnlyDomain||Q.isEmptyOrNull(i)){return""}return"@"+i}return e+"@"+i};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(t){this.set_value(t)},enumerable:true,configurable:true});i.prototype.set_value=function(t){var e=this.element.nextAll(".emaildomain");t=Q.trimToNull(t);if(t==null){if(!this.options.readOnlyDomain){e.val("")}this.element.val("")}else{var i=t.split("@");if(i.length>1){if(!this.options.readOnlyDomain){e.val(i[1]);this.element.val(i[0])}else if(!Q.isEmptyOrNull(this.options.domain)){if(i[1]!==this.options.domain){this.element.val(t)}else{this.element.val(i[0])}}else{this.element.val(i[0])}}else{this.element.val(i[0])}}};i.prototype.get_readOnly=function(){var t=this.element.nextAll(".emaildomain");return!(this.element.attr("readonly")==null&&(!this.options.readOnlyDomain||t.attr("readonly")==null))};i.prototype.set_readOnly=function(t){var e=this.element.nextAll(".emaildomain");if(t){this.element.attr("readonly","readonly").addClass("readonly");if(!this.options.readOnlyDomain){e.attr("readonly","readonly").addClass("readonly")}}else{this.element.removeAttr("readonly").removeClass("readonly");if(!this.options.readOnlyDomain){e.removeAttr("readonly").removeClass("readonly")}}};var r;i=r=__decorate([n("Email",[t.IStringValue,t.IReadOnly]),a('<input type="text"/>')],i);return i}(t.Widget);t.EmailEditor=u;var c=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t,i)||this;r.updateItems();return r}i.prototype.updateItems=function(){this.clearItems();var e=this.options.enumType||t.EnumTypeRegistry.get(this.options.enumKey);var i=this.options.enumKey;if(i==null&&e!=null){var r=ss.getAttributes(e,t.EnumKeyAttribute,false);if(r.length>0){i=r[0].value}}var n=ss.Enum.getValues(e);for(var a=0,o=n;a<o.length;a++){var l=o[a];var s=ss.Enum.toString(e,l);this.addOption(ss.cast(l,ss.Int32).toString(),Q.coalesce(Q.tryGetText("Enums."+i+"."+s),s),null,false)}};i.prototype.allowClear=function(){return Q.coalesce(this.options.allowClear,true)};i=__decorate([n("Enum")],i);return i}(t.Select2Editor);t.EnumEditor=c;var d=function(e){__extends(i,e);function i(i,r){var n=e.call(this,i,r)||this;var a=new google.maps.LatLng(Q.coalesce(n.options.latitude,0),Q.coalesce(n.options.longitude,0));var o=new Object;o.center=a;o.mapTypeId=Q.coalesce(n.options.mapTypeId,"roadmap");o.zoom=Q.coalesce(n.options.zoom,15);o.zoomControl=true;n.map=new google.maps.Map(i[0],o);if(n.options.markerTitle!=null){var l=new Object;var s=n.options.markerLatitude;if(s==null){s=Q.coalesce(n.options.latitude,0)}var u=n.options.markerLongitude;if(u==null){u=Q.coalesce(n.options.longitude,0)}l.position=new google.maps.LatLng(s,u);l.map=n.map;l.title=n.options.markerTitle;l.animation=2;new google.maps.Marker(l)}t.LazyLoadHelper.executeOnceWhenShown(i,function(){google.maps.event.trigger(n.map,"resize",[]);n.map.setCenter(a)});return n}i.prototype.get_map=function(){return this.map};i=__decorate([n("GoogleMap",[]),a("<div/>")],i);return i}(t.Widget);t.GoogleMap=d;var f=function(e){__extends(i,e);function i(i,n){var a=e.call(this,i,n)||this;a._instanceReady=false;r.includeCKEditor();var o=i.attr("id");if(Q.isTrimmedEmpty(o)){i.attr("id",a.uniqueName);o=a.uniqueName}if(a.options.cols!=null)i.attr("cols",a.options.cols);if(a.options.rows!=null)i.attr("rows",a.options.rows);a.addValidationRule(a.uniqueName,function(t){if(t.hasClass("required")){var e=Q.trimToNull(a.get_value());if(e==null)return Q.text("Validation.Required")}return null});t.LazyLoadHelper.executeOnceWhenShown(a.element,function(){var t=a.getConfig();window["CKEDITOR"]&&window["CKEDITOR"].replace(o,t)});return a}r=i;i.prototype.instanceReady=function(t){this._instanceReady=true;$(t.editor.container.$).addClass(this.element.attr("class"));this.element.addClass("select2-offscreen").css("display","block");t.editor.setData(this.element.val());t.editor.setReadOnly(this.get_readOnly())};i.prototype.getLanguage=function(){if(!window["CKEDITOR"])return"en";var t=window["CKEDITOR"];var e=Q.coalesce(Q.trimToNull($("html").attr("lang")),"en");if(!!t.lang.languages[e]){return e}if(e.indexOf(String.fromCharCode(45))>=0){e=e.split(String.fromCharCode(45))[0]}if(!!t.lang.languages[e]){return e}return"en"};i.prototype.getConfig=function(){var t=this;return{customConfig:"",language:this.getLanguage(),bodyClass:"s-HtmlContentBody",on:{instanceReady:function(e){return t.instanceReady(e)},change:function(e){e.editor.updateElement();t.element.triggerHandler("change")}},toolbarGroups:[{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker"]},{name:"insert",groups:["links","insert","blocks","bidi","list","indent"]},{name:"forms",groups:["forms","mode","document","doctools","others","about","tools"]},{name:"colors"},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"align"},{name:"styles"}],removeButtons:"SpecialChar,Anchor,Subscript,Styles",format_tags:"p;h1;h2;h3;pre",removeDialogTabs:"image:advanced;link:advanced",removePlugins:"uploadimage,image2",contentsCss:Q.resolveUrl("~/Content/site/site.htmlcontent.css"),entities:false,entities_latin:false,entities_greek:false,autoUpdateElement:true,height:this.options.rows==null||this.options.rows===0?null:this.options.rows*20+"px"}};i.prototype.getEditorInstance=function(){var t=this.element.attr("id");return window["CKEDITOR"].instances[t]};i.prototype.destroy=function(){var t=this.getEditorInstance();t&&t.destroy(true);e.prototype.destroy.call(this)};i.prototype.get_value=function(){var t=this.getEditorInstance();if(this._instanceReady&&t){return t.getData()}else{return this.element.val()}};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(t){this.set_value(t)},enumerable:true,configurable:true});i.prototype.set_value=function(t){var e=this.getEditorInstance();this.element.val(t);if(this._instanceReady&&e)e.setData(t)};i.prototype.get_readOnly=function(){return!Q.isEmptyOrNull(this.element.attr("disabled"))};i.prototype.set_readOnly=function(t){if(this.get_readOnly()!==t){if(t){this.element.attr("disabled","disabled")}else{this.element.removeAttr("disabled")}var e=this.getEditorInstance();if(this._instanceReady&&e)e.setReadOnly(t)}};i.includeCKEditor=function(){if(window["CKEDITOR"]){return}var t=$("#CKEditorScript");if(t.length>0){return}$("<script/>").attr("type","text/javascript").attr("id","CKEditorScript").attr("src",Q.resolveUrl("~/Scripts/CKEditor/ckeditor.js?v="+r.CKEditorVer)).appendTo(window.document.head)};var r;i.CKEditorVer="4.7.1";i=r=__decorate([n("HtmlContent",[t.IStringValue,t.IReadOnly]),a("<textarea/>")],i);return i}(t.Widget);t.HtmlContentEditor=f;var p=function(t){__extends(e,t);function e(e,i){return t.call(this,e,i)||this}e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);e.removeButtons+=",Cut,Copy,Paste,BulletedList,NumberedList,"+"Indent,Outdent,SpecialChar,Subscript,Superscript,Styles,PasteText,"+"PasteFromWord,Strike,Link,Unlink,CreatePlaceholder,Image,Table,"+"HorizontalRule,Source,Maximize,Format,Font,FontSize,Anchor,Blockquote,"+"CreatePlaceholder,BGColor,JustifyLeft,JustifyCenter,"+"JustifyRight,JustifyBlock,Superscript,RemoveFormat";e.removePlugins="elementspath,uploadimage,image2";return e};e=__decorate([n("HtmlNoteContent")],e);return e}(f);t.HtmlNoteContentEditor=p;var h=function(t){__extends(e,t);function e(e,i){return t.call(this,e,i)||this}e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);e.removeButtons+=",Cut,Copy,Paste,BulletedList,NumberedList,"+"Indent,Outdent,SpecialChar,Subscript,Superscript,Styles,"+"PasteText,PasteFromWord,Strike,Link,Unlink,CreatePlaceholder,"+"Image,Table,HorizontalRule,Source,Maximize,Format,Font,FontSize,"+"Anchor,Blockquote,CreatePlaceholder,BGColor,JustifyLeft,JustifyCenter,"+"JustifyRight,JustifyBlock,Superscript,RemoveFormat";e.removePlugins="elementspath,uploadimage,image2";return e};e=__decorate([n("HtmlReportContent")],e);return e}(f);t.HtmlReportContentEditor=h;var g=function(e){__extends(i,e);function i(i,r){var n=e.call(this,i,r)||this;i.addClass("s-ImageUploadEditor");if(Q.isEmptyOrNull(n.options.originalNameProperty))i.addClass("hide-original-name");n.toolbar=new t.Toolbar($("<div/>").appendTo(n.element),{buttons:n.getToolButtons()});var a=$("<div><div></div></div>").addClass("upload-progress").prependTo(n.toolbar.element);var o=n.getUploadInputOptions();n.uploadInput=t.UploadHelper.addUploadInput(o);n.fileSymbols=$("<ul/>").appendTo(n.element);n.updateInterface();return n}i.prototype.getUploadInputOptions=function(){var e=this;return{container:this.toolbar.findButton("add-file-button"),zone:this.element,inputName:this.uniqueName,progress:this.progress,fileDone:function(i,r,n){if(!t.UploadHelper.checkImageConstraints(i,e.options)){return}var a={OriginalName:r,Filename:i.TemporaryFile};e.entity=a;e.populate();e.updateInterface()}}};i.prototype.addFileButtonText=function(){return Q.text("Controls.ImageUpload.AddFileButton")};i.prototype.getToolButtons=function(){var t=this;return[{title:this.addFileButtonText(),cssClass:"add-file-button",onClick:function(){}},{title:"",hint:Q.text("Controls.ImageUpload.DeleteButtonHint"),cssClass:"delete-button",onClick:function(){t.entity=null;t.populate();t.updateInterface()}}]};i.prototype.populate=function(){var e=this.options.displayFileName||!Q.isTrimmedEmpty(this.options.originalNameProperty);if(this.entity==null){t.UploadHelper.populateFileSymbols(this.fileSymbols,null,e,this.options.urlPrefix)}else{t.UploadHelper.populateFileSymbols(this.fileSymbols,[this.entity],e,this.options.urlPrefix)}};i.prototype.updateInterface=function(){var t=this.toolbar.findButton("add-file-button");var e=this.toolbar.findButton("delete-button");t.toggleClass("disabled",this.get_readOnly());e.toggleClass("disabled",this.get_readOnly()||this.entity==null)};i.prototype.get_readOnly=function(){return this.uploadInput.attr("disabled")!=null};i.prototype.set_readOnly=function(t){if(this.get_readOnly()!==t){if(t){this.uploadInput.attr("disabled","disabled").fileupload("disable")}else{this.uploadInput.removeAttr("disabled").fileupload("enable")}this.updateInterface()}};i.prototype.get_value=function(){if(this.entity==null){return null}var t=$.extend({},this.entity);return t};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(t){this.set_value(t)},enumerable:true,configurable:true});i.prototype.set_value=function(t){if(t!=null){if(t.Filename==null){this.entity=null}else{this.entity=$.extend({},t)}}else{this.entity=null}this.populate();this.updateInterface()};i.prototype.getEditValue=function(t,e){e[t.name]=this.entity==null?null:Q.trimToNull(this.entity.Filename)};i.prototype.setEditValue=function(t,e){var i={};i.Filename=t[e.name];if(Q.isEmptyOrNull(this.options.originalNameProperty)){if(this.options.displayFileName){var r=Q.coalesce(i.Filename,"");var n=ss.lastIndexOfAnyString(r,[47,92]);if(n>=0){i.OriginalName=r.substr(n+1)}else{i.OriginalName=r}}}else{i.OriginalName=t[this.options.originalNameProperty]}this.set_value(i)};i=__decorate([n("ImageUpload",[t.IReadOnly]),a("<div/>")],i);return i}(t.Widget);t.ImageUploadEditor=g;var v=function(i){__extends(r,i);function r(e,r){var n=i.call(this,e,r)||this;n.entities=[];e.addClass("s-MultipleImageUploadEditor");var a=n;n.toolbar=new t.Toolbar($("<div/>").appendTo(n.element),{buttons:n.getToolButtons()});var o=$("<div><div></div></div>").addClass("upload-progress").prependTo(n.toolbar.element);var l=n.toolbar.findButton("add-file-button");n.uploadInput=t.UploadHelper.addUploadInput({container:l,zone:n.element,inputName:n.uniqueName,progress:o,fileDone:function(e,i,r){if(!t.UploadHelper.checkImageConstraints(e,n.options)){return}var o={OriginalName:i,Filename:e.TemporaryFile};a.entities.push(o);a.populate();a.updateInterface()}});n.fileSymbols=$("<ul/>").appendTo(n.element);n.updateInterface();return n}r.prototype.addFileButtonText=function(){return Q.text("Controls.ImageUpload.AddFileButton")};r.prototype.getToolButtons=function(){return[{title:this.addFileButtonText(),cssClass:"add-file-button",onClick:function(){}}]};r.prototype.populate=function(){var e=this;t.UploadHelper.populateFileSymbols(this.fileSymbols,this.entities,true,this.options.urlPrefix);this.fileSymbols.children().each(function(t,i){var r=t;$("<a class='delete'></a>").appendTo($(i).children(".filename")).click(function(t){t.preventDefault();ss.removeAt(e.entities,r);e.populate()})})};r.prototype.updateInterface=function(){var t=this.toolbar.findButton("add-file-button");t.toggleClass("disabled",this.get_readOnly());this.fileSymbols.find("a.delete").toggle(!this.get_readOnly())};r.prototype.get_readOnly=function(){return this.uploadInput.attr("disabled")!=null};r.prototype.set_readOnly=function(t){if(this.get_readOnly()!==t){if(t){this.uploadInput.attr("disabled","disabled").fileupload("disable")}else{this.uploadInput.removeAttr("disabled").fileupload("enable")}this.updateInterface()}};r.prototype.get_value=function(){return this.entities.map(function(t){return $.extend({},t)})};Object.defineProperty(r.prototype,"value",{get:function(){return this.get_value()},set:function(t){this.set_value(t)},enumerable:true,configurable:true});r.prototype.set_value=function(t){this.entities=(t||[]).map(function(t){return $.extend({},t)});this.populate();this.updateInterface()};r.prototype.getEditValue=function(t,e){if(this.jsonEncodeValue){e[t.name]=$.toJSON(this.get_value())}else{e[t.name]=this.get_value()}};r.prototype.setEditValue=function(t,e){var i=t[e.name];if(ss.isInstanceOfType(i,String)){var r=Q.coalesce(Q.trimToNull(i),"[]");if(Q.startsWith(r,"[")&&Q.endsWith(r,"]")){this.set_value($.parseJSON(r))}else{this.set_value([{Filename:r,OriginalName:"UnknownFile"}])}}else{this.set_value(i)}};__decorate([e()],r.prototype,"jsonEncodeValue",void 0);r=__decorate([n("MultipleImageUpload",[t.IReadOnly]),a("<div/>")],r);return r}(t.Widget);t.MultipleImageUploadEditor=v;var y=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t,i)||this;t.mask(r.options.mask||"",{placeholder:Q.coalesce(r.options.placeholder,"_")});return r}Object.defineProperty(i.prototype,"value",{get:function(){this.element.triggerHandler("blur.mask");return this.element.val()},set:function(t){this.element.val(t)
},enumerable:true,configurable:true});i.prototype.get_value=function(){return this.value};i.prototype.set_value=function(t){this.value=t};i=__decorate([n("Masked",[t.IStringValue]),a('<input type="text"/>')],i);return i}(t.Widget);t.MaskedEditor=y;var m=function(e){__extends(i,e);function i(t){return e.call(this,t)||this}Object.defineProperty(i.prototype,"value",{get:function(){return this.element.val()},set:function(t){this.element.val(t)},enumerable:true,configurable:true});i.prototype.get_value=function(){return this.value};i.prototype.set_value=function(t){this.value=t};i=__decorate([n("String",[t.IStringValue]),a('<input type="text"/>')],i);return i}(t.Widget);t.StringEditor=m;var b=function(t){__extends(e,t);function e(e){var i=t.call(this,e)||this;e.attr("type","email").addClass("email");return i}e=__decorate([n("EmailAddress")],e);return e}(t.StringEditor);t.EmailAddressEditor=b;var C=function(t){__extends(e,t);function e(e){var i=t.call(this,e)||this;e.attr("type","password");return i}e=__decorate([n("Password")],e);return e}(m);t.PasswordEditor=C;var _=function(e){__extends(i,e);function i(i,r){var n=e.call(this,i,r)||this;if(Q.isEmptyOrNull(n.options.enumKey)&&n.options.enumType==null&&Q.isEmptyOrNull(n.options.lookupKey)){return n}if(!Q.isEmptyOrNull(n.options.lookupKey)){var a=Q.getLookup(n.options.lookupKey);for(var o=0,l=a.items;o<l.length;o++){var s=l[o];var u=s[a.textField];var c=u==null?"":u.toString();var d=s[a.idField];var f=d==null?"":d.toString();n.addRadio(f,c)}}else{var p=n.options.enumType||t.EnumTypeRegistry.get(n.options.enumKey);var h=n.options.enumKey;if(h==null&&p!=null){var g=ss.getAttributes(p,t.EnumKeyAttribute,false);if(g.length>0){h=g[0].value}}var v=ss.Enum.getValues(p);for(var y=0,m=v;y<m.length;y++){var b=m[y];var C=ss.Enum.toString(p,b);n.addRadio(b.toString(),Q.coalesce(Q.tryGetText("Enums."+h+"."+C),C))}}return n}i.prototype.addRadio=function(t,e){var i=$("<label/>").text(e);$('<input type="radio"/>').attr("name",this.uniqueName).attr("id",this.uniqueName+"_"+t).attr("value",t).prependTo(i);i.appendTo(this.element)};i.prototype.get_value=function(){return this.element.find("input:checked").first().val()};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(t){this.set_value(t)},enumerable:true,configurable:true});i.prototype.set_value=function(t){if(t!==this.get_value()){var e=this.element.find("input");var i=e.filter(":checked");if(i.length>0){i[0].checked=false}if(!Q.isEmptyOrNull(t)){i=e.filter("[value="+t+"]");if(i.length>0){i[0].checked=true}}}};i.prototype.get_readOnly=function(){return this.element.attr("disabled")!=null};i.prototype.set_readOnly=function(t){if(this.get_readOnly()!==t){if(t){this.element.attr("disabled","disabled").find("input").attr("disabled","disabled")}else{this.element.removeAttr("disabled").find("input").removeAttr("disabled")}}};i=__decorate([n("RadioButton",[t.IStringValue,t.IReadOnly]),a("<div/>")],i);return i}(t.Widget);t.RadioButtonEditor=_;var x=function(e){__extends(i,e);function i(i,r){var n=e.call(this,i,r)||this;n.element.addClass("g-recaptcha").attr("data-sitekey",n.options.siteKey);if(!!(window["grecaptcha"]==null&&$("script#RecaptchaInclude").length===0)){var a="https://www.google.com/recaptcha/api.js";var o=n.options.language;if(o==null){o=Q.coalesce($("html").attr("lang"),"")}a+="?hl="+o;$("<script/>").attr("id","RecaptchaInclude").attr("src",a).appendTo(document.body)}var l=$("<input />").insertBefore(n.element).attr("id",n.uniqueName+"_validate").val("x");var s={};s["visibility"]="hidden";s["width"]="0px";s["height"]="0px";s["padding"]="0px";var u=l.css(s);var c=n;t.VX.addValidationRule(u,n.uniqueName,function(t){if(Q.isEmptyOrNull(n.get_value())){return Q.text("Validation.Required")}return null});return n}i.prototype.get_value=function(){return this.element.find(".g-recaptcha-response").val()};i.prototype.set_value=function(t){};i=__decorate([t.Decorators.registerEditor("Serenity.Recaptcha",[t.IStringValue]),t.Decorators.element("<div/>")],i);return i}(t.Widget);t.Recaptcha=x;var S=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t,i)||this;if(r.options.cols!==0){t.attr("cols",Q.coalesce(r.options.cols,80))}if(r.options.rows!==0){t.attr("rows",Q.coalesce(r.options.rows,6))}return r}Object.defineProperty(i.prototype,"value",{get:function(){return this.element.val()},set:function(t){this.element.val(t)},enumerable:true,configurable:true});i.prototype.get_value=function(){return this.value};i.prototype.set_value=function(t){this.value=t};i=__decorate([n("TextArea",[t.IStringValue]),a("<textarea />")],i);return i}(t.Widget);t.TextAreaEditor=S;var w=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t,i)||this;t.addClass("editor s-TimeEditor hour");if(!r.options.noEmptyOption){Q.addOption(t,"","--")}for(var n=r.options.startHour||0;n<=(r.options.endHour||23);n++){Q.addOption(t,n.toString(),n<10?"0"+n:n.toString())}r.minutes=$("<select/>").addClass("editor s-TimeEditor minute").insertAfter(t);r.minutes.change(function(){return r.element.trigger("change")});for(var a=0;a<=59;a+=r.options.intervalMinutes||5){Q.addOption(r.minutes,a.toString(),a<10?"0"+a:a.toString())}return r}Object.defineProperty(i.prototype,"value",{get:function(){var t=Q.toId(this.element.val());var e=Q.toId(this.minutes.val());if(t==null||e==null){return null}return t*60+e},set:function(t){if(!t){if(this.options.noEmptyOption){this.element.val(this.options.startHour);this.minutes.val("0")}else{this.element.val("");this.minutes.val("0")}}else{this.element.val(Math.floor(t/60).toString());this.minutes.val(t%60)}},enumerable:true,configurable:true});i.prototype.get_value=function(){return this.value};i.prototype.set_value=function(t){this.value=t};i.prototype.get_readOnly=function(){return this.element.hasClass("readonly")};i.prototype.set_readOnly=function(e){if(e!==this.get_readOnly()){if(e){this.element.addClass("readonly").attr("readonly","readonly")}else{this.element.removeClass("readonly").removeAttr("readonly")}t.EditorUtils.setReadonly(this.minutes,e)}};i=__decorate([n("Time",[t.IDoubleValue,t.IReadOnly]),a("<select />")],i);return i}(t.Widget);t.TimeEditor=w;var T=function(e){__extends(i,e);function i(t){var i=e.call(this,t)||this;t.addClass("url").attr("title","URL should be entered in format: 'http://www.site.com/page'.");t.on("blur."+i.uniqueName,function(e){var i=t.closest("form").data("validator");if(i==null)return;if(!t.hasClass("error"))return;var r=Q.trimToNull(t.val());if(!r)return;r="http://"+r;if($.validator.methods["url"].call(i,r,t[0])==true){t.val(r);i.element(t)}});return i}i=__decorate([n("URL",[t.IStringValue])],i);return i}(m);t.URLEditor=T;var I=function(e){__extends(i,e);function i(i,r){var n=e.call(this,i,r)||this;n.pageSize=50;var a=n.emptyItemText();if(a!=null)i.attr("placeholder",a);i.select2(n.getSelect2Options());i.attr("type","text");i.on("change."+n.uniqueName,function(e,r){if(t.WX.hasOriginalEvent(e)||!r){if(t.ValidationHelper.getValidator(i)!=null)i.valid()}});return n}i.prototype.emptyItemText=function(){var t=this.element.attr("placeholder");if(t==null){t=Q.text("Controls.SelectEditor.EmptyItemText")}return t};i.prototype.getService=function(){throw new ss.NotImplementedException};i.prototype.query=function(t,e){var i={blockUI:false,service:this.getService()+"/List",request:t,onSuccess:function(t){e(t)}};this.executeQuery(i)};i.prototype.executeQuery=function(t){Q.serviceCall(t)};i.prototype.queryByKey=function(t,e){var i={blockUI:false,service:this.getService()+"/Retrieve",request:{EntityId:t},onSuccess:function(t){e(t.Entity)}};this.executeQueryByKey(i)};i.prototype.executeQueryByKey=function(t){Q.serviceCall(t)};i.prototype.getItemKey=function(t){return null};i.prototype.getItemText=function(t){return null};i.prototype.getTypeDelay=function(){return 500};i.prototype.getSelect2Options=function(){var t=this;var e=this.emptyItemText();var i=0;return{minimumResultsForSearch:10,placeHolder:!Q.isEmptyOrNull(e)?e:null,allowClear:Q.isValue(e),query:function(e){var r={ContainsText:Q.trimToNull(e.term),Skip:(e.page-1)*t.pageSize,Take:t.pageSize+1};if(i!==0){window.clearTimeout(i)}i=window.setTimeout(function(){t.query(r,function(i){e.callback({results:i.Entities.slice(0,t.pageSize).map(function(e){return{id:t.getItemKey(e),text:t.getItemText(e),source:e}}),more:i.Entities.length>=t.pageSize})})},t.getTypeDelay())},initSelection:function(e,i){var r=e.val();if(Q.isEmptyOrNull(r)){i(null);return}t.queryByKey(r,function(e){i(e==null?null:{id:t.getItemKey(e),text:t.getItemText(e),source:e})})}}};i.prototype.addInplaceCreate=function(t){var e=this;$("<a><b/></a>").addClass("inplace-button inplace-create").attr("title",t).insertAfter(this.element).click(function(t){e.inplaceCreateClick(t)});this.get_select2Container().add(this.element).addClass("has-inplace-button")};i.prototype.inplaceCreateClick=function(t){};i.prototype.get_select2Container=function(){return this.element.prevAll(".select2-container")};i.prototype.get_value=function(){return ss.safeCast(this.element.select2("val"),String)};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(t){this.set_value(t)},enumerable:true,configurable:true});i.prototype.set_value=function(t){if(t!==this.get_value()){this.element.select2("val",t).triggerHandler("change",[true])}};i=__decorate([n("Select2Ajax",[t.IStringValue]),a('<input type="hidden" />')],i);return i}(t.Widget);t.Select2AjaxEditor=I})(Serenity||(Serenity={}));var Serenity;(function(t){var e;(function(t){t.isTrue="true";t.isFalse="false";t.contains="contains";t.startsWith="startswith";t.EQ="eq";t.NE="ne";t.GT="gt";t.GE="ge";t.LT="lt";t.LE="le";t.BW="bw";t.IN="in";t.isNull="isnull";t.isNotNull="isnotnull";t.toCriteriaOperator={eq:"=",ne:"!=",gt:">",ge:">=",lt:"<",le:"<="}})(e=t.FilterOperators||(t.FilterOperators={}))})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(){function e(t){this.items=[];if(t==null){throw new ss.ArgumentNullException("source")}this.fields=t.slice();this.get_fields().sort(function(t,e){var i=Q.tryGetText(t.title);if(i==null){i=t.title;if(i==null)i=t.name}var r=Q.tryGetText(e.title);if(r==null){r=e.title;if(r==null)r=e.name}return Q.turkishLocaleCompare(i,r)});this.fieldByName={};for(var e=0,i=t;e<i.length;e++){var r=i[e];this.get_fieldByName()[r.name]=r}}i=e;e.getCriteriaFor=function(e){if(e==null)return[""];var i=false;var r=[""];var n=false;var a=[""];for(var o=0;o<e.length;o++){var l=e[o];if(l.leftParen||i&&l.rightParen){if(!t.Criteria.isEmpty(r)){if(i)r=t.Criteria.paren(r);if(n)a=t.Criteria.join(a,"or",r);else a=t.Criteria.join(a,"and",r);r=[""]}i=false}if(l.leftParen){n=l.isOr;i=true}if(l.isOr)r=t.Criteria.join(r,"or",l.criteria);else r=t.Criteria.join(r,"and",l.criteria)}if(!t.Criteria.isEmpty(r)){if(n)a=t.Criteria.join(a,"or",t.Criteria.paren(r));else a=t.Criteria.join(a,"and",t.Criteria.paren(r))}return a};e.getDisplayTextFor=function(t){if(t==null)return"";var e=false;var i="";for(var r=0;r<t.length;r++){var n=t[r];if(e&&(n.rightParen||n.leftParen)){i+=")";e=false}if(i.length>0){i+=" "+Q.text("Controls.FilterPanel."+(n.isOr?"Or":"And"))+" "}if(n.leftParen){i+="(";e=true}i+=n.displayText}if(e){i+=")"}return i};e.prototype.get_fields=function(){return this.fields};e.prototype.get_fieldByName=function(){return this.fieldByName};e.prototype.get_items=function(){return this.items};e.prototype.raiseChanged=function(){this.displayText=null;this.changed&&this.changed(this,ss.EventArgs.Empty)};e.prototype.add_changed=function(t){this.changed=ss.delegateCombine(this.changed,t)};e.prototype.remove_changed=function(t){this.changed=ss.delegateRemove(this.changed,t)};e.prototype.get_activeCriteria=function(){return i.getCriteriaFor(this.items)};e.prototype.get_displayText=function(){if(this.displayText==null)this.displayText=i.getDisplayTextFor(this.items);return this.displayText};var i;e=i=__decorate([t.Decorators.registerClass("FilterStore")],e);return e}();t.FilterStore=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(){function e(){}e=__decorate([t.Decorators.registerInterface("Serenity.IFiltering")],e);return e}();t.IFiltering=e;var i=function(){function e(){}e=__decorate([t.Decorators.registerInterface("Serenity.IQuickFiltering")],e);return e}();t.IQuickFiltering=i;var r=t.FilterOperators;var n=t.Decorators.option;var a=function(){function r(){}r.prototype.get_field=function(){return this.field};r.prototype.set_field=function(t){this.field=t};r.prototype.get_container=function(){return this.container};r.prototype.set_container=function(t){this.container=t};r.prototype.get_operator=function(){return this.operator};r.prototype.set_operator=function(t){this.operator=t};r.prototype.appendNullableOperators=function(e){if(!this.isNullable()){return e}e.push({key:t.FilterOperators.isNotNull});e.push({key:t.FilterOperators.isNull});return e};r.prototype.appendComparisonOperators=function(e){e.push({key:t.FilterOperators.EQ});e.push({key:t.FilterOperators.NE});e.push({key:t.FilterOperators.LT});e.push({key:t.FilterOperators.LE});e.push({key:t.FilterOperators.GT});e.push({key:t.FilterOperators.GE});return e};r.prototype.isNullable=function(){return this.get_field().required!==true};r.prototype.createEditor=function(){switch(this.get_operator().key){case"true":case"false":case"isnull":case"isnotnull":{return}case"contains":case"startswith":case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{this.get_container().html('<input type="text"/>');return}}throw new ss.Exception(Q.format("Filtering '{0}' has no editor for '{1}' operator",ss.getTypeName(ss.getInstanceType(this)),this.get_operator().key))};r.prototype.operatorFormat=function(t){return Q.coalesce(t.format,Q.coalesce(Q.tryGetText("Controls.FilterPanel.OperatorFormats."+t.key),t.key))};r.prototype.getTitle=function(t){return Q.coalesce(Q.tryGetText(t.title),Q.coalesce(t.title,t.name))};r.prototype.displayText=function(t,e){if(!e||e.length===0){return Q.format(this.operatorFormat(t),this.getTitle(this.field))}else if(e.length===1){return Q.format(this.operatorFormat(t),this.getTitle(this.field),e[0])}else{return Q.format(this.operatorFormat(t),this.getTitle(this.field),e[0],e[1])}};r.prototype.getCriteriaField=function(){return this.field.name};r.prototype.getCriteria=function(){var e={};var i;switch(this.get_operator().key){case"true":{e.displayText=this.displayText(this.get_operator(),[]);e.criteria=[[this.getCriteriaField()],"=",true];return e}case"false":{e.displayText=this.displayText(this.get_operator(),[]);e.criteria=[[this.getCriteriaField()],"=",false];return e}case"isnull":{e.displayText=this.displayText(this.get_operator(),[]);e.criteria=["is null",[this.getCriteriaField()]];return e}case"isnotnull":{e.displayText=this.displayText(this.get_operator(),[]);e.criteria=["is not null",[this.getCriteriaField()]];return e}case"contains":{i=this.getEditorText();e.displayText=this.displayText(this.get_operator(),[i]);e.criteria=[[this.getCriteriaField()],"like","%"+i+"%"];return e}case"startswith":{i=this.getEditorText();e.displayText=this.displayText(this.get_operator(),[i]);e.criteria=[[this.getCriteriaField()],"like",i+"%"];return e}case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{i=this.getEditorText();e.displayText=this.displayText(this.get_operator(),[i]);e.criteria=[[this.getCriteriaField()],t.FilterOperators.toCriteriaOperator[this.get_operator().key],this.getEditorValue()];return e}}throw new ss.Exception(Q.format("Filtering '{0}' has no handler for '{1}' operator",ss.getTypeName(ss.getInstanceType(this)),this.get_operator().key))};r.prototype.loadState=function(t){var e=this.get_container().find(":input").first();e.val(t)};r.prototype.saveState=function(){switch(this.get_operator().key){case"contains":case"startswith":case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{var t=this.get_container().find(":input").first();return t.val()}}return null};r.prototype.argumentNull=function(){return new ss.ArgumentNullException("value",Q.text("Controls.FilterPanel.ValueRequired"))};r.prototype.validateEditorValue=function(t){if(t.length===0){throw this.argumentNull()}return t};r.prototype.getEditorValue=function(){var t=this.get_container().find(":input").not(".select2-focusser").first();if(t.length!==1){throw new ss.Exception(Q.format("Couldn't find input in filter container for {0}",Q.coalesce(this.field.title,this.field.name)))}var e;if(t.data("select2")!=null){e=t.select2("val")}else{e=t.val()}e=Q.coalesce(e,"").trim();return this.validateEditorValue(e)};r.prototype.getEditorText=function(){var t=this.get_container().find(":input").not(".select2-focusser").not(".select2-input").first();if(t.length===0){return this.get_container().text().trim()}var e;if(t.data("select2")!=null){e=Q.coalesce(t.select2("data"),{}).text}else{e=t.val()}return e};r.prototype.initQuickFilter=function(e){e.field=this.getCriteriaField();e.type=t.StringEditor;e.title=this.getTitle(this.field);e.options=Q.deepClone({},this.get_field().quickFilterParams)};r=__decorate([t.Decorators.registerClass("Serenity.BaseFiltering",[e,i])],r);return r}();t.BaseFiltering=a;function o(e){return t.Decorators.registerClass("Serenity."+e+"Filtering")}var l=function(e){__extends(i,e);function i(t){var i=e.call(this)||this;i.editorType=t;return i}i.prototype.useEditor=function(){switch(this.get_operator().key){case"eq":case"ne":case"lt":case"le":case"gt":case"ge":return true}return false};i.prototype.createEditor=function(){if(this.useEditor()){this.editor=t.Widget.create({type:this.editorType,container:this.get_container(),options:this.getEditorOptions(),init:null});return}this.editor=null;e.prototype.createEditor.call(this)};i.prototype.useIdField=function(){return false};i.prototype.getCriteriaField=function(){if(this.useEditor()&&this.useIdField()&&!Q.isEmptyOrNull(this.get_field().filteringIdField)){return this.get_field().filteringIdField}return e.prototype.getCriteriaField.call(this)};i.prototype.getEditorOptions=function(){var t=Q.deepClone({},this.get_field().editorParams);delete t["cascadeFrom"];return Q.deepClone(t,this.get_field().filteringParams)};i.prototype.loadState=function(i){if(this.useEditor()){if(i==null){return}t.EditorUtils.setValue(this.editor,i);return}e.prototype.loadState.call(this,i)};i.prototype.saveState=function(){if(this.useEditor()){return t.EditorUtils.getValue(this.editor)}return e.prototype.saveState.call(this)};i.prototype.getEditorValue=function(){if(this.useEditor()){var i=t.EditorUtils.getValue(this.editor);if(i==null||typeof i=="string"&&i.trim().length===0)throw this.argumentNull();return i}return e.prototype.getEditorValue.call(this)};i.prototype.initQuickFilter=function(t){e.prototype.initQuickFilter.call(this,t);t.type=this.editorType;t.options=Q.deepClone({},this.getEditorOptions(),this.get_field().quickFilterParams)};i=__decorate([o("BaseEditor")],i);return i}(a);t.BaseEditorFiltering=l;var s=function(e){__extends(i,e);function i(){return e.call(this,t.DateEditor)||this}i.prototype.getOperators=function(){return this.appendNullableOperators(this.appendComparisonOperators([]))};i=__decorate([o("Date")],i);return i}(l);t.DateFiltering=s;var u=function(e){__extends(i,e);function i(){return e!==null&&e.apply(this,arguments)||this}i.prototype.getOperators=function(){return this.appendNullableOperators([{key:t.FilterOperators.isTrue},{key:t.FilterOperators.isFalse}])};i=__decorate([o("Boolean")],i);return i}(a);t.BooleanFiltering=u;var c=function(e){__extends(i,e);function i(){return e.call(this,t.DateTimeEditor)||this}i.prototype.getOperators=function(){return this.appendNullableOperators(this.appendComparisonOperators([]))};i.prototype.getCriteria=function(){var i={};switch(this.get_operator().key){case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{{var r=this.getEditorText();i.displayText=this.displayText(this.get_operator(),[r]);var n=Q.parseISODateTime(this.getEditorValue());n=new Date(n.getFullYear(),n.getMonth(),n.getDate());var a=new Date(n.getFullYear(),n.getMonth(),n.getDate()+1);var o=[this.getCriteriaField()];var l=Q.formatDate(n,"yyyy-MM-dd");var s=Q.formatDate(a,"yyyy-MM-dd");switch(this.get_operator().key){case"eq":{i.criteria=t.Criteria.join([o,">=",l],"and",[o,"<",s]);return i}case"ne":{i.criteria=t.Criteria.paren(t.Criteria.join([o,"<",l],"or",[o,">",s]));return i}case"lt":{i.criteria=[o,"<",l];return i}case"le":{i.criteria=[o,"<",s];return i}case"gt":{i.criteria=[o,">=",s];return i}case"ge":{i.criteria=[o,">=",l];return i}}}break}}return e.prototype.getCriteria.call(this)};i=__decorate([o("DateTime")],i);return i}(l);t.DateTimeFiltering=c;var d=function(e){__extends(i,e);function i(){return e.call(this,t.DecimalEditor)||this}i.prototype.getOperators=function(){return this.appendNullableOperators(this.appendComparisonOperators([]))};i=__decorate([o("Decimal")],i);return i}(l);t.DecimalFiltering=d;var f=function(e){__extends(i,e);function i(){return e.call(this,t.Widget)||this}i.prototype.getOperators=function(){var t=[];t.push({key:r.EQ});t.push({key:r.NE});if(this.useRelative){t.push({key:r.LT});t.push({key:r.LE});t.push({key:r.GT});t.push({key:r.GE})}if(this.useLike){t.push({key:r.contains});t.push({key:r.startsWith})}this.appendNullableOperators(t);return t};i.prototype.useEditor=function(){var t=this.get_operator().key;return t===r.EQ||t===r.NE||this.useRelative&&(t===r.LT||t===r.LE||t===r.GT||t===r.GE)};i.prototype.getEditorOptions=function(){var t=e.prototype.getEditorOptions.call(this);if(this.useEditor()&&this.editorType===Q.coalesce(this.get_field().editorType,"String")){t=$.extend(t,this.get_field().editorParams)}return t};i.prototype.createEditor=function(){var i=this;if(this.useEditor()){var r=t.EditorTypeRegistry.get(this.editorType);this.editor=t.Widget.create({type:r,element:function(t){return t.appendTo(i.get_container())},options:this.getEditorOptions()});return}e.prototype.createEditor.call(this)};i.prototype.useIdField=function(){return this.useEditor()};i.prototype.initQuickFilter=function(i){e.prototype.initQuickFilter.call(this,i);i.type=t.EditorTypeRegistry.get(this.editorType)};__decorate([n()],i.prototype,"editorType",void 0);__decorate([n()],i.prototype,"useRelative",void 0);__decorate([n()],i.prototype,"useLike",void 0);i=__decorate([o("Editor")],i);return i}(l);t.EditorFiltering=f;var p=function(e){__extends(i,e);function i(){return e.call(this,t.EnumEditor)||this}i.prototype.getOperators=function(){var t=[{key:r.EQ},{key:r.NE}];return this.appendNullableOperators(t)};i=__decorate([o("Enum")],i);return i}(l);t.EnumFiltering=p;var h=function(e){__extends(i,e);function i(){return e.call(this,t.IntegerEditor)||this}i.prototype.getOperators=function(){return this.appendNullableOperators(this.appendComparisonOperators([]))};i=__decorate([o("Integer")],i);return i}(l);t.IntegerFiltering=h;var g=function(e){__extends(i,e);function i(){return e.call(this,t.LookupEditor)||this}i.prototype.getOperators=function(){var t=[{key:r.EQ},{key:r.NE},{key:r.contains},{key:r.startsWith}];return this.appendNullableOperators(t)};i.prototype.useEditor=function(){var t=this.get_operator().key;return t==r.EQ||t==r.NE};i.prototype.useIdField=function(){return this.useEditor()};i.prototype.getEditorText=function(){if(this.useEditor()){return this.editor.text}return e.prototype.getEditorText.call(this)};i=__decorate([o("Lookup")],i);return i}(l);t.LookupFiltering=g;var v=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.getOperators=function(){var t=[{key:r.contains},{key:r.startsWith},{key:r.EQ},{key:r.NE}];return this.appendNullableOperators(t)};e.prototype.validateEditorValue=function(e){if(e.length===0){return e}return t.prototype.validateEditorValue.call(this,e)};e=__decorate([o("String")],e);return e}(a);t.StringFiltering=v;var y;(function(e){var i;function r(){if(i!=null)return;i={};for(var e=0,r=ss.getAssemblies();e<r.length;e++){var a=r[e];for(var o=0,l=ss.getAssemblyTypes(a);o<l.length;o++){var s=l[o];if(!ss.isAssignableFrom(t.IFiltering,s))continue;if(ss.isGenericTypeDefinition(s))continue;var u=ss.getTypeFullName(s).toLowerCase();i[u]=s;for(var c=0,d=Q.Config.rootNamespaces;c<d.length;c++){var f=d[c];if(Q.startsWith(u,f.toLowerCase()+".")){var p=u.substr(f.length+1).toLowerCase();if(i[p]==null){i[p]=s}}}}}n()}function n(){var t="filtering";for(var e=0,r=Object.keys(i);e<r.length;e++){var n=r[e];if(!Q.endsWith(n,t))continue;var a=n.substr(0,n.length-t.length);if(Q.isEmptyOrNull(a))continue;if(i[a]!=null)continue;i[a]=i[n]}}function a(){i=null}function o(t){if(Q.isEmptyOrNull(t))throw new ss.ArgumentNullException("key");r();var e=i[t.toLowerCase()];if(e==null)throw new ss.Exception(Q.format("Can't find {0} filter handler type!",t));return e}e.get=o})(y=t.FilteringTypeRegistry||(t.FilteringTypeRegistry={}))})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(i,r){var n=e.call(this,i,r)||this;n.store=new t.FilterStore([]);n.onFilterStoreChanged=function(){return n.filterStoreChanged()};n.store.add_changed(n.onFilterStoreChanged);return n}i.prototype.destroy=function(){if(this.store){this.store.remove_changed(this.onFilterStoreChanged);this.onFilterStoreChanged=null;this.store=null}e.prototype.destroy.call(this)};i.prototype.filterStoreChanged=function(){};i.prototype.get_store=function(){return this.store};i.prototype.set_store=function(e){if(this.store!==e){if(this.store!=null)this.store.remove_changed(this.onFilterStoreChanged);this.store=e||new t.FilterStore([]);this.store.add_changed(this.onFilterStoreChanged);this.filterStoreChanged()}};i=__decorate([t.Decorators.registerClass("Serenity.FilterWidgetBase")],i);return i}(t.TemplatedWidget);t.FilterWidgetBase=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(i){var r=e.call(this,i)||this;r.element.find(".cap").text(Q.text("Controls.FilterPanel.EffectiveFilter"));r.element.find(".edit").text(Q.text("Controls.FilterPanel.EditFilter"));r.element.find(".reset").attr("title",Q.text("Controls.FilterPanel.ResetFilterHint"));var n=function(e){e.preventDefault();var i=new t.FilterDialog;i.get_filterPanel().set_store(r.get_store());i.dialogOpen(null)};r.element.find(".edit").click(n);r.element.find(".txt").click(n);r.element.find(".reset").click(function(t){t.preventDefault();ss.clear(r.get_store().get_items());r.get_store().raiseChanged()});return r}i.prototype.filterStoreChanged=function(){e.prototype.filterStoreChanged.call(this);var t=Q.trimToNull(this.get_store().get_displayText());this.element.find(".current").toggle(t!=null);this.element.find(".reset").toggle(t!=null);if(t==null)t=Q.text("Controls.FilterPanel.EffectiveEmpty");this.element.find(".txt").text("["+t+"]")};i.prototype.getTemplate=function(){return"<div><a class='reset'></a><a class='edit'></a>"+"<div class='current'><span class='cap'></span>"+"<a class='txt'></a></div></div>"};i=__decorate([t.Decorators.registerClass("Serenity.FilterDisplayBar")],i);return i}(t.FilterWidgetBase);t.FilterDisplayBar=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t)||this;for(var n=0,a=i;n<a.length;n++){var o=a[n];r.addOption(o.name,Q.coalesce(Q.tryGetText(o.title),Q.coalesce(o.title,o.name)),o)}return r}i.prototype.emptyItemText=function(){if(Q.isEmptyOrNull(this.value)){return Q.text("Controls.FilterPanel.SelectField")}return null};i.prototype.getSelect2Options=function(){var t=e.prototype.getSelect2Options.call(this);t.allowClear=false;return t};i=__decorate([t.Decorators.registerClass("Serenity.FilterFieldSelect")],i);return i}(t.Select2Editor);var i=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t)||this;for(var n=0,a=i;n<a.length;n++){var o=a[n];var l=Q.coalesce(o.title,Q.coalesce(Q.tryGetText("Controls.FilterPanel.OperatorNames."+o.key),o.key));r.addOption(o.key,l,o)}if(i.length&&i[0])r.value=i[0].key;return r}i.prototype.emptyItemText=function(){return null};i.prototype.getSelect2Options=function(){var t=e.prototype.getSelect2Options.call(this);t.allowClear=false;return t};i=__decorate([t.Decorators.registerClass("Serenity.FilterOperatorSelect")],i);return i}(t.Select2Editor);var r=function(r){__extends(n,r);function n(t){var e=r.call(this,t)||this;e.element.addClass("s-FilterPanel");e.rowsDiv=e.byId("Rows");e.initButtons();e.updateButtons();return e}n.prototype.get_showInitialLine=function(){return this.showInitialLine};n.prototype.set_showInitialLine=function(t){if(this.showInitialLine!==t){this.showInitialLine=t;if(this.showInitialLine&&this.rowsDiv.children().length===0){this.addEmptyRow(false)}}};n.prototype.filterStoreChanged=function(){r.prototype.filterStoreChanged.call(this);this.updateRowsFromStore()};n.prototype.updateRowsFromStore=function(){this.rowsDiv.empty();var t=this.get_store().get_items();for(var r=0,n=t;r<n.length;r++){var a=n[r];this.addEmptyRow(false);var o=this.rowsDiv.children().last();var l=o.children("div.l");l.children(".leftparen").toggleClass("active",!!a.leftParen);l.children(".rightparen").toggleClass("active",!!a.rightParen);l.children(".andor").toggleClass("or",!!a.isOr).text(Q.text(!!a.isOr?"Controls.FilterPanel.Or":"Controls.FilterPanel.And"));var s=o.children("div.f").find("input.field-select").getWidget(e);s.value=a.field;this.rowFieldChange(o);var u=o.children("div.o").find("input.op-select").getWidget(i);u.set_value(a.operator);this.rowOperatorChange(o);var c=this.getFilteringFor(o);if(c!=null){c.set_operator({key:a.operator});c.loadState(a.state)}}if(this.get_showInitialLine()&&this.rowsDiv.children().length===0){this.addEmptyRow(false)}this.updateParens()};n.prototype.get_showSearchButton=function(){return this.showSearchButton};n.prototype.set_showSearchButton=function(t){if(this.showSearchButton!==t){this.showSearchButton=t;this.updateButtons()}};n.prototype.get_updateStoreOnReset=function(){return this.updateStoreOnReset};n.prototype.set_updateStoreOnReset=function(t){if(this.updateStoreOnReset!==t){this.updateStoreOnReset=t}};n.prototype.getTemplate=function(){return"<div id='~_Rows' class='filter-lines'>"+"</div>"+"<div id='~_Buttons' class='buttons'>"+"<button id='~_AddButton' class='btn btn-primary add'></button>"+"<button id='~_SearchButton' class='btn btn-success search'></button>"+"<button id='~_ResetButton' class='btn btn-danger reset'></button>"+"</div>"+"<div style='clear: both'>"+"</div>"};n.prototype.initButtons=function(){var t=this;this.byId("AddButton").text(Q.text("Controls.FilterPanel.AddFilter")).click(function(e){return t.addButtonClick(e)});this.byId("SearchButton").text(Q.text("Controls.FilterPanel.SearchButton")).click(function(e){return t.searchButtonClick(e)});this.byId("ResetButton").text(Q.text("Controls.FilterPanel.ResetButton")).click(function(e){return t.resetButtonClick(e)})};n.prototype.searchButtonClick=function(t){t.preventDefault();this.search()};n.prototype.get_hasErrors=function(){return this.rowsDiv.children().children("div.v").children("span.error").length>0};n.prototype.search=function(){this.rowsDiv.children().children("div.v").children("span.error").remove();var t=[];var e=null;var r=null;for(var n=0;n<this.rowsDiv.children().length;n++){try{r=this.rowsDiv.children().eq(n);var a=this.getFilteringFor(r);if(a==null){continue}var o=this.getFieldFor(r);var l=r.children("div.o").find("input.op-select").getWidget(i).value;if(l==null||l.length===0)throw new ss.ArgumentOutOfRangeException("operator",Q.text("Controls.FilterPanel.InvalidOperator"));var s={};s.field=o.name;s.operator=l;s.isOr=r.children("div.l").children("a.andor").hasClass("or");s.leftParen=r.children("div.l").children("a.leftparen").hasClass("active");s.rightParen=r.children("div.l").children("a.rightparen").hasClass("active");a.set_operator({key:l});var u=a.getCriteria();s.criteria=u.criteria;s.state=a.saveState();s.displayText=u.displayText;t.push(s)}catch(c){c=ss.Exception.wrap(c);
if(ss.isInstanceOfType(c,ss.ArgumentException)){e=c.get_message();break}else{throw c}}}if(e!=null){$("<span/>").addClass("error").attr("title",e).appendTo(r.children("div.v"));r.children("div.v").find("input:first").focus();return}ss.clear(this.get_store().get_items());ss.arrayAddRange(this.get_store().get_items(),t);this.get_store().raiseChanged()};n.prototype.addButtonClick=function(t){this.addEmptyRow(true);t.preventDefault()};n.prototype.resetButtonClick=function(t){t.preventDefault();if(this.get_updateStoreOnReset()){if(this.get_store().get_items().length>0){ss.clear(this.get_store().get_items());this.get_store().raiseChanged()}}this.rowsDiv.empty();this.updateButtons();if(this.get_showInitialLine()){this.addEmptyRow(false)}};n.prototype.findEmptyRow=function(){var t=null;this.rowsDiv.children().each(function(e,i){var r=$(i).children("div.f").children("input.field-select").first();if(r.length===0){return true}var n=r.val();if(n==null||n.length===0){t=$(i);return false}return true});return t};n.prototype.addEmptyRow=function(t){var i=this;var r=this.findEmptyRow();if(r!=null){r.find("input.field-select").select2("focus");if(t){r.find("input.field-select").select2("open")}return r}var n=this.rowsDiv.children().last().children("a.andor").hasClass("or");var a=$("<div class='filter-line'>"+"<a class='delete'><span></span></a>"+"<div class='l'>"+"<a class='rightparen' href='#'>)</a>"+"<a class='andor' href='#'></a>"+"<a class='leftparen' href='#'>(</a>"+"</div>"+"<div class='f'>"+"<input type='hidden' class='field-select'>"+"</div>"+"<div class='o'></div>"+"<div class='v'></div>"+"<div style='clear: both'></div>"+"</div>").appendTo(this.rowsDiv);var o=a.children("div.l").hide();o.children("a.leftparen, a.rightparen").click(function(t){return i.leftRightParenClick(t)});var l=o.children("a.andor").attr("title",Q.text("Controls.FilterPanel.ChangeAndOr"));if(n){l.addClass("or").text(Q.text("Controls.FilterPanel.Or"))}else{l.text(Q.text("Controls.FilterPanel.And"))}l.click(function(t){return i.andOrClick(t)});a.children("a.delete").attr("title",Q.text("Controls.FilterPanel.RemoveField")).click(function(t){return i.deleteRowClick(t)});var s=new e(a.children("div.f").children("input"),this.get_store().get_fields()).changeSelect2(function(t){return i.onRowFieldChange(t)});this.updateParens();this.updateButtons();a.find("input.field-select").select2("focus");if(t){a.find("input.field-select").select2("open")}return a};n.prototype.onRowFieldChange=function(t){var e=$(t.target).closest("div.filter-line");this.rowFieldChange(e);var i=e.children("div.o").find("input.op-select");i.select2("focus")};n.prototype.rowFieldChange=function(t){t.removeData("Filtering");var i=t.children("div.f").find("input.field-select").getWidget(e);var r=i.get_value();var n=r==null||r==="";this.removeFiltering(t);this.populateOperatorList(t);this.rowOperatorChange(t);this.updateParens();this.updateButtons()};n.prototype.removeFiltering=function(t){t.data("Filtering",null);t.data("FilteringField",null)};n.prototype.populateOperatorList=function(t){var e=this;t.children("div.o").html("");var r=this.getFilteringFor(t);if(r==null)return;var n=t.children("div.o").html("<input/>").children().attr("type","hidden").addClass("op-select");var a=r.getOperators();var o=new i(n,a);o.changeSelect2(function(t){return e.onRowOperatorChange(t)})};n.prototype.getFieldFor=function(t){if(t.length===0){return null}var i=t.children("div.f").find("input.field-select").getWidget(e);if(Q.isEmptyOrNull(i.value)){return null}return this.get_store().get_fieldByName()[i.get_value()]};n.prototype.getFilteringFor=function(e){var i=this.getFieldFor(e);if(i==null)return null;var r=ss.cast(e.data("Filtering"),t.IFiltering);if(r!=null)return r;var n=t.FilteringTypeRegistry.get(Q.coalesce(i.filteringType,"String"));var a=e.children("div.v");r=ss.cast(ss.createInstance(n),t.IFiltering);t.ReflectionOptionsSetter.set(r,i.filteringParams);r.set_container(a);r.set_field(i);e.data("Filtering",r);return r};n.prototype.onRowOperatorChange=function(t){var e=$(t.target).closest("div.filter-line");this.rowOperatorChange(e);var i=e.children("div.v").find(":input:visible").first();try{i.focus()}catch(r){}};n.prototype.rowOperatorChange=function(t){if(t.length===0){return}var e=t.children("div.v");e.html("");var r=this.getFilteringFor(t);if(r==null)return;var n=t.children("div.o").find("input.op-select").getWidget(i);if(Q.isEmptyOrNull(n.get_value()))return;var a=r.getOperators().filter(function(t){return t.key===n.value});var o=a.length>0?a[0]:null;if(o==null)return;r.set_operator(o);r.createEditor()};n.prototype.deleteRowClick=function(t){t.preventDefault();var e=$(t.target).closest("div.filter-line");e.remove();if(this.rowsDiv.children().length===0){this.search()}this.updateParens();this.updateButtons()};n.prototype.updateButtons=function(){this.byId("SearchButton").toggle(this.rowsDiv.children().length>=1&&this.showSearchButton);this.byId("ResetButton").toggle(this.rowsDiv.children().length>=1)};n.prototype.andOrClick=function(t){t.preventDefault();var e=$(t.target).toggleClass("or");e.text(Q.text("Controls.FilterPanel."+(e.hasClass("or")?"Or":"And")))};n.prototype.leftRightParenClick=function(t){t.preventDefault();$(t.target).toggleClass("active");this.updateParens()};n.prototype.updateParens=function(){var t=this.rowsDiv.children();if(t.length===0){return}t.removeClass("paren-start");t.removeClass("paren-end");t.children("div.l").css("display",t.length===1?"none":"block");t.first().children("div.l").children("a.rightparen, a.andor").css("visibility","hidden");for(var e=1;e<t.length;e++){var i=t.eq(e);i.children("div.l").css("display","block").children("a.lefparen, a.andor").css("visibility","visible")}var r=false;for(var n=0;n<t.length;n++){var a=t.eq(n);var o=a.children("div.l");var l=o.children("a.leftparen");var s=o.children("a.rightparen");if(s.hasClass("active")&&r){r=false;if(n>0){t.eq(n-1).addClass("paren-end")}}if(l.hasClass("active")){r=true;if(n>0){a.addClass("paren-start")}}}};return n}(t.FilterWidgetBase);t.FilterPanel=r})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(i,r){var n=e.call(this,i,r)||this;i.attr("title",Q.text("Controls.QuickSearch.Hint")).attr("placeholder",Q.text("Controls.QuickSearch.Placeholder"));n.lastValue=Q.trim(Q.coalesce(i.val(),""));var a=n;n.element.bind("keyup."+n.uniqueName,function(){a.checkIfValueChanged()});n.element.bind("change."+n.uniqueName,function(){a.checkIfValueChanged()});$("<span><i></i></span>").addClass("quick-search-icon").insertBefore(i);if(Q.isValue(n.options.fields)&&n.options.fields.length>0){var o=$("<a/>").addClass("quick-search-field").attr("title",Q.text("Controls.QuickSearch.FieldSelection")).insertBefore(i);var l=$("<ul></ul>").css("width","120px");for(var s=0,u=n.options.fields;s<u.length;s++){var c=u[s];var d={$:c};$("<li><a/></li>").appendTo(l).children().attr("href","#").text(Q.coalesce(c.title,"")).click(ss.mkdel({field:d,$this:n},function(t){t.preventDefault();this.$this.fieldChanged=!ss.referenceEquals(a.field,this.field.$);a.field=this.field.$;this.$this.updateInputPlaceHolder();this.$this.checkIfValueChanged()}))}new t.PopupMenuButton(o,{positionMy:"right top",positionAt:"right bottom",menu:l});n.field=n.options.fields[0];n.updateInputPlaceHolder()}n.element.bind("execute-search."+n.uniqueName,function(t){if(!!n.timer){window.clearTimeout(n.timer)}n.searchNow(Q.trim(Q.coalesce(n.element.val(),"")))});return n}i.prototype.checkIfValueChanged=function(){if(this.element.hasClass("ignore-change")){return}var t=Q.trim(Q.coalesce(this.element.val(),""));if(t==this.lastValue&&(!this.fieldChanged||Q.isEmptyOrNull(t))){this.fieldChanged=false;return}this.fieldChanged=false;if(!!this.timer){window.clearTimeout(this.timer)}var e=this;this.timer=window.setTimeout(function(){e.searchNow(t)},Q.coalesce(this.options.typeDelay,500));this.lastValue=t};i.prototype.get_field=function(){return this.field};i.prototype.set_field=function(t){if(this.field!==t){this.fieldChanged=true;this.field=t;this.updateInputPlaceHolder();this.checkIfValueChanged()}};i.prototype.updateInputPlaceHolder=function(){var t=this.element.prevAll(".quick-search-field");if(this.field){t.text(this.field.title)}else{t.text("")}};i.prototype.searchNow=function(t){var e=this;this.element.parent().toggleClass(Q.coalesce(this.options.filteredParentClass,"s-QuickSearchFiltered"),!!(t.length>0));this.element.parent().addClass(Q.coalesce(this.options.loadingParentClass,"s-QuickSearchLoading")).addClass(Q.coalesce(this.options.loadingParentClass,"s-QuickSearchLoading"));var i=function(t){e.element.removeClass(Q.coalesce(e.options.loadingParentClass,"s-QuickSearchLoading")).parent().removeClass(Q.coalesce(e.options.loadingParentClass,"s-QuickSearchLoading"));if(!t){e.element.closest(".s-QuickSearchBar").find(".quick-search-icon i").effect("shake",{distance:2})}};if(this.options.onSearch!=null){this.options.onSearch(this.field!=null&&!Q.isEmptyOrNull(this.field.name)?this.field.name:null,t,i)}else{i(true)}};return i}(t.Widget);t.QuickSearchInput=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(){function e(){}e=__decorate([t.Decorators.registerInterface("Serenity.IInitializeColumn")],e);return e}();t.IInitializeColumn=e;var i=t.Decorators.option;function r(e,i){return t.Decorators.registerFormatter("Serenity."+e+"Formatter",i)}var n=function(){function t(){}t.prototype.format=function(t){if(t.value==null){return""}var e;if(!!t.value){e=Q.tryGetText(this.trueText);if(e==null){e=this.trueText;if(e==null){e=Q.coalesce(Q.tryGetText("Dialogs.YesButton"),"Yes")}}}else{e=Q.tryGetText(this.falseText);if(e==null){e=this.falseText;if(e==null){e=Q.coalesce(Q.tryGetText("Dialogs.NoButton"),"No")}}}return Q.htmlEncode(e)};__decorate([i()],t.prototype,"falseText",void 0);__decorate([i()],t.prototype,"trueText",void 0);t=__decorate([r("Boolean")],t);return t}();t.BooleanFormatter=n;var a=function(){function t(){}t.prototype.format=function(t){return'<span class="check-box no-float readonly '+(!!t.value?" checked":"")+'"></span>'};t=__decorate([r("Checkbox")],t);return t}();t.CheckboxFormatter=a;var o=function(){function t(){this.displayFormat=Q.Culture.dateFormat}e=t;t.format=function(t,e){if(t==null){return""}var i;if(t instanceof Date){i=t}else if(typeof t==="string"){i=Q.parseISODateTime(t);if(i==null){return Q.htmlEncode(t)}}else{return t.toString()}return Q.htmlEncode(Q.formatDate(i,e))};t.prototype.format=function(t){return e.format(t.value,this.displayFormat)};var e;__decorate([i()],t.prototype,"displayFormat",void 0);t=e=__decorate([r("Date")],t);return t}();t.DateFormatter=o;var l=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.displayFormat=Q.Culture.dateTimeFormat;return e}e=__decorate([r("DateTime")],e);return e}(o);t.DateTimeFormatter=l;var s=function(){function e(){}n=e;e.prototype.format=function(e){return n.format(t.EnumTypeRegistry.get(this.enumKey),e.value)};e.format=function(e,i){if(i==null){return""}var r;try{r=ss.Enum.toString(e,i)}catch(a){a=ss.Exception.wrap(a);if(ss.isInstanceOfType(a,ss.ArgumentException)){r=i.toString()}else{throw a}}var o=ss.getAttributes(e,t.EnumKeyAttribute,false);var l=o.length>0?o[0].value:ss.getTypeFullName(e);return n.getText(l,r)};e.getText=function(t,e){if(Q.isEmptyOrNull(e)){return""}return Q.htmlEncode(Q.coalesce(Q.tryGetText("Enums."+t+"."+e),e))};e.getName=function(t,e){if(e==null){return""}return ss.Enum.toString(t,e)};var n;__decorate([i()],e.prototype,"enumKey",void 0);e=n=__decorate([r("Enum")],e);return e}();t.EnumFormatter=s;var u=function(){function n(){}a=n;n.prototype.format=function(t){var e=ss.safeCast(t.value,String);if(Q.isEmptyOrNull(e)){return""}var i=a.dbFileUrl(e);var r=!Q.isEmptyOrNull(this.originalNameProperty)?ss.safeCast(t.item[this.originalNameProperty],String):null;r=Q.coalesce(r,"");var n=Q.format(Q.coalesce(this.displayFormat,"{0}"),r,e,i);return"<a class='file-download-link' target='_blank' href='"+Q.attrEncode(i)+"'>"+Q.htmlEncode(n)+"</a>"};n.dbFileUrl=function(t){t=Q.replaceAll(Q.coalesce(t,""),"\\","/");return Q.resolveUrl("~/upload/")+t};n.prototype.initializeColumn=function(t){t.referencedFields=t.referencedFields||[];if(!Q.isEmptyOrNull(this.originalNameProperty)){t.referencedFields.push(this.originalNameProperty);return}};var a;__decorate([i()],n.prototype,"displayFormat",void 0);__decorate([i()],n.prototype,"originalNameProperty",void 0);n=a=__decorate([r("FileDownload",[t.ISlickFormatter,e])],n);return n}();t.FileDownloadFormatter=u;var c=function(){function t(){}e=t;t.prototype.format=function(t){return e.format(t.value)};t.format=function(t){var e=Math.floor(t/60);var i=t-e*60;var r,n;if(t==null||isNaN(t))return"";if(e<10)r="0"+e;else r=e.toString();if(i<10)n="0"+i;else n=i.toString();return Q.format("{0}:{1}",r,n)};var e;t=e=__decorate([r("Minute")],t);return t}();t.MinuteFormatter=c;var d=function(){function t(){}e=t;t.prototype.format=function(t){return e.format(t.value,this.displayFormat)};t.format=function(t,e){e=Q.coalesce(e,"0.##");if(t==null)return"";if(typeof t==="number"){if(isNaN(t))return"";return Q.htmlEncode(Q.formatNumber(t,e))}var i=Q.parseDecimal(t.toString());if(i==null)return"";return Q.htmlEncode(t.toString())};var e;__decorate([i()],t.prototype,"displayFormat",void 0);t=e=__decorate([r("Number")],t);return t}();t.NumberFormatter=d;var f=function(){function n(){}n.prototype.format=function(t){var e=!Q.isEmptyOrNull(this.urlProperty)?Q.coalesce(t.item[this.urlProperty],"").toString():Q.coalesce(t.value,"").toString();if(Q.isEmptyOrNull(e))return"";if(!Q.isEmptyOrNull(this.urlFormat))e=Q.format(this.urlFormat,e);if(e!=null&&Q.startsWith(e,"~/"))e=Q.resolveUrl(e);var i=!Q.isEmptyOrNull(this.displayProperty)?Q.coalesce(t.item[this.displayProperty],"").toString():Q.coalesce(t.value,"").toString();if(!Q.isEmptyOrNull(this.displayFormat))i=Q.format(this.displayFormat,i);var r="<a href='"+Q.attrEncode(e)+"'";if(!Q.isEmptyOrNull(this.target))r+=" target='"+this.target+"'";r+=">"+Q.htmlEncode(i)+"</a>";return r};n.prototype.initializeColumn=function(t){t.referencedFields=t.referencedFields||[];if(!Q.isEmptyOrNull(this.displayProperty)){t.referencedFields.push(this.displayProperty);return}if(!Q.isEmptyOrNull(this.urlProperty)){t.referencedFields.push(this.urlProperty);return}};__decorate([i()],n.prototype,"displayProperty",void 0);__decorate([i()],n.prototype,"displayFormat",void 0);__decorate([i()],n.prototype,"urlProperty",void 0);__decorate([i()],n.prototype,"urlFormat",void 0);__decorate([i()],n.prototype,"target",void 0);n=__decorate([r("Url",[t.ISlickFormatter,e])],n);return n}();t.UrlFormatter=f;var p;(function(e){var i;function r(){var t="formatter";for(var e=0,r=Object.keys(i);e<r.length;e++){var n=r[e];if(!Q.endsWith(n,t))continue;var a=n.substr(0,n.length-t.length);if(Q.isEmptyOrNull(a))continue;if(i[a]!=null)continue;i[a]=i[n]}}function n(){if(i){return}i={};var e=ss.getAssemblies();for(var n=0,a=e;n<a.length;n++){var o=a[n];var l=ss.getAssemblyTypes(o);for(var s=0,u=l;s<u.length;s++){var c=u[s];if(!ss.isAssignableFrom(t.ISlickFormatter,c))continue;if(ss.isGenericTypeDefinition(c))continue;var d=ss.getTypeFullName(c).toLowerCase();i[d]=c;for(var f=0,p=Q.Config.rootNamespaces;f<p.length;f++){var h=p[f];if(Q.startsWith(d,h.toLowerCase()+".")){var g=d.substr(h.length+1).toLowerCase();if(i[g]==null){i[g]=c}}}}}r()}function a(t){if(Q.isEmptyOrNull(t))throw new ss.ArgumentNullException("key");n();var e=i[t.toLowerCase()];if(e==null){throw new ss.Exception(Q.format("Can't find {0} formatter type!",t))}return e}e.get=a;function o(){i=null}e.reset=o})(p=t.FormatterTypeRegistry||(t.FormatterTypeRegistry={}))})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(i,r){var n=e.call(this,i,r)||this;n.xDifference=0;n.yDifference=0;t.LazyLoadHelper.executeOnceWhenShown(i,function(){n.storeInitialSize()});return n}i.prototype.storeInitialSize=function(){var t=this;if(!!this.element.data("flexify-init")){return}var e=this.options.designWidth;if(e==null)e=this.element.width();this.element.data("flexify-width",e);var i=this.options.designHeight;if(i==null)i=this.element.height();this.element.data("flexify-height",i);this.element.data("flexify-init",true);this.element.bind("resize."+this.uniqueName,function(){return t.resizeElements()});this.element.bind("resizestop."+this.uniqueName,function(){return t.resizeElements()});var r=this.element.find(".ui-tabs");if(r.length>0){r.bind("tabsactivate."+this.uniqueName,function(){return t.resizeElements()})}if(this.options.designWidth!=null||this.options.designHeight!=null)this.resizeElements()};i.prototype.getXFactor=function(t){var e=null;if(this.options.getXFactor!=null)e=this.options.getXFactor(t);if(e==null)e=t.data("flex-x");return Q.coalesce(e,1)};i.prototype.getYFactor=function(t){var e=null;if(this.options.getYFactor!=null)e=this.options.getYFactor(t);if(e==null)e=t.data("flex-y");return Q.coalesce(e,0)};i.prototype.resizeElements=function(){var t=this;var e=this.element.width();var i=this.element.data("flexify-width");if(i==null){this.element.data("flexify-width",e);i=e}var r=this.element.height();var n=this.element.data("flexify-height");if(n==null){this.element.data("flexify-height",r);n=r}this.xDifference=e-i;this.yDifference=r-n;var a=this.element;var o=this.element.find(".ui-tabs-panel");if(o.length>0){a=o.filter(":visible")}a.find(".flexify").add(o.filter(".flexify:visible")).each(function(e,i){t.resizeElement($(i))})};i.prototype.resizeElement=function(t){var e=this.getXFactor(t);if(e!==0){var i=t.data("flexify-width");if(i==null){var r=t.width();t.data("flexify-width",r);i=r}t.width(i+e*this.xDifference|0)}var n=this.getYFactor(t);if(n!==0){var a=t.data("flexify-height");if(a==null){var o=t.height();t.data("flexify-height",o);a=o}t.height(a+n*this.yDifference|0)}if(t.hasClass("require-layout")){t.triggerHandler("layout")}};return i}(t.Widget);t.Flexify=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e;(function(e){var i;function r(e){if(i==null){i={};for(var r=0,n=ss.getAssemblies();r<n.length;r++){var a=n[r];for(var o=0,l=ss.getAssemblyTypes(a);o<l.length;o++){var s=l[o];if(ss.isEnum(s)){var u=ss.getTypeFullName(s);i[u]=s;var c=ss.getAttributes(s,t.EnumKeyAttribute,false);if(c!=null&&c.length>0){i[c[0].value]=s}for(var d=0,f=Q.Config.rootNamespaces;d<f.length;d++){var p=f[d];if(Q.startsWith(u,p+".")){i[u.substr(p.length+1)]=s}}}}}}if(i[e]==null)return null;return i[e]}e.tryGet=r;function n(t){var i=e.tryGet(t);if(i==null){var r=Q.format("Can't find {0} enum type! If you have recently defined this enum type "+"in server side code, make sure your project builds successfully and transform T4 templates. "+"Also make sure that enum is under your project root namespace, and your namespace parts starts "+"with capital letters, e.g.MyProject.Pascal.Cased namespace",t);Q.notifyError(r,"",null);throw new ss.Exception(r)}return i}e.get=n})(e=t.EnumTypeRegistry||(t.EnumTypeRegistry={}))})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(){function t(t){this.idPrefix=t}t.prototype.byId=function(t){return $("#"+this.idPrefix+t)};t.prototype.w=function(t,e){return $("#"+this.idPrefix+t).getWidget(e)};return t}();t.PrefixedContext=e;var i;(function(e){function i(e,i){if(i==null){return}var n=ss.getInstanceType(e);if(n===Object){return}var a=n.__propByName;var o=n.__fieldByName;if(a==null){var l=ss.getMembers(n,16,20);var s=l.filter(function(e){return!!e.setter&&((e.attr||[]).filter(function(e){return ss.isInstanceOfType(e,t.OptionAttribute)}).length>0||(e.attr||[]).filter(function(t){return ss.isInstanceOfType(t,System.ComponentModel.DisplayNameAttribute)}).length>0)});a={};for(var u=0,c=s;u<c.length;u++){var d=c[u];a[r.makeCamelCase(d.name)]=d}n.__propByName=a}if(o==null){var f=ss.getMembers(n,4,20);var p=f.filter(function(e){return(e.attr||[]).filter(function(e){return ss.isInstanceOfType(e,t.OptionAttribute)}).length>0||(e.attr||[]).filter(function(t){return ss.isInstanceOfType(t,System.ComponentModel.DisplayNameAttribute)}).length>0});o={};for(var h=0;h<p.length;h++){var g=p[h];o[r.makeCamelCase(g.name)]=g}n.__fieldByName=o}var v=Object.keys(i);for(var y=0,m=v;y<m.length;y++){var b=m[y];var C=i[b];var _=r.makeCamelCase(b);var x=a[_]||a[b];if(x!=null){ss.midel(x.setter,e)(C)}else{var S=o[_]||o[b];if(S!=null){ss.fieldAccess(S,e,C)}}}}e.set=i})(i=t.ReflectionOptionsSetter||(t.ReflectionOptionsSetter={}));var r;(function(t){function e(t,e){var i=t;var n=i["get_"+e];if(!!!(typeof n==="undefined")){return n.apply(t)}var a=r(e);n=i["get_"+a];if(!!!(typeof n==="undefined")){return n.apply(t)}return i[a]}t.getPropertyValue=e;function i(t,e,i){var n=t;var a=n["set_"+e];if(!!!(typeof a==="undefined")){a.apply(t,[i]);return}var o=r(e);a=n["set_"+o];if(!!!(typeof a==="undefined")){a.apply(t,[i]);return}n[o]=i}t.setPropertyValue=i;function r(t){if(Q.isEmptyOrNull(t)){return t}if(t==="ID"){return"id"}var e=false;var i=0;for(var r=0;r<t.length;r++){if(t.charCodeAt(r)>=65&&t.charCodeAt(r)<=90){i++}else{e=true;break}}if(!e&&t.length!==1||i===0){return t}else if(i>1){return t.substr(0,i-1).toLowerCase()+t.substr(i-1)}else if(t.length===1){return t.toLowerCase()}else{return t.substr(0,1).toLowerCase()+t.substr(1)}}t.makeCamelCase=r})(r=t.ReflectionUtils||(t.ReflectionUtils={}));var n=function(){function e(){}e=__decorate([t.Decorators.registerClass("Serenity.ScriptContext")],e);return e}();t.ScriptContext=n})(Serenity||(Serenity={}));var Serenity;(function(t){var e;(function(t){function e(t,e){if(t==null){throw new ss.ArgumentNullException("element")}if(t.length===0){throw new ss.Exception(Q.format("Searching for widget of type '{0}' on a non-existent element! ({1})",ss.getTypeFullName(e),t.selector))}var i=t.tryGetWidget(e);if(i==null){var r=Q.format("Element has no widget of type '{0}'! If you have recently changed editor "+"type of a property in a form class, or changed data type in row (which also changes editor type)"+" your script side Form definition might be out of date. Make sure your project builds successfully "+"and transform T4 templates",ss.getTypeFullName(e));Q.notifyError(r,"",null);throw new ss.Exception(r)}return i}t.getWidget=e;function i(t){return Q.replaceAll(ss.getTypeFullName(t),".","_")}t.getWidgetName=i;function r(t){return!!!(typeof t.originalEvent==="undefined")}t.hasOriginalEvent=r;function n(t,e){t.element.bind("change."+t.uniqueName,e)}t.change=n;function a(t,e){t.element.bind("change."+t.uniqueName,function(t,i){if(!!(r(t)||!i)){e(t)}})}t.changeSelect2=a;function o(t){return t.element.closest(".field")}t.getGridField=o})(e=t.WX||(t.WX={}));t.Widget.prototype["changeSelect2"]=function(t){var i=this;i.element.bind("change."+i.uniqueName,function(i,r){if(!!(e.hasOriginalEvent(i)||!r)){t(i)}})};t.Widget.prototype["change"]=function(t){var e=this;e.element.bind("change."+e.uniqueName,t)};t.Widget.prototype["getGridField"]=function(){return this.element.closest(".field")};$.fn.tryGetWidget=function(i){var r=this;var n;if(ss.isAssignableFrom(t.Widget,i)){var a=e.getWidgetName(i);n=r.data(a);if(n!=null&&!ss.isAssignableFrom(i,ss.getInstanceType(n))){n=null}if(n!=null){return n}}var o=r.data();if(o==null){return null}for(var l=0,s=Object.keys(o);l<s.length;l++){var u=s[l];n=o[u];if(n!=null&&ss.isAssignableFrom(i,ss.getInstanceType(n))){return n}}return null};$.fn.getWidget=function(t){var e=this;if(e==null){throw new ss.ArgumentNullException("element")}if(e.length===0){throw new ss.Exception(Q.format("Searching for widget of type '{0}' on a non-existent element! ({1})",ss.getTypeFullName(t),e.selector))}var i=e.tryGetWidget(t);if(i==null){var r=Q.format("Element has no widget of type '{0}'! If you have recently changed "+"editor type of a property in a form class, or changed data type in row (which also changes "+"editor type) your script side Form definition might be out of date. Make sure your project "+"builds successfully and transform T4 templates",ss.getTypeFullName(t));Q.notifyError(r,"",null);throw new ss.Exception(r)}return i}})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t,i)||this;r.categoryLinkClick=function(t){t.preventDefault();var e=$("a[name="+t.target.getAttribute("href").toString().substr(1)+"]");if(e.closest(".category").hasClass("collapsed"))e.closest(".category").children(".category-title").click();var i=function(){e.fadeTo(100,.5,function(){e.fadeTo(100,1,function(){})})};var r=e.closest(".category");if(r.closest(":scrollable(both)").length===0)i();else{r.scrollintoview({duration:"fast",direction:"y",complete:i})}};if(i.mode==null)i.mode=1;t.addClass("s-PropertyGrid");r.editors=[];r.items=r.options.items||[];var n=Q.any(r.items,function(t){return!Q.isEmptyOrNull(t.tab)});if(n){var a=r.items.filter(function(t){return Q.isEmptyOrNull(t.tab)});if(a.length>0){r.createItems(r.element,a);$("<div class='pad'></div>").appendTo(r.element)}var o=r.items.filter(function(t){return!Q.isEmptyOrNull(t.tab)});var l=$("<ul class='nav nav-tabs property-tabs' role='tablist'></ul>").appendTo(r.element);var s=$("<div class='tab-content property-panes'></div>").appendTo(r.element);var u=0;var c=0;while(c<o.length){var d={$:Q.trimToEmpty(o[c].tab)};var f=[];var p=c;do{f.push(o[p])}while(++p<o.length&&Q.trimToEmpty(o[p].tab)===d.$);c=p;var h=$("<li><a data-toggle='tab' role='tab'></a></li>").appendTo(l);if(u===0){h.addClass("active")}var g=r.uniqueName+"_Tab"+u;h.children("a").attr("href","#"+g).text(r.determineText(d.$,ss.mkdel({tab:d},function(t){return t+"Tabs."+this.tab.$})));var v=$("<div class='tab-pane fade' role='tabpanel'>").appendTo(s);if(u===0){v.addClass("in active")}v.attr("id",g);r.createItems(v,f);u++}}else{r.createItems(r.element,r.items)}r.updateInterface();return r}r=i;i.prototype.destroy=function(){if(this.editors!=null){for(var e=0;e<this.editors.length;e++){this.editors[e].destroy()}this.editors=null}this.element.find("a.category-link").unbind("click",this.categoryLinkClick).remove();t.Widget.prototype.destroy.call(this)};i.prototype.createItems=function(t,e){var i={};var r=t;var n=this.options.useCategories!==false&&Q.any(e,function(t){return!Q.isEmptyOrNull(t.category)});if(n){var a=$("<div/>").addClass("category-links");i=this.createCategoryLinks(a,e);if(Object.keys(i).length>1){a.appendTo(t)}else{a.find("a.category-link").unbind("click",this.categoryLinkClick).remove()}}r=$("<div/>").addClass("categories").appendTo(t);var o;if(n){o=r}else{o=$("<div/>").addClass("category").appendTo(r)}var l=null;for(var s=0;s<e.length;s++){var u=e[s];var c=u.category;if(c==null){c=Q.coalesce(this.options.defaultCategory,"")}if(n&&l!==c){var d=this.createCategoryDiv(r,i,c,u.collapsible!==true?null:Q.coalesce(u.collapsed,false));if(l==null){d.addClass("first-category")}l=c;o=d}var f=this.createField(o,u);this.editors.push(f)}};i.prototype.createCategoryDiv=function(t,e,i,r){var n=$("<div/>").addClass("category").appendTo(t);var a=$("<div/>").addClass("category-title").append($("<a/>").addClass("category-anchor").text(this.determineText(i,function(t){return t+"Categories."+i})).attr("name",this.options.idPrefix+"Category"+e[i].toString())).appendTo(n);if(r!=null){n.addClass(r===true?"collapsible collapsed":"collapsible");var o=$("<i/>").addClass(r===true?"fa fa-plus":"fa fa-minus").appendTo(a);a.click(function(t){n.toggleClass("collapsed");o.toggleClass("fa-plus").toggleClass("fa-minus")})}return n};i.prototype.determineText=function(t,e){if(t!=null&&!Q.startsWith(t,"`")){var i=Q.tryGetText(t);if(i!=null){return i}}if(t!=null&&Q.startsWith(t,"`")){t=t.substr(1)}if(!Q.isEmptyOrNull(this.options.localTextPrefix)){var r=Q.tryGetText(e(this.options.localTextPrefix));if(r!=null){return r}}return t};i.prototype.createField=function(e,i){var n=$("<div/>").addClass("field").addClass(i.name).data("PropertyItem",i).appendTo(e);if(!Q.isEmptyOrNull(i.cssClass)){n.addClass(i.cssClass)}if(!Q.isEmptyOrNull(i.formCssClass)){n.addClass(i.formCssClass);if(i.formCssClass.indexOf("line-break-")>=0){var a=i.formCssClass.split(String.fromCharCode(32));if(a.indexOf("line-break-xs")>=0){$("<div class='line-break' style='width: 100%' />").insertBefore(n)}else if(a.indexOf("line-break-sm")>=0){$("<div class='line-break hidden-xs' style='width: 100%' />").insertBefore(n)}else if(a.indexOf("line-break-md")>=0){$("<div class='line-break hidden-sm' style='width: 100%' />").insertBefore(n)}else if(a.indexOf("line-break-lg")>=0){$("<div class='line-break hidden-md' style='width: 100%' />").insertBefore(n)}}}var o=this.options.idPrefix+i.name;var l=this.determineText(i.title,function(t){return t+i.name});var s=this.determineText(i.hint,function(t){return t+i.name+"_Hint"});var u=this.determineText(i.placeholder,function(t){return t+i.name+"_Placeholder"});if(s==null){s=Q.coalesce(l,"")}var c=$("<label/>").addClass("caption").attr("for",o).attr("title",s).html(Q.coalesce(l,"")).appendTo(n);if(!Q.isEmptyOrNull(i.labelWidth)){if(i.labelWidth==="0"){c.hide()}else{c.css("width",i.labelWidth)}}if(i.required===true){$("<sup>*</sup>").attr("title",Q.text("Controls.PropertyGrid.RequiredHint")).prependTo(c)}var d=t.EditorTypeRegistry.get(Q.coalesce(i.editorType,"String"));var f=ss.getAttributes(d,t.ElementAttribute,true);var p=f.length>0?f[0].value:"<input/>";var h=t.Widget.elementFor(d).addClass("editor").addClass("flexify").attr("id",o).appendTo(n);if(h.is(":input")){h.attr("name",Q.coalesce(i.name,""))}if(!Q.isEmptyOrNull(u)){h.attr("placeholder",u)}var g=i.editorParams;var v=null;var y=ss.getAttributes(d,t.OptionsTypeAttribute,true);if(y!=null&&y.length>0){v=y[0].optionsType}var m;if(v!=null){g=$.extend(ss.createInstance(v),i.editorParams);m=new d(h,g)}else{g=$.extend(new Object,i.editorParams);m=new d(h,g)}m.initialize();if(ss.isInstanceOfType(m,t.BooleanEditor)&&(i.editorParams==null||!!!i.editorParams["labelFor"])){c.removeAttr("for")}if(ss.isInstanceOfType(m,t.RadioButtonEditor)&&(i.editorParams==null||!!!i.editorParams["labelFor"])){c.removeAttr("for")}if(i.maxLength!=null){r.setMaxLength(m,i.maxLength)}if(i.editorParams!=null){t.ReflectionOptionsSetter.set(m,i.editorParams)}$("<div/>").addClass("vx").appendTo(n);$("<div/>").addClass("clear").appendTo(n);return m};i.prototype.getCategoryOrder=function(t){var e=0;var i={};var r=Q.trimToNull(this.options.categoryOrder);if(r!=null){var n=r.split(";");for(var a=0,o=n;a<o.length;a++){var l=o[a];var s=Q.trimToNull(l);if(s==null){continue}if(i[s]!=null){continue}i[s]=e++}}for(var u=0,c=t;u<c.length;u++){var d=c[u];var f=d.category;if(f==null){f=Q.coalesce(this.options.defaultCategory,"")}if(i[f]==null){i[f]=e++}}return i};i.prototype.createCategoryLinks=function(t,e){var i=0;var r={};var n={};for(var a=0,o=e;a<o.length;a++){var l=o[a];var s=l.name;var u=l.category;if(u==null){u=Q.coalesce(this.options.defaultCategory,"")}n[s]=u;r[l.name]=i++}var c=this;var d=this.getCategoryOrder(e);e.sort(function(t,e){var i=0;var a=n[t.name];var o=n[e.name];if(!ss.referenceEquals(a,o)){var l=d[a];var s=d[o];if(l!=null&&s!=null){i=l-s}else if(l!=null){i=-1}else if(s!=null){i=1}}if(i===0){i=ss.compareStrings(a,o)}if(i===0){i=ss.compare(r[t.name],r[e.name])}return i});var f={};for(var p=0;p<e.length;p++){var h=e[p];var g={$:n[h.name]};if(f[g.$]==null){var v=Object.keys(f).length+1;f[g.$]=v;if(v>1){$("<span/>").addClass("separator").text("|").prependTo(t)}$("<a/>").addClass("category-link").text(this.determineText(g.$,ss.mkdel({category:g},function(t){return t+"Categories."+this.category.$}))).attr("tabindex","-1").attr("href","#"+this.options.idPrefix+"Category"+v.toString()).click(this.categoryLinkClick).prependTo(t)}}$("<div/>").addClass("clear").appendTo(t);return f};i.prototype.get_editors=function(){return this.editors};i.prototype.get_items=function(){return this.items};i.prototype.get_idPrefix=function(){return this.options.idPrefix};i.prototype.get_mode=function(){return this.options.mode
};i.prototype.set_mode=function(t){if(this.options.mode!==t){this.options.mode=t;this.updateInterface()}};i.loadEditorValue=function(t,e,i){};i.saveEditorValue=function(e,i,r){t.EditorUtils.saveValue(e,i,r)};i.setReadOnly=function(e,i){t.EditorUtils.setReadOnly(e,i)};i.setReadonly=function(e,i){return t.EditorUtils.setReadonly(e,i)};i.setRequired=function(e,i){t.EditorUtils.setRequired(e,i)};i.setMaxLength=function(t,e){if(t.element.is(":input")){if(e>0){t.element.attr("maxlength",e)}else{t.element.removeAttr("maxlength")}}};i.prototype.load=function(e){for(var i=0;i<this.editors.length;i++){var r=this.items[i];var n=this.editors[i];if(!!(this.get_mode()===1&&r.defaultValue!=null)&&typeof e[r.name]==="undefined"){e[r.name]=r.defaultValue}t.EditorUtils.loadValue(n,r,e)}};i.prototype.save=function(e){if(e==null)e=Object.create(null);for(var i=0;i<this.editors.length;i++){var r=this.items[i];if(r.oneWay!==true&&this.canModifyItem(r)){var n=this.editors[i];t.EditorUtils.saveValue(n,r,e)}}return e};Object.defineProperty(i.prototype,"value",{get:function(){return this.save()},set:function(t){if(t==null)t=Object.create(null);this.load(t)},enumerable:true,configurable:true});i.prototype.canModifyItem=function(t){if(this.get_mode()===1){if(t.insertable===false){return false}if(t.insertPermission==null){return true}return Q.Authorization.hasPermission(t.insertPermission)}else if(this.get_mode()===2){if(t.updatable===false){return false}if(t.updatePermission==null){return true}return Q.Authorization.hasPermission(t.updatePermission)}return true};i.prototype.updateInterface=function(){for(var e=0;e<this.editors.length;e++){var i=this.items[e];var r=this.editors[e];var n=i.readOnly===true||!this.canModifyItem(i);t.EditorUtils.setReadOnly(r,n);t.EditorUtils.setRequired(r,!n&&!!i.required&&i.editorType!=="Boolean");if(i.visible===false||i.readPermission!=null||i.insertPermission!=null||i.updatePermission!=null||i.hideOnInsert===true||i.hideOnUpdate===true){var a=i.readPermission!=null&&!Q.Authorization.hasPermission(i.readPermission)||i.visible===false||this.get_mode()===1&&i.hideOnInsert===true||this.get_mode()===2&&i.hideOnUpdate===true;r.getGridField().toggle(!a)}}};i.prototype.enumerateItems=function(t){for(var e=0;e<this.editors.length;e++){var i=this.items[e];var r=this.editors[e];t(i,r)}};var r;i=r=__decorate([t.Decorators.registerClass("PropertyGrid")],i);return i}(t.Widget);t.PropertyGrid=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t,i)||this;t.addClass("s-PopupMenuButton");t.click(function(t){t.preventDefault();t.stopPropagation();if(r.options.onPopup!=null){r.options.onPopup()}var e=r.options.menu;e.show().position({my:Q.coalesce(r.options.positionMy,"left top"),at:Q.coalesce(r.options.positionAt,"left bottom"),of:r.element});var i=r.uniqueName;$(document).one("click."+i,function(t){e.hide()})});r.options.menu.hide().appendTo(document.body).addClass("s-PopupMenu").menu();return r}i.prototype.destroy=function(){if(this.options.menu!=null){this.options.menu.remove();this.options.menu=null}e.prototype.destroy.call(this)};i=__decorate([t.Decorators.registerEditor("Serenity.PopupMenuButton")],i);return i}(t.Widget);t.PopupMenuButton=e;var i=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t,i)||this;t.addClass("s-PopupToolButton");$("<b/>").appendTo(t.children(".button-outer").children("span"));return r}i=__decorate([t.Decorators.registerEditor("Serenity.PopupToolButton")],i);return i}(e);t.PopupToolButton=i;var r=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t,i)||this;r.element.addClass("s-Toolbar clearfix").html('<div class="tool-buttons"><div class="buttons-outer">'+'<div class="buttons-inner"></div></div></div>');var n=$("div.buttons-inner",r.element);var a=r.options.buttons;for(var o=0;o<a.length;o++){r.createButton(n,a[o])}return r}i.prototype.destroy=function(){this.element.find("div.tool-button").unbind("click");if(this.mouseTrap){if(!!this.mouseTrap.destroy){this.mouseTrap.destroy()}else{this.mouseTrap.reset()}this.mouseTrap=null}e.prototype.destroy.call(this)};i.prototype.createButton=function(t,e){var i=Q.coalesce(e.cssClass,"");if(e.separator===true||e.separator==="left"||e.separator==="both"){$('<div class="separator"></div>').appendTo(t)}var r=$('<div class="tool-button"><div class="button-outer">'+'<span class="button-inner"></span></div></div>').appendTo(t);if(e.separator==="right"||e.separator==="both"){$('<div class="separator"></div>').appendTo(t)}if(i.length>0){r.addClass(i)}if(!Q.isEmptyOrNull(e.hint)){r.attr("title",e.hint)}r.click(function(t){if(r.hasClass("disabled")){return}e.onClick(t)});var n=e.title;if(e.htmlEncode!==false){n=Q.htmlEncode(e.title)}if(!Q.isEmptyOrNull(e.icon)){r.addClass("icon-tool-button");var a=e.icon;if(Q.startsWith(a,"fa-")){a="fa "+a}else if(Q.startsWith(a,"glyphicon-")){a="glyphicon "+a}n="<i class='"+a+"'></i> "+n}if(n==null||n.length===0){r.addClass("no-text")}else{r.find("span").html(n)}if(!!(!Q.isEmptyOrNull(e.hotkey)&&window["Mousetrap"]!=null)){this.mouseTrap=this.mouseTrap||window["Mousetrap"](e.hotkeyContext||this.options.hotkeyContext||window.document.documentElement);this.mouseTrap.bind(e.hotkey,function(t,i){if(r.is(":visible")){r.triggerHandler("click")}return e.hotkeyAllowDefault})}};i.prototype.findButton=function(t){if(t!=null&&Q.startsWith(t,".")){t=t.substr(1)}return $("div.tool-button."+t,this.element)};i=__decorate([t.Decorators.registerClass("Serenity.Toolbar")],i);return i}(t.Widget);t.Toolbar=r})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(){function e(){}e=__decorate([t.Decorators.registerInterface("Serenity.IValidateRequired")],e);return e}();t.IValidateRequired=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(){function e(){}e=__decorate([t.Decorators.registerInterface("Serenity.IDialog")],e);return e}();t.IDialog=e;var i=function(e){__extends(i,e);function i(t){var i=e.call(this,Q.newBodyDiv().addClass("s-TemplatedDialog hidden"),t)||this;i.element.attr("id",i.uniqueName);i.initValidator();i.initTabs();i.initToolbar();return i}r=i;Object.defineProperty(i.prototype,"isMarkedAsPanel",{get:function(){var e=ss.getAttributes(ss.getInstanceType(this),t.PanelAttribute,true);return e.length>0&&e[e.length-1].value!==false},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"isResponsive",{get:function(){return Q.Config.responsiveDialogs||ss.getAttributes(ss.getInstanceType(this),t.ResponsiveAttribute,true).length>0},enumerable:true,configurable:true});i.getCssSize=function(t,e){var i=t.css(e);if(i==null){return null}if(!Q.endsWith(i,"px")){return null}i=i.substr(0,i.length-2);var r=Q.parseInteger(i);if(r==null||isNaN(r)||r==0)return null;return r};i.applyCssSizes=function(t,e){var i;var n=$("<div/>").hide().addClass(e).appendTo(document.body);try{var a=$("<div/>").addClass("size").appendTo(n);i=r.getCssSize(a,"minWidth");if(i!=null)t.minWidth=i;i=r.getCssSize(a,"width");if(i!=null)t.width=i;i=r.getCssSize(a,"height");if(i!=null)t.height=i;i=r.getCssSize(a,"minHeight");if(i!=null)t.minHeight=i}finally{n.remove()}};i.prototype.destroy=function(){this.tabs&&this.tabs.tabs("destroy");this.tabs=null;this.toolbar&&this.toolbar.destroy();this.toolbar=null;this.validator&&this.byId("Form").remove();this.validator=null;if(this.element!=null&&this.element.hasClass("ui-dialog-content")){this.element.dialog("destroy");this.element.removeClass("ui-dialog-content")}$(window).unbind("."+this.uniqueName);e.prototype.destroy.call(this)};i.prototype.initDialog=function(){var e=this;if(this.element.hasClass("ui-dialog-content"))return;this.element.removeClass("hidden");this.element.dialog(this.getDialogOptions());this.element.closest(".ui-dialog").on("resize",function(t){return e.arrange()});var i=ss.getInstanceType(this);if(this.isResponsive){t.DialogExtensions.dialogResizable(this.element);$(window).bind("resize."+this.uniqueName,function(t){if(e.element&&e.element.is(":visible")){e.handleResponsive()}});this.element.closest(".ui-dialog").addClass("flex-layout")}else if(ss.getAttributes(i,t.FlexifyAttribute,true).length>0){t.DialogExtensions.dialogFlexify(this.element);t.DialogExtensions.dialogResizable(this.element)}if(ss.getAttributes(i,t.MaximizableAttribute,true).length>0){t.DialogExtensions.dialogMaximizable(this.element)}var r=this;this.element.bind("dialogopen."+this.uniqueName,function(){$(document.body).addClass("modal-dialog-open");if(e.isResponsive){e.handleResponsive()}r.onDialogOpen()});this.element.bind("dialogclose."+this.uniqueName,function(){$(document.body).toggleClass("modal-dialog-open",$(".ui-dialog:visible").length>0);r.onDialogClose()})};i.prototype.initToolbar=function(){var e=this.byId("Toolbar");if(e.length===0){return}var i=this.element.closest(".ui-dialog");if(i.length===0){i=this.element}var r={buttons:this.getToolbarButtons(),hotkeyContext:i[0]};this.toolbar=new t.Toolbar(e,r)};i.prototype.getToolbarButtons=function(){return[]};i.prototype.getValidatorOptions=function(){return{}};i.prototype.initValidator=function(){var t=this.byId("Form");if(t.length>0){var e=this.getValidatorOptions();this.validator=t.validate(Q.validateOptions(e))}};i.prototype.resetValidation=function(){this.validator&&this.validator.resetAll()};i.prototype.validateForm=function(){return this.validator==null||!!this.validator.form()};i.prototype.dialogOpen=function(t){var e=this;t=Q.coalesce(t,this.isMarkedAsPanel);if(t){if(!this.element.hasClass("s-Panel")){this.element.on("panelopen."+this.uniqueName,function(){e.onDialogOpen()});this.element.on("panelclose."+this.uniqueName,function(){e.onDialogClose()})}r.openPanel(this.element,this.uniqueName);this.setupPanelTitle()}else{if(!this.element.hasClass("ui-dialog-content"))this.initDialog();this.element.dialog("open")}};i.openPanel=function(t,e){var i=$(".panels-container");if(!i.length)i=$("section.content");t.data("paneluniquename",e);if(i.length){i=i.last();i.children().not(t).not(".panel-hidden").addClass("panel-hidden panel-hidden-"+e);if(t[0].parentElement!==i[0])t.appendTo(i)}$(".ui-dialog:visible, .ui-widget-overlay:visible").not(t).addClass("panel-hidden panel-hidden-"+e);t.removeClass("hidden").removeClass("panel-hidden").addClass("s-Panel").trigger("panelopen")};i.closePanel=function(t,e){if(!t.hasClass("s-Panel")||t.hasClass("hidden"))return;var i=$.Event(e);i.type="panelbeforeclose";i.target=t[0];t.trigger(i);if(i.isDefaultPrevented())return;t.addClass("hidden");var r=t.data("paneluniquename")||(new Date).getTime();var n="panel-hidden-"+r;$("."+n).removeClass(n).removeClass("panel-hidden");$(window).triggerHandler("resize");$(".require-layout:visible").triggerHandler("layout");var e=$.Event(e);e.type="panelclose";e.target=t[0];t.trigger(e)};i.prototype.onDialogOpen=function(){if(!$(document.body).hasClass("mobile-device"))$(":input",this.element).not("button").eq(0).focus();this.arrange();this.tabs&&this.tabs.tabs("option","active",0)};i.prototype.arrange=function(){this.element.find(".require-layout").filter(":visible").each(function(t,e){$(e).triggerHandler("layout")})};i.prototype.onDialogClose=function(){var t=this;$(document).trigger("click");if($.qtip){$(document.body).children(".qtip").each(function(t,e){$(e).qtip("hide")})}window.setTimeout(function(){var e=t.element;t.destroy();e.remove();Q.positionToastContainer(false)},0)};i.prototype.addCssClass=function(){if(this.isMarkedAsPanel){e.prototype.addCssClass.call(this);if(this.isResponsive)this.element.addClass("flex-layout")}};i.prototype.getDialogOptions=function(){var e={};var i="s-Dialog "+this.getCssClass();e.dialogClass=i;e.width=920;r.applyCssSizes(e,i);e.autoOpen=false;var n=ss.getInstanceType(this);e.resizable=ss.getAttributes(n,t.ResizableAttribute,true).length>0;e.modal=true;e.position={my:"center",at:"center",of:$(window.window)};e.title=Q.coalesce(this.element.data("dialogtitle"),this.getDialogTitle())||"";return e};i.prototype.getDialogTitle=function(){return""};i.prototype.dialogClose=function(){if(this.element.hasClass("ui-dialog-content"))this.element.dialog().dialog("close");else if(this.element.hasClass("s-Panel")&&!this.element.hasClass("hidden")){r.closePanel(this.element)}};Object.defineProperty(i.prototype,"dialogTitle",{get:function(){if(this.element.hasClass("ui-dialog-content"))return this.element.dialog("option","title");return this.element.data("dialogtitle")},set:function(t){var e=this.dialogTitle;this.element.data("dialogtitle",t);if(this.element.hasClass("ui-dialog-content"))this.element.dialog("option","title",t);else if(this.element.hasClass("s-Panel")){if(e!=this.dialogTitle){this.setupPanelTitle();this.arrange()}}},enumerable:true,configurable:true});i.prototype.setupPanelTitle=function(){var t=this;var e=Q.coalesce(this.dialogTitle,this.getDialogTitle());var i=this.element.children(".panel-titlebar");if(Q.isEmptyOrNull(e)){i.remove()}else{if(!this.element.children(".panel-titlebar").length){i=$("<div class='panel-titlebar'><div class='panel-titlebar-text'></div></div>").prependTo(this.element)}i.children(".panel-titlebar-text").text(e);if(this.element.hasClass("s-Panel")){if(!i.children(".panel-titlebar-close").length){$('<button class="panel-titlebar-close">&nbsp;</button>').prependTo(i).click(function(e){r.closePanel(t.element,e)})}}}};i.prototype.set_dialogTitle=function(t){this.dialogTitle=t};i.prototype.initTabs=function(){var t=this;var e=this.byId("Tabs");if(e.length===0){return}this.tabs=e.tabs({});this.tabs.bind("tabsactivate",function(){return t.arrange()})};i.prototype.handleResponsive=function(){var t=this.element.dialog();var e=this.element.closest(".ui-dialog");if($(document.body).hasClass("mobile-device")){var i=this.element.data("responsiveData");if(!i){i={};i.draggable=t.dialog("option","draggable");i.resizable=t.dialog("option","resizable");i.position=t.css("position");var r=e.position();i.left=r.left;i.top=r.top;i.width=e.width();i.height=e.height();i.contentHeight=this.element.height();this.element.data("responsiveData",i);t.dialog("option","draggable",false);t.dialog("option","resizable",false)}e.addClass("mobile-layout");e.css({left:"0px",top:"0px",width:$(window).width()+"px",height:$(window).height()+"px",position:"fixed"});$(document.body).scrollTop(0);Q.layoutFillHeight(this.element)}else{var n=this.element.data("responsiveData");if(n){t.dialog("option","draggable",n.draggable);t.dialog("option","resizable",n.resizable);this.element.closest(".ui-dialog").css({left:"0px",top:"0px",width:n.width+"px",height:n.height+"px",position:n.position});this.element.height(n.contentHeight);e.removeClass("mobile-layout");this.element.removeData("responsiveData")}}};var r;i=r=__decorate([t.Decorators.registerClass([t.IDialog])],i);return i}(t.TemplatedWidget);t.TemplatedDialog=i})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(t){var i=e.call(this,t)||this;if(!i.isAsyncWidget()){i.initPropertyGrid();i.loadInitialEntity()}return i}i.prototype.destroy=function(){if(this.propertyGrid){this.propertyGrid.destroy();this.propertyGrid=null}if(this.validator){this.byId("Form").remove();this.validator=null}e.prototype.destroy.call(this)};i.prototype.initPropertyGridAsync=function(){var e=this;return Promise.resolve().then(function(){var i=e.byId("PropertyGrid");if(i.length<=0){return Promise.resolve()}return e.getPropertyGridOptionsAsync().then(function(r){e.propertyGrid=new t.PropertyGrid(i,r);if(e.element.closest(".ui-dialog").hasClass("s-Flexify")){e.propertyGrid.element.children(".categories").flexHeightOnly(1)}return e.propertyGrid.initialize()})})};i.prototype.getDialogOptions=function(){var t=e.prototype.getDialogOptions.call(this);t.buttons=this.getDialogButtons();t.width=400;return t};i.prototype.getDialogButtons=function(){var t=this;return[{text:Q.text("Dialogs.OkButton"),click:function(){return t.okClick()}},{text:Q.text("Dialogs.CancelButton"),click:function(){return t.cancelClick()}}]};i.prototype.okClick=function(){if(!this.validateBeforeSave()){return}this.okClickValidated()};i.prototype.okClickValidated=function(){this.dialogClose()};i.prototype.cancelClick=function(){this.dialogClose()};i.prototype.initPropertyGrid=function(){var e=this.byId("PropertyGrid");if(e.length<=0){return}var i=this.getPropertyGridOptions();this.propertyGrid=new t.PropertyGrid(e,i).init(null);if(this.element.closest(".ui-dialog").hasClass("s-Flexify")){this.propertyGrid.element.children(".categories").flexHeightOnly(1)}};i.prototype.getFormKey=function(){var e=ss.getAttributes(ss.getInstanceType(this),t.FormKeyAttribute,true);if(e.length>=1){return e[0].value}else{var i=ss.getTypeFullName(ss.getInstanceType(this));var r=i.indexOf(".");if(r>=0){i=i.substring(r+1)}if(Q.endsWith(i,"Dialog")){i=i.substr(0,i.length-6)}else if(Q.endsWith(i,"Panel")){i=i.substr(0,i.length-5)}return i}};i.prototype.getPropertyGridOptions=function(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,useCategories:false,localTextPrefix:"Forms."+this.getFormKey()+"."}};i.prototype.getPropertyGridOptionsAsync=function(){var t=this;return this.getPropertyItemsAsync().then(function(e){return{idPrefix:t.idPrefix,items:e,mode:1,useCategories:false,localTextPrefix:"Forms."+t.getFormKey()+"."}})};i.prototype.getPropertyItems=function(){var t=this.getFormKey();return Q.getForm(t)};i.prototype.getPropertyItemsAsync=function(){var t=this;return Promise.resolve().then(function(){var e=t.getFormKey();return Q.getFormAsync(e)})};i.prototype.getSaveEntity=function(){var t=new Object;if(this.propertyGrid){this.propertyGrid.save(t)}return t};i.prototype.initializeAsync=function(){var t=this;return e.prototype.initializeAsync.call(this).then(function(){return t.initPropertyGridAsync()}).then(function(){return t.loadInitialEntity()})};i.prototype.loadInitialEntity=function(){this.propertyGrid&&this.propertyGrid.load(new Object)};i.prototype.get_entity=function(){return this._entity};i.prototype.set_entity=function(t){this._entity=Q.coalesce(t,new Object)};i.prototype.get_entityId=function(){return this._entityId};i.prototype.set_entityId=function(t){this._entityId=t};i.prototype.validateBeforeSave=function(){return this.validator.form()};i.prototype.updateTitle=function(){};i=__decorate([t.Decorators.registerClass("Serenity.PropertyDialog")],i);return i}(t.TemplatedDialog);t.PropertyDialog=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(){var i=e.call(this)||this;i.filterPanel=new t.FilterPanel(i.byId("FilterPanel"));i.filterPanel.set_showInitialLine(true);i.filterPanel.set_showSearchButton(false);i.filterPanel.set_updateStoreOnReset(false);return i}i.prototype.get_filterPanel=function(){return this.filterPanel};i.prototype.getTemplate=function(){return'<div id="~_FilterPanel"/>'};i.prototype.getDialogOptions=function(){var t=this;var i=e.prototype.getDialogOptions.call(this);i.buttons=[{text:Q.text("Dialogs.OkButton"),click:function(){t.filterPanel.search();if(t.filterPanel.get_hasErrors()){Q.notifyError(Q.text("Controls.FilterPanel.FixErrorsMessage"),"",null);return}t.dialogClose()}},{text:Q.text("Dialogs.CancelButton"),click:function(){return t.dialogClose()}}];i.title=Q.text("Controls.FilterPanel.DialogTitle");return i};i=__decorate([t.Decorators.registerClass("Serenity.FilterDialog")],i);return i}(t.TemplatedDialog);t.FilterDialog=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(){function e(){}e=__decorate([t.Decorators.registerInterface("Serenity.IDataGrid")],e);return e}();t.IDataGrid=e;var i=function(i){__extends(r,i);function r(t,e){var r=i.call(this,t,e)||this;r.restoringSettings=0;var n=r;r.element.addClass("s-DataGrid").html("");r.element.addClass("s-"+ss.getTypeName(ss.getInstanceType(r)));r.element.addClass("require-layout").bind("layout."+r.uniqueName,function(){n.layout()});r.setTitle(r.getInitialTitle());var a=r.getButtons();if(a!=null){r.createToolbar(a)}r.slickContainer=r.createSlickContainer();r.view=r.createView();r.slickGrid=r.createSlickGrid();if(r.enableFiltering()){r.createFilterBar()}if(r.usePager()){r.createPager()}r.bindToSlickEvents();r.bindToViewEvents();if(a!=null){r.createToolbarExtensions()}r.createQuickFilters();r.updateDisabledState();if(!r.isAsyncWidget()){r.initialSettings=r.getCurrentSettings(null);r.restoreSettings(null,null);window.setTimeout(function(){return r.initialPopulate()},0)}return r}r.prototype.attrs=function(t){return ss.getAttributes(ss.getInstanceType(this),t,true)};r.prototype.add_submitHandlers=function(t){this.submitHandlers=ss.delegateCombine(this.submitHandlers,t)};r.prototype.remove_submitHandlers=function(t){this.submitHandlers=ss.delegateRemove(this.submitHandlers,t)};r.prototype.layout=function(){if(!this.element.is(":visible")||this.slickContainer==null)return;var t=this.element.hasClass("responsive-height");var e=this.slickGrid!=null&&this.slickGrid.getOptions().autoHeight;var i=t&&window.innerWidth<768;if(i){if(this.element[0]&&this.element[0].style.height!="auto")this.element[0].style.height="auto";if(!e){this.slickContainer.css("height","auto").children(".slick-pane").each(function(t,e){if(e.style.height!=null&&e.style.height!="auto")e.style.height="auto"});this.slickGrid.setOptions({autoHeight:true})}}else{if(e){this.slickContainer.children(".slick-viewport").css("height","auto");this.slickGrid.setOptions({autoHeight:false})}Q.layoutFillHeight(this.slickContainer)}this.slickGrid.resizeCanvas()};r.prototype.getInitialTitle=function(){return null};r.prototype.createToolbarExtensions=function(){};r.prototype.createQuickFilters=function(){var t=this.getQuickFilters();for(var e=0;e<t.length;e++){var i=t[e];this.addQuickFilter(i)}};r.prototype.getQuickFilters=function(){var e=[];var i=this.allColumns.filter(function(t){return t.sourceItem&&t.sourceItem.quickFilter===true&&(t.sourceItem.readPermission==null||Q.Authorization.hasPermission(t.sourceItem.readPermission))});for(var r=0,n=i;r<n.length;r++){var a=n[r];var o=a.sourceItem;var l={};var s=o.name;var u=Q.tryGetText(o.title);if(u==null){u=o.title;if(u==null){u=s}}var c=t.FilteringTypeRegistry.get(Q.coalesce(o.filteringType,"String"));if(c===t.DateFiltering){l=this.dateRangeQuickFilter(s,u)}else if(c===t.DateTimeFiltering){l=this.dateTimeRangeQuickFilter(s,u)}else if(c===t.BooleanFiltering){var d=o.quickFilterParams||{};var f=o.filteringParams||{};var p=d["trueText"];if(p==null){p=f["trueText"]}var h=d["falseText"];if(h==null){h=f["falseText"]}l=this.booleanQuickFilter(s,u,p,h)}else{var g=new c;if(g&&ss.isInstanceOfType(g,t.IQuickFiltering)){t.ReflectionOptionsSetter.set(g,o.filteringParams);g.set_field(o);g.set_operator({key:t.FilterOperators.EQ});g.initQuickFilter(l);l.options=Q.deepClone(l.options,o.quickFilterParams)}else{continue}}if(!!o.quickFilterSeparator){l.separator=true}l.cssClass=o.quickFilterCssClass;e.push(l)}return e};r.prototype.findQuickFilter=function(t,e){return $("#"+this.uniqueName+"_QuickFilter_"+e).getWidget(t)};r.prototype.tryFindQuickFilter=function(t,e){var i=$("#"+this.uniqueName+"_QuickFilter_"+e);if(!i.length)return null;return i.tryGetWidget(t)};r.prototype.createIncludeDeletedButton=function(){if(!Q.isEmptyOrNull(this.getIsActiveProperty())||!Q.isEmptyOrNull(this.getIsDeletedProperty())){t.GridUtils.addIncludeDeletedToggle(this.toolbar.element,this.view,null,false)}};r.prototype.getQuickSearchFields=function(){return null};r.prototype.createQuickSearchInput=function(){t.GridUtils.addQuickSearchInput(this.toolbar.element,this.view,this.getQuickSearchFields())};r.prototype.destroy=function(){this.submitHandlers=null;if(this.toolbar){this.toolbar.destroy();this.toolbar=null}if(this.slickGrid){this.slickGrid.onClick.clear();this.slickGrid.onSort.clear();this.slickGrid.onColumnsResized.clear();this.slickGrid.onColumnsReordered.clear();this.slickGrid.destroy();this.slickGrid=null}if(this.view){this.view.onDataChanged.clear();this.view.onSubmit=null;this.view.setFilter(null);this.view=null}this.titleDiv=null;i.prototype.destroy.call(this)};r.prototype.getItemCssClass=function(t,e){var i=this.getIsActiveProperty();var r=this.getIsDeletedProperty();if(Q.isEmptyOrNull(i)&&Q.isEmptyOrNull(r)){return null}if(i){var n=t[i];if(n==null){return null}if(typeof n==="number"){if(n<0){return"deleted"}else if(n===0){return"inactive"}}else if(typeof n==="boolean"){if(n===false){return"deleted"}}}else{return t[r]?"deleted":null}return null};r.prototype.getItemMetadata=function(t,e){var i=this.getItemCssClass(t,e);if(Q.isEmptyOrNull(i)){return new Object}return{cssClasses:i}};r.prototype.postProcessColumns=function(e){t.SlickHelper.setDefaults(e,this.getLocalTextDbPrefix());return e};r.prototype.initialPopulate=function(){var e=this;if(this.populateWhenVisible()){t.LazyLoadHelper.executeEverytimeWhenShown(this.element,function(){e.refreshIfNeeded()},false);if(this.element.is(":visible")&&this.view){this.view.populate()}}else if(this.view){this.view.populate()}};r.prototype.canFilterColumn=function(t){return t.sourceItem!=null&&t.sourceItem.notFilterable!==true&&(t.sourceItem.readPermission==null||Q.Authorization.hasPermission(t.sourceItem.readPermission))};r.prototype.initializeFilterBar=function(){var e=this;this.filterBar.set_store(new t.FilterStore(this.allColumns.filter(function(t){return e.canFilterColumn(t)}).map(function(t){return t.sourceItem})));this.filterBar.get_store().add_changed(function(t,i){if(e.restoringSettings<=0){e.persistSettings(null);e.view&&(e.view.seekToPage=1);e.refresh()}})};r.prototype.initializeAsync=function(){var t=this;return i.prototype.initializeAsync.call(this).then(function(){return t.getColumnsAsync()}).then(function(e){t.allColumns=e;t.postProcessColumns(t.allColumns);t.filterBar&&t.initializeFilterBar();var i=t.allColumns.filter(function(t){return t.visible!==false});if(t.slickGrid){t.slickGrid.setColumns(i)}t.setInitialSortOrder();t.initialSettings=t.getCurrentSettings(null);t.restoreSettings(null,null);t.initialPopulate()},null)};r.prototype.createSlickGrid=function(){var t;if(this.isAsyncWidget()){t=[]}else{this.allColumns=this.getColumns();t=this.postProcessColumns(this.allColumns).filter(function(t){return t.visible!==false})}var e=this.getSlickOptions();var i=new Slick.Grid(this.slickContainer,this.view,t,e);i.registerPlugin(new Slick.AutoTooltips({enableForHeaderCells:true}));this.slickGrid=i;this.rows=this.slickGrid;if(!this.isAsyncWidget()){this.setInitialSortOrder()}return i};r.prototype.setInitialSortOrder=function(){var t=this.getDefaultSortBy();if(this.view){this.view.sortBy=Array.prototype.slice.call(t)}var e=t.map(function(t){var e={};if(t&&Q.endsWith(t.toLowerCase()," desc")){e.columnId=ss.trimEndString(t.substr(0,t.length-5));e.sortAsc=false}else{e.columnId=t;e.sortAsc=true}return e});this.slickGrid.setSortColumns(e)};r.prototype.itemAt=function(t){return this.slickGrid.getDataItem(t)};r.prototype.rowCount=function(){return this.slickGrid.getDataLength()};r.prototype.getItems=function(){return this.view.getItems()};r.prototype.setItems=function(t){this.view.setItems(t,true)};r.prototype.bindToSlickEvents=function(){var t=this;var e=this;this.slickGridOnSort=function(i,r){e.view.populateLock();try{var n=[];var a;if(!!r.multiColumnSort){for(var o=0;!!(o<r.sortCols.length);o++){var l=r.sortCols[o];a=l.sortCol;if(a==null){a={}}n.push(a.field+(!!l.sortAsc?"":" DESC"))}}else{var a=r.sortCol;if(a==null){a={}}n.push(a.field+(!!r.sortAsc?"":" DESC"))}e.view.seekToPage=1;e.view.sortBy=n}finally{e.view.populateUnlock()}e.view.populate();t.persistSettings(null)};this.slickGrid.onSort.subscribe(this.slickGridOnSort);this.slickGridOnClick=function(t,i){e.onClick(t,i.row,i.cell)};this.slickGrid.onClick.subscribe(this.slickGridOnClick);this.slickGrid.onColumnsReordered.subscribe(function(e,i){return t.persistSettings(null)});this.slickGrid.onColumnsResized.subscribe(function(e,i){return t.persistSettings(null)})};r.prototype.getAddButtonCaption=function(){return Q.coalesce(Q.tryGetText("Controls.DataGrid.NewButton"),"New")};r.prototype.getButtons=function(){return[]};r.prototype.editItem=function(t){throw new ss.NotImplementedException};r.prototype.editItemOfType=function(t,e){if(t===this.getItemType()){this.editItem(e);return}throw new ss.NotImplementedException};r.prototype.onClick=function(e,i,r){if(e.isDefaultPrevented()){return}var n=$(e.target);if(!n.hasClass("s-EditLink")){n=n.closest("a")}if(n.hasClass("s-EditLink")){e.preventDefault();this.editItemOfType(t.SlickFormatting.getItemType(n),t.SlickFormatting.getItemId(n))}};r.prototype.viewDataChanged=function(t,e){this.markupReady();this.layout()};r.prototype.bindToViewEvents=function(){var t=this;this.view.onDataChanged.subscribe(function(e,i){return t.viewDataChanged(e,i)});this.view.onSubmit=function(e){return t.onViewSubmit()};this.view.setFilter(function(e,i){return t.onViewFilter(e)});this.view.onProcessData=function(e,i){return t.onViewProcessData(e)}};r.prototype.onViewProcessData=function(t){return t};r.prototype.onViewFilter=function(t){return true};r.prototype.getIncludeColumns=function(t){var e=this.slickGrid.getColumns();for(var i=0,r=e;i<r.length;i++){var n=r[i];if(n.field){t[n.field]=true}if(n.referencedFields){for(var a=0,o=n.referencedFields;a<o.length;a++){var l=o[a];t[l]=true}}}};r.prototype.setCriteriaParameter=function(){delete this.view.params["Criteria"];if(this.filterBar){var e=this.filterBar.get_store().get_activeCriteria();if(!t.Criteria.isEmpty(e)){this.view.params.Criteria=e}}};r.prototype.setEquality=function(t,e){Q.setEquality(this.view.params,t,e)};r.prototype.setIncludeColumnsParameter=function(){var t={};this.getIncludeColumns(t);var e=[];for(var i=0,r=Object.keys(t);i<r.length;i++){var n=r[i];e.push(n)}this.view.params.IncludeColumns=e};r.prototype.onViewSubmit=function(){if(this.isDisabled||!this.getGridCanLoad()){return false}this.setCriteriaParameter();this.setIncludeColumnsParameter();this.invokeSubmitHandlers();return true};r.prototype.markupReady=function(){};r.prototype.createSlickContainer=function(){return $('<div class="grid-container"></div>').appendTo(this.element)};r.prototype.createView=function(){var t=this.getViewOptions();return new Slick.RemoteView(t)};r.prototype.getDefaultSortBy=function(){if(this.slickGrid){var t=this.slickGrid.getColumns().filter(function(t){return t.sortOrder&&t.sortOrder!==0});if(t.length>0){t.sort(function(t,e){return ss.compare(Math.abs(t.sortOrder),Math.abs(e.sortOrder))});var e=[];for(var i=0;i<t.length;i++){var r=t[i];e.push(r.field+(r.sortOrder<0?" DESC":""))}return e}}return[]};r.prototype.usePager=function(){return false};r.prototype.enableFiltering=function(){var e=this.attrs(t.FilterableAttribute);return e.length>0&&e[0].value};r.prototype.populateWhenVisible=function(){return false};r.prototype.createFilterBar=function(){var e=$("<div/>").appendTo(this.element);var i=this;this.filterBar=new t.FilterDisplayBar(e);if(!this.isAsyncWidget())this.initializeFilterBar()};r.prototype.getPagerOptions=function(){return{view:this.view,rowsPerPage:20,rowsPerPageOptions:[20,100,500,2500]}};r.prototype.createPager=function(){var t=$("<div></div>").appendTo(this.element);t.slickPager(this.getPagerOptions())};r.prototype.getViewOptions=function(){var t=this;var e={};e.idField=this.getIdProperty();e.sortBy=this.getDefaultSortBy();if(!this.usePager()){e.rowsPerPage=0}else if(this.element.hasClass("responsive-height")){e.rowsPerPage=$(window.window).width()<768?20:100}else{e.rowsPerPage=100}e.getItemMetadata=function(e,i){return t.getItemMetadata(e,i)};return e};r.prototype.createToolbar=function(e){var i=$('<div class="grid-toolbar"></div>').appendTo(this.element);this.toolbar=new t.Toolbar(i,{buttons:e,hotkeyContext:this.element[0]})};r.prototype.getTitle=function(){if(!this.titleDiv){return null}return this.titleDiv.children().text()};r.prototype.setTitle=function(t){if(t!==this.getTitle()){if(t==null){if(this.titleDiv){this.titleDiv.remove();this.titleDiv=null
}}else{if(!this.titleDiv){this.titleDiv=$('<div class="grid-title"><div class="title-text"></div></div>').prependTo(this.element)}this.titleDiv.children().text(t)}this.layout()}};r.prototype.getItemType=function(){return"Item"};r.prototype.itemLink=function(e,i,r,n,a){if(a===void 0){a=true}if(e==null){e=this.getItemType()}if(i==null){i=this.getIdProperty()}return t.SlickFormatting.itemLink(e,i,r,n,a)};r.prototype.getColumnsKey=function(){var e=this.attrs(t.ColumnsKeyAttribute);if(e&&e.length>0){return e[0].value}return null};r.prototype.getPropertyItemsAsync=function(){var t=this;return Promise.resolve().then(function(){var e=t.getColumnsKey();if(!Q.isEmptyOrNull(e)){return Q.getColumnsAsync(e)}return Promise.resolve([])},null)};r.prototype.getPropertyItems=function(){var e=this.attrs(t.ColumnsKeyAttribute);var i=this.getColumnsKey();if(!Q.isEmptyOrNull(i)){return Q.getColumns(i)}return[]};r.prototype.getColumns=function(){var t=this.getPropertyItems();return this.propertyItemsToSlickColumns(t)};r.prototype.propertyItemsToSlickColumns=function(e){var i=t.PropertyItemSlickConverter.toSlickColumns(e);for(var r=0;r<e.length;r++){var n=e[r];var a=i[r];if(n.editLink===true){var o={$:a.format};var l={$:n.editLinkCssClass!=null?n.editLinkCssClass:null};a.format=this.itemLink(n.editLinkItemType!=null?n.editLinkItemType:null,n.editLinkIdField!=null?n.editLinkIdField:null,ss.mkdel({oldFormat:o},function(t){if(this.oldFormat.$!=null){return this.oldFormat.$(t)}return Q.htmlEncode(t.value)}),ss.mkdel({css:l},function(t){return Q.coalesce(this.css.$,"")}),false);if(!Q.isEmptyOrNull(n.editLinkIdField)){a.referencedFields=a.referencedFields||[];a.referencedFields.push(n.editLinkIdField)}}}return i};r.prototype.getColumnsAsync=function(){var t=this;return this.getPropertyItemsAsync().then(function(e){return t.propertyItemsToSlickColumns(e)},null)};r.prototype.getSlickOptions=function(){var e={};e.multiSelect=false;e.multiColumnSort=true;e.enableCellNavigation=false;e.headerRowHeight=t.DataGrid.defaultHeaderHeight;e.rowHeight=t.DataGrid.defaultRowHeight;return e};r.prototype.populateLock=function(){this.view.populateLock()};r.prototype.populateUnlock=function(){this.view.populateUnlock()};r.prototype.getGridCanLoad=function(){return true};r.prototype.refresh=function(){if(!this.populateWhenVisible()){this.internalRefresh();return}if(this.slickContainer.is(":visible")){this.slickContainer.data("needsRefresh",false);this.internalRefresh();return}this.slickContainer.data("needsRefresh",true)};r.prototype.refreshIfNeeded=function(){if(!!this.slickContainer.data("needsRefresh")){this.slickContainer.data("needsRefresh",false);this.internalRefresh()}};r.prototype.internalRefresh=function(){this.view.populate()};r.prototype.setIsDisabled=function(t){if(this.isDisabled!==t){this.isDisabled=t;if(this.isDisabled){this.view.setItems([],true)}this.updateDisabledState()}};r.prototype.getLocalTextDbPrefix=function(){if(this.localTextDbPrefix==null){this.localTextDbPrefix=Q.coalesce(this.getLocalTextPrefix(),"");if(this.localTextDbPrefix.length>0&&!Q.endsWith(this.localTextDbPrefix,".")){this.localTextDbPrefix="Db."+this.localTextDbPrefix+"."}}return this.localTextDbPrefix};r.prototype.getLocalTextPrefix=function(){var e=this.attrs(t.LocalTextPrefixAttribute);if(e.length>=1)return e[0].value;return""};r.prototype.getIdProperty=function(){if(this.idProperty==null){var e=this.attrs(t.IdPropertyAttribute);if(e.length===1){this.idProperty=e[0].value}else{this.idProperty="ID"}}return this.idProperty};r.prototype.getIsDeletedProperty=function(){return null};r.prototype.getIsActiveProperty=function(){if(this.isActiveProperty==null){var e=this.attrs(t.IsActivePropertyAttribute);if(e.length===1){this.isActiveProperty=e[0].value}else{this.isActiveProperty=""}}return this.isActiveProperty};r.prototype.updateDisabledState=function(){this.slickContainer.toggleClass("ui-state-disabled",!!this.isDisabled)};r.prototype.resizeCanvas=function(){this.slickGrid.resizeCanvas()};r.prototype.subDialogDataChange=function(){this.refresh()};r.prototype.addFilterSeparator=function(){if(this.quickFiltersDiv){this.quickFiltersDiv.append($("<hr/>"))}};r.prototype.determineText=function(t){var e=this.getLocalTextDbPrefix();if(!Q.isEmptyOrNull(e)){var i=Q.tryGetText(t(e));if(i!=null){return i}}return null};r.prototype.addQuickFilter=function(e){var i=this;if(e==null){throw new ss.ArgumentNullException("opt")}if(this.quickFiltersDiv==null){$("<div/>").addClass("clear").appendTo(this.toolbar.element);this.quickFiltersDiv=$("<div/>").addClass("quick-filters-bar").appendTo(this.toolbar.element)}if(e.separator){this.addFilterSeparator()}var r=$("<div class='quick-filter-item'><span class='quick-filter-label'></span></div>").appendTo(this.quickFiltersDiv).data("qffield",e.field).children();var n=e.title;if(n==null){n=this.determineText(function(t){return t+e.field});if(n==null){n=e.field}}var a=r.text(n).parent();if(e.displayText!=null){a.data("qfdisplaytext",e.displayText)}if(e.saveState!=null){a.data("qfsavestate",e.saveState)}if(e.loadState!=null){a.data("qfloadstate",e.loadState)}if(!Q.isEmptyOrNull(e.cssClass)){a.addClass(e.cssClass)}var o=t.Widget.create({type:e.type,element:function(t){if(!Q.isEmptyOrNull(e.field)){t.attr("id",i.uniqueName+"_QuickFilter_"+e.field)}t.attr("placeholder"," ");t.appendTo(a);if(e.element!=null){e.element(t)}},options:e.options,init:e.init});var l=function(){if(a.hasClass("ignore")){return}var r=i.view.params;r.EqualityFilter=r.EqualityFilter||{};var n=t.EditorUtils.getValue(o);var l=n!=null&&!Q.isEmptyOrNull(n.toString());if(e.handler!=null){var s={field:e.field,request:r,equalityFilter:r.EqualityFilter,value:n,active:l,widget:o,handled:true};e.handler(s);a.toggleClass("quick-filter-active",s.active);if(!s.handled){r.EqualityFilter[e.field]=n}}else{r.EqualityFilter[e.field]=n;a.toggleClass("quick-filter-active",l)}};t.WX.changeSelect2(o,function(t){window.setTimeout(function(){return i.quickFilterChange(t)},0)});this.add_submitHandlers(l);o.element.bind("remove."+this.uniqueName,function(t){i.remove_submitHandlers(l)});return o};r.prototype.addDateRangeFilter=function(t,e){return this.addQuickFilter(this.dateRangeQuickFilter(t,e))};r.prototype.dateRangeQuickFilter=function(e,i){var r=null;return{field:e,type:t.DateEditor,title:i,element:function(e){r=t.Widget.create({type:t.DateEditor,element:function(t){t.insertAfter(e)},options:null,init:null});r.element.change(function(t){e.triggerHandler("change")});$("<span/>").addClass("range-separator").text("-").insertAfter(e)},handler:function(e){var i=!Q.isTrimmedEmpty(e.widget.value);var n=!Q.isTrimmedEmpty(r.value);if(i&&!Q.parseDate(e.widget.element.val())){i=false;Q.notifyWarning(Q.text("Validation.DateInvalid"),"",null);e.widget.element.val("")}if(n&&!Q.parseDate(r.element.val())){n=false;Q.notifyWarning(Q.text("Validation.DateInvalid"),"",null);r.element.val("")}e.active=i||n;if(i){e.request.Criteria=t.Criteria.join(e.request.Criteria,"and",[[e.field],">=",e.widget.value])}if(n){var a=new Date(r.valueAsDate.valueOf());a.setDate(a.getDate()+1);e.request.Criteria=t.Criteria.join(e.request.Criteria,"and",[[e.field],"<",Q.formatDate(a,"yyyy-MM-dd")])}},displayText:function(e,i){var n=t.EditorUtils.getDisplayText(e);var a=t.EditorUtils.getDisplayText(r);if(Q.isEmptyOrNull(n)&&Q.isEmptyOrNull(a)){return null}var o=i+" >= "+n;var l=i+" <= "+a;if(!Q.isEmptyOrNull(n)&&!Q.isEmptyOrNull(a)){return o+" "+Q.coalesce(Q.tryGetText("Controls.FilterPanel.And"),"and")+" "+l}else if(!Q.isEmptyOrNull(n)){return o}else{return l}},saveState:function(e){return[t.EditorUtils.getValue(e),t.EditorUtils.getValue(r)]},loadState:function(e,i){if(i==null||!Q.isArray(i)||i.length!==2){i=[null,null]}t.EditorUtils.setValue(e,i[0]);t.EditorUtils.setValue(r,i[1])}}};r.prototype.addDateTimeRangeFilter=function(t,e){return this.addQuickFilter(this.dateTimeRangeQuickFilter(t,e))};r.prototype.dateTimeRangeQuickFilter=function(e,i){var r=null;return{field:e,type:t.DateTimeEditor,title:i,element:function(e){r=t.Widget.create({type:t.DateTimeEditor,element:function(t){t.insertAfter(e)},options:null,init:null});r.element.change(function(t){e.triggerHandler("change")});$("<span/>").addClass("range-separator").text("-").insertAfter(e)},init:function(t){t.element.parent().find(".time").change(function(e){t.element.triggerHandler("change")})},handler:function(e){var i=!Q.isTrimmedEmpty(e.widget.value);var n=!Q.isTrimmedEmpty(r.value);if(i&&!Q.parseDate(e.widget.element.val())){i=false;Q.notifyWarning(Q.text("Validation.DateInvalid"),"",null);e.widget.element.val("")}if(n&&!Q.parseDate(r.element.val())){n=false;Q.notifyWarning(Q.text("Validation.DateInvalid"),"",null);r.element.val("")}e.active=i||n;if(i){e.request.Criteria=t.Criteria.join(e.request.Criteria,"and",[[e.field],">=",e.widget.value])}if(n){e.request.Criteria=t.Criteria.join(e.request.Criteria,"and",[[e.field],"<=",r.value])}},displayText:function(e,i){var n=t.EditorUtils.getDisplayText(e);var a=t.EditorUtils.getDisplayText(r);if(Q.isEmptyOrNull(n)&&Q.isEmptyOrNull(a)){return null}var o=i+" >= "+n;var l=i+" <= "+a;if(!Q.isEmptyOrNull(n)&&!Q.isEmptyOrNull(a)){return o+" "+Q.coalesce(Q.tryGetText("Controls.FilterPanel.And"),"and")+" "+l}else if(!Q.isEmptyOrNull(n)){return o}else{return l}},saveState:function(e){return[t.EditorUtils.getValue(e),t.EditorUtils.getValue(r)]},loadState:function(e,i){if(i==null||!Q.isArray(i)||i.length!==2){i=[null,null]}t.EditorUtils.setValue(e,i[0]);t.EditorUtils.setValue(r,i[1])}}};r.prototype.addBooleanFilter=function(t,e,i,r){return this.addQuickFilter(this.booleanQuickFilter(t,e,i,r))};r.prototype.booleanQuickFilter=function(e,i,r,n){var a={};var o=[];var l=r;if(l==null){l=Q.text("Controls.FilterPanel.OperatorNames.true")}o.push(["1",l]);var s=n;if(s==null){s=Q.text("Controls.FilterPanel.OperatorNames.false")}o.push(["0",s]);a.items=o;return{field:e,type:t.SelectEditor,title:i,options:a,handler:function(t){t.equalityFilter[t.field]=t.value==null||Q.isEmptyOrNull(t.value.toString())?null:!!Q.toId(t.value)}}};r.prototype.invokeSubmitHandlers=function(){if(this.submitHandlers!=null){this.submitHandlers()}};r.prototype.quickFilterChange=function(t){this.persistSettings(null);this.view&&(this.view.seekToPage=1);this.refresh()};r.prototype.getPersistanceStorage=function(){return t.DataGrid.defaultPersistanceStorage};r.prototype.getPersistanceKey=function(){var t="GridSettings:";var e=window.location.pathname;if(!Q.isEmptyOrNull(e)){t+=e.substr(1).split(String.fromCharCode(47)).slice(0,2).join("/")+":"}t+=ss.getTypeFullName(ss.getInstanceType(this));return t};r.prototype.gridPersistanceFlags=function(){return{}};r.prototype.canShowColumn=function(t){if(t==null){return false}var e=t.sourceItem;if(e==null){return true}if(e.filterOnly===true){return false}if(e.readPermission==null){return true}return Q.Authorization.hasPermission(e.readPermission)};r.prototype.getPersistedSettings=function(){var t=this.getPersistanceStorage();if(t==null)return null;var e=Q.trimToNull(t.getItem(this.getPersistanceKey()));if(e!=null&&Q.startsWith(e,"{")&&Q.endsWith(e,"}"))return JSON.parse(e);return null};r.prototype.restoreSettings=function(e,i){var r=this;if(!this.slickGrid)return;if(e==null){e=this.getPersistedSettings();if(e==null)return}var n=this.slickGrid.getColumns();var a=null;var o=function(t){a={};for(var e=0;e<t.length;e++){var i=t[e];a[i.id]=i}};this.view.beginUpdate();this.restoringSettings++;try{i=i||this.gridPersistanceFlags();if(e.columns!=null){if(i.columnVisibility!==false){var l={};o(this.allColumns);var s=[];for(var u=0;u<e.columns.length;u++){var c=e.columns[u];if(c.id!=null&&c.visible===true){var d=a[c.id];if(this.canShowColumn(d)){d.visible=true;s.push(d);delete a[c.id]}}}for(var f=0;f<this.allColumns.length;f++){var p=this.allColumns[f];if(a[p.id]!=null){p.visible=false;s.push(p)}}this.allColumns=s;n=this.allColumns.filter(function(t){return t.visible===true})}if(i.columnWidths!==false){o(n);for(var h=0;h<e.columns.length;h++){var g=e.columns[h];if(g.id!=null&&g.width!=null&&g.width!==0){var v=a[g.id];if(v!=null){v.width=g.width}}}}if(i.sortColumns!==false){o(n);var y=[];var m=e.columns.filter(function(t){return t.id!=null&&Q.coalesce(t.sort,0)!==0});m.sort(function(t,e){return t.sort-e.sort});for(var b=0;b<m.length;b++){var C=m[b];var _=a[C.id];if(_!=null){y.push({columnId:C.id,sortAsc:C.sort>0})}}this.view.sortBy=y.map(function(t){return t.columnId+(t.sortAsc===false?" DESC":"")});this.slickGrid.setSortColumns(y)}this.slickGrid.setColumns(n);this.slickGrid.invalidate()}if(e.filterItems!=null&&i.filterItems!==false&&this.filterBar!=null&&this.filterBar.get_store()!=null){ss.clear(this.filterBar.get_store().get_items());ss.arrayAddRange(this.filterBar.get_store().get_items(),e.filterItems);this.filterBar.get_store().raiseChanged()}if(e.includeDeleted!=null&&i.includeDeleted!==false){var x=this.element.find(".s-IncludeDeletedToggle");if(!!e.includeDeleted!==x.hasClass("pressed")){x.children("a").click()}}if(e.quickFilters!=null&&i.quickFilters!==false&&this.quickFiltersDiv!=null&&this.quickFiltersDiv.length>0){this.quickFiltersDiv.find(".quick-filter-item").each(function(i,n){var a=$(n).data("qffield");if(Q.isEmptyOrNull(a)){return}var o=$("#"+r.uniqueName+"_QuickFilter_"+a).tryGetWidget(t.Widget);if(o==null){return}var l=e.quickFilters[a];var s=$(n).data("qfloadstate");if(s!=null){s(o,l)}else{t.EditorUtils.setValue(o,l)}})}if(i.quickSearch===true&&(e.quickSearchField!=null||e.quickSearchText!=null)){var S=this.toolbar.element.find(".s-QuickSearchInput").first();if(S.length>0){var w=S.tryGetWidget(t.QuickSearchInput);if(w!=null){this.view.populateLock();try{w.element.addClass("ignore-change");try{if(e.quickSearchField!=null){w.set_field(e.quickSearchField)}if(e.quickSearchText!=null&&Q.trimToNull(e.quickSearchText)!==Q.trimToNull(w.element.val())){w.element.val(e.quickSearchText)}}finally{w.element.removeClass("ignore-change");w.element.triggerHandler("execute-search")}}finally{this.view.populateUnlock()}}}}}finally{this.restoringSettings--;this.view.endUpdate()}};r.prototype.persistSettings=function(t){var e=this.getPersistanceStorage();if(!e){return}var i=this.getCurrentSettings(t);e.setItem(this.getPersistanceKey(),$.toJSON(i))};r.prototype.getCurrentSettings=function(e){var i=this;e=e||this.gridPersistanceFlags();var r={};if(e.columnVisibility!==false||e.columnWidths!==false||e.sortColumns!==false){r.columns=[];var n=this.slickGrid.getSortColumns();var a=this.slickGrid.getColumns();for(var o=0;o<a.length;o++){var l={$:a[o]};var s={id:l.$.id};if(e.columnVisibility!==false){s.visible=true}if(e.columnWidths!==false){s.width=l.$.width}if(e.sortColumns!==false){var u=Q.indexOf(n,ss.mkdel({column:l},function(t){return t.columnId===this.column.$.id}));s.sort=u>=0?n[u].sortAsc!==false?u+1:-u-1:0}r.columns.push(s)}}if(e.includeDeleted!==false){r.includeDeleted=this.element.find(".s-IncludeDeletedToggle").hasClass("pressed")}if(e.filterItems!==false&&this.filterBar!=null&&this.filterBar.get_store()!=null){r.filterItems=this.filterBar.get_store().get_items().slice()}if(e.quickSearch===true){var c=this.toolbar.element.find(".s-QuickSearchInput").first();if(c.length>0){var d=c.tryGetWidget(t.QuickSearchInput);if(d!=null){r.quickSearchField=d.get_field();r.quickSearchText=d.element.val()}}}if(e.quickFilters!==false&&this.quickFiltersDiv!=null&&this.quickFiltersDiv.length>0){r.quickFilters={};this.quickFiltersDiv.find(".quick-filter-item").each(function(n,a){var o=$(a).data("qffield");if(Q.isEmptyOrNull(o)){return}var l=$("#"+i.uniqueName+"_QuickFilter_"+o).tryGetWidget(t.Widget);if(l==null){return}var s=$(a).data("qfsavestate");var u=s!=null?s(l):t.EditorUtils.getValue(l);r.quickFilters[o]=u;if(e.quickFilterText===true&&$(a).hasClass("quick-filter-active")){var c=$(a).data("qfdisplaytext");var d=$(a).find(".quick-filter-label").text();var f;if(c!=null){f=c(l,d)}else{f=d+" = "+t.EditorUtils.getDisplayText(l)}if(!Q.isEmptyOrNull(f)){if(!Q.isEmptyOrNull(r.quickFilterText)){r.quickFilterText+=" "+Q.coalesce(Q.tryGetText("Controls.FilterPanel.And"),"and")+" ";r.quickFilterText+=f}else{r.quickFilterText=f}}}})}return r};r.prototype.getElement=function(){return this.element};r.prototype.getGrid=function(){return this.slickGrid};r.prototype.getView=function(){return this.view};r.prototype.getFilterStore=function(){return this.filterBar==null?null:this.filterBar.get_store()};r=__decorate([t.Decorators.registerClass("Serenity.DataGrid",[e]),t.Decorators.element("<div/>")],r);return r}(t.Widget);t.DataGrid=i})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t,i)||this;r.element.addClass("route-handler").on("handleroute."+r.uniqueName,function(t,e){if(!!e.handled)return;if(!!(e.route==="new")){e.handled=true;r.addButtonClick();return}var i=e.route.split("/");if(!!(i.length===2&&i[0]==="edit")){e.handled=true;r.editItem(i[1]);return}if(!!(i.length===2&&i[1]==="new")){e.handled=true;r.editItemOfType(ss.cast(i[0],String),null);return}if(!!(i.length===3&&i[1]==="edit")){e.handled=true;r.editItemOfType(ss.cast(i[0],String),i[2])}});return r}i.prototype.usePager=function(){return true};i.prototype.createToolbarExtensions=function(){this.createIncludeDeletedButton();this.createQuickSearchInput()};i.prototype.getInitialTitle=function(){return this.getDisplayName()};i.prototype.getLocalTextPrefix=function(){var t=e.prototype.getLocalTextPrefix.call(this);if(Q.isEmptyOrNull(t)){return this.getEntityType()}return t};i.prototype.getEntityType=function(){if(this.entityType!=null)return this.entityType;var e=this.attrs(t.EntityTypeAttribute);if(e.length===1){return this.entityType=e[0].value}var i=ss.getTypeFullName(ss.getInstanceType(this));var r=i.indexOf(".");if(r>=0){i=i.substring(r+1)}if(Q.endsWith(i,"Grid")){i=i.substr(0,i.length-4)}else if(Q.endsWith(i,"SubGrid")){i=i.substr(0,i.length-7)}this.entityType=i;return this.entityType};i.prototype.getDisplayName=function(){if(this.displayName!=null)return this.displayName;var t=this.attrs(System.ComponentModel.DisplayNameAttribute);if(t.length>=1){this.displayName=t[0].displayName;this.displayName=Q.LT.getDefault(this.displayName,this.displayName)}else{this.displayName=Q.tryGetText(this.getLocalTextDbPrefix()+"EntityPlural");if(this.displayName==null)this.displayName=this.getEntityType()}return this.displayName};i.prototype.getItemName=function(){if(this.itemName!=null)return this.itemName;var e=this.attrs(t.ItemNameAttribute);if(e.length>=1){this.itemName=e[0].value;this.itemName=Q.LT.getDefault(this.itemName,this.itemName)}else{this.itemName=Q.tryGetText(this.getLocalTextDbPrefix()+"EntitySingular");if(this.itemName==null)this.itemName=this.getEntityType()}return this.itemName};i.prototype.getAddButtonCaption=function(){return Q.format(Q.text("Controls.EntityGrid.NewButton"),this.getItemName())};i.prototype.getButtons=function(){var e=this;var i=[];i.push({title:this.getAddButtonCaption(),cssClass:"add-button",hotkey:"alt+n",onClick:function(){e.addButtonClick()}});i.push(this.newRefreshButton(true));i.push(t.ColumnPickerDialog.createToolButton(this));return i};i.prototype.newRefreshButton=function(t){var e=this;return{title:t?null:Q.text("Controls.EntityGrid.RefreshButton"),hint:t?Q.text("Controls.EntityGrid.RefreshButton"):null,cssClass:"refresh-button",onClick:function(){e.refresh()}}};i.prototype.addButtonClick=function(){this.editItem(new Object)};i.prototype.editItem=function(e){var i=this;this.createEntityDialog(this.getItemType(),function(r){var n=ss.safeCast(r,t["IEditDialog"]);if(n!=null){n.load(e,function(){n.dialogOpen(i.openDialogsAsPanel)});return}throw new ss.InvalidOperationException(Q.format("{0} doesn't implement IEditDialog!",ss.getTypeFullName(ss.getInstanceType(r))))})};i.prototype.editItemOfType=function(e,i){var r=this;if(e===this.getItemType()){this.editItem(i);return}this.createEntityDialog(e,function(e){var n=ss.safeCast(e,t["IEditDialog"]);if(n!=null){n.load(i,function(){return n.dialogOpen(r.openDialogsAsPanel)});return}throw new ss.InvalidOperationException(Q.format("{0} doesn't implement IEditDialog!",ss.getTypeFullName(ss.getInstanceType(e))))})};i.prototype.getService=function(){if(this.service!=null)return this.service;var e=this.attrs(t.ServiceAttribute);if(e.length>=1)this.service=e[0].value;else this.service=Q.replaceAll(this.getEntityType(),".","/");return this.service};i.prototype.getViewOptions=function(){var t=e.prototype.getViewOptions.call(this);t.url=Q.resolveUrl("~/Services/"+this.getService()+"/List");return t};i.prototype.getItemType=function(){return this.getEntityType()};i.prototype.routeDialog=function(t,e){var i=this;Q.Router.dialog(this.element,e.element,function(){var r="";if(t!==i.getItemType())r=t+"/";if(!!(e!=null&&e.entityId!=null))r+="edit/"+e.entityId.toString();else r+="new";return r})};i.prototype.initDialog=function(e){var i=this;t.SubDialogHelper.bindToDataChange(e,this,function(t,e){i.subDialogDataChange()},true);this.routeDialog(this.getItemType(),e)};i.prototype.initEntityDialog=function(e,i){var r=this;if(e===this.getItemType()){this.initDialog(i);return}t.SubDialogHelper.bindToDataChange(i,this,function(t,e){r.subDialogDataChange()},true);this.routeDialog(e,i)};i.prototype.createEntityDialog=function(e,i){var r=this;var n=this.getDialogTypeFor(e);var a=t.Widget.create({type:n,options:this.getDialogOptionsFor(e),init:function(t){r.initEntityDialog(e,t);i&&i(t)}});return a};i.prototype.getDialogOptions=function(){return{}};i.prototype.getDialogOptionsFor=function(t){if(t===this.getItemType())return this.getDialogOptions();return{}};i.prototype.getDialogTypeFor=function(e){if(e===this.getItemType()){return this.getDialogType()}return t.DialogTypeRegistry.get(e)};i.prototype.getDialogType=function(){if(this.dialogType!=null)return this.dialogType;var e=this.attrs(t.DialogTypeAttribute);if(e.length>=1)this.dialogType=e[0].value;else this.dialogType=t.DialogTypeRegistry.get(this.getEntityType());return this.dialogType};i=__decorate([t.Decorators.registerClass("Serenity.EntityGrid")],i);return i}(t.DataGrid);t.EntityGrid=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t,i)||this;t.addClass("s-CheckTreeEditor");r.updateItems();return r}i.prototype.getIdProperty=function(){return"id"};i.prototype.getTreeItems=function(){return[]};i.prototype.updateItems=function(){var t=this.getTreeItems();var e={};for(var i=0;i<t.length;i++){var r=t[i];r.children=[];if(!Q.isEmptyOrNull(r.id)){e[r.id]=r}if(!Q.isEmptyOrNull(r.parentId)){var n=e[r.parentId];if(n!=null){n.children.push(r)}}}this.view.addData({Entities:t,Skip:0,Take:0,TotalCount:t.length});this.updateSelectAll();this.updateFlags()};i.prototype.getEditValue=function(t,e){if(this.getDelimited())e[t.name]=this.get_value().join(",");else e[t.name]=this.get_value()};i.prototype.setEditValue=function(t,e){var i=t[e.name];this.set_value(i)};i.prototype.getButtons=function(){var e=this;var i=this.getSelectAllText();if(Q.isEmptyOrNull(i)){return null}var r=this;var n=[];n.push(t.GridSelectAllButtonHelper.define(function(){return r},function(t){return t.id},function(t){return t.isSelected},function(t,i){if(t.isSelected!==i){t.isSelected=i;e.itemSelectedChanged(t)}},null,function(){e.updateFlags()}));return n};i.prototype.itemSelectedChanged=function(t){};i.prototype.getSelectAllText=function(){return Q.coalesce(Q.tryGetText("Controls.CheckTreeEditor.SelectAll"),"Select All")};i.prototype.isThreeStateHierarchy=function(){return false};i.prototype.createSlickGrid=function(){this.element.addClass("slick-no-cell-border").addClass("slick-no-odd-even");var t=e.prototype.createSlickGrid.call(this);this.element.addClass("slick-hide-header");t.resizeCanvas();return t};i.prototype.onViewFilter=function(i){if(!e.prototype.onViewFilter.call(this,i)){return false}var r=this.view.getItems();var n=this;return t.SlickTreeHelper.filterCustom(i,function(t){if(t.parentId==null){return null}if(n.byId==null){n.byId={};for(var e=0;e<r.length;e++){var i=r[e];if(i.id!=null){n.byId[i.id]=i}}}return n.byId[t.parentId]})};i.prototype.getInitialCollapse=function(){return false};i.prototype.onViewProcessData=function(i){i=e.prototype.onViewProcessData.call(this,i);this.byId=null;t.SlickTreeHelper.setIndents(i.Entities,function(t){return t.id},function(t){return t.parentId},this.getInitialCollapse());return i};i.prototype.onClick=function(i,r,n){e.prototype.onClick.call(this,i,r,n);if(!i.isDefaultPrevented()){t.SlickTreeHelper.toggleClick(i,r,n,this.view,function(t){return t.id})}if(i.isDefaultPrevented()){return}var a=$(i.target);if(a.hasClass("check-box")){i.preventDefault();if(this._readOnly)return;var o=a.hasClass("checked")||a.hasClass("partial");var l=this.itemAt(r);var s=l.isSelected!==!o;this.view.beginUpdate();try{if(l.isSelected!==!o){l.isSelected=!o;this.view.updateItem(l.id,l);this.itemSelectedChanged(l)}s=this.setAllSubTreeSelected(l,l.isSelected)||s;this.updateSelectAll();this.updateFlags()}finally{this.view.endUpdate()}if(s){this.element.triggerHandler("change")}}};i.prototype.updateSelectAll=function(){t.GridSelectAllButtonHelper.update(this,function(t){return t.isSelected})};i.prototype.updateFlags=function(){var t=this.view;var e=t.getItems();var i=this.isThreeStateHierarchy();if(!i){return}t.beginUpdate();try{for(var r=0;r<e.length;r++){var n=e[r];if(n.children==null||n.children.length===0){var a=this.getDescendantsSelected(n);if(a!==n.isAllDescendantsSelected){n.isAllDescendantsSelected=a;t.updateItem(n.id,n)}continue}var o=this.allDescendantsSelected(n);var l=o||this.anyDescendantsSelected(n);if(o!==n.isAllDescendantsSelected||l!==n.isSelected){var s=n.isSelected!==l;n.isAllDescendantsSelected=o;n.isSelected=l;t.updateItem(n.id,n);if(s){this.itemSelectedChanged(n)}}}}finally{t.endUpdate()}};i.prototype.getDescendantsSelected=function(t){return true};i.prototype.setAllSubTreeSelected=function(t,e){var i=false;for(var r=0;r<t.children.length;r++){var n=t.children[r];if(n.isSelected!==e){i=true;n.isSelected=e;this.view.updateItem(n.id,n);this.itemSelectedChanged(n)}if(n.children.length>0){i=this.setAllSubTreeSelected(n,e)||i}}return i};i.prototype.allItemsSelected=function(){for(var t=0;t<this.rowCount();t++){var e=this.itemAt(t);if(!e.isSelected){return false}}return this.rowCount()>0};i.prototype.allDescendantsSelected=function(t){if(t.children.length>0){for(var e=0;e<t.children.length;e++){var i=t.children[e];if(!i.isSelected){return false}if(!this.allDescendantsSelected(i)){return false}}}return true};i.prototype.getDelimited=function(){return!!!!this.options["delimited"]};i.prototype.anyDescendantsSelected=function(t){if(t.children.length>0){for(var e=0;e<t.children.length;e++){var i=t.children[e];if(i.isSelected){return true}if(this.anyDescendantsSelected(i)){return true}}}return false};i.prototype.getColumns=function(){var e=this;var i=this;var r=[];r.push({field:"text",name:"Kayıt",width:80,format:t.SlickFormatting.treeToggle(function(){return i.view},function(t){return t.id},function(t){var i="check-box";var r=t.item;if(r.hideCheckBox){return e.getItemText(t)}var n=e.isThreeStateHierarchy();if(r.isSelected){if(n&&!r.isAllDescendantsSelected){i+=" partial"}else{i+=" checked"}}if(e._readOnly)i+=" readonly";return'<span class="'+i+'"></span>'+e.getItemText(t)})});return r};i.prototype.getItemText=function(t){return Q.htmlEncode(t.value)};i.prototype.getSlickOptions=function(){var t=e.prototype.getSlickOptions.call(this);t.forceFitColumns=true;return t};i.prototype.sortItems=function(){if(!this.moveSelectedUp()){return}var t={};var e=this.view.getItems();var i=0;for(var r=0;r<e.length;r++){var n=e[r];t[n.id]=i++}e.sort(function(e,i){if(e.isSelected&&!i.isSelected){return-1}if(i.isSelected&&!e.isSelected){return 1}var r=Q.turkishLocaleCompare(e.text,i.text);if(r!==0){return r}return ss.compare(t[e.id],t[i.id])});this.view.setItems(e,true)};i.prototype.moveSelectedUp=function(){return false};i.prototype.get_readOnly=function(){return this._readOnly};i.prototype.set_readOnly=function(t){if(!!this._readOnly!=!!t){this._readOnly=!!t;this.view.refresh()}};i.prototype.get_value=function(){var t=[];var e=this.view.getItems();for(var i=0;i<e.length;i++){if(e[i].isSelected){t.push(e[i].id)}}return t};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(t){this.set_value(t)},enumerable:true,configurable:true});i.prototype.set_value=function(t){var e={};if(t!=null){if(typeof t=="string"){t=t.split(",").map(function(t){return Q.trimToNull(t)}).filter(function(t){return t!=null})}for(var i=0;i<t.length;i++){e[t[i]]=true}}this.view.beginUpdate();try{var r=this.view.getItems();for(var n=0;n<r.length;n++){var a=r[n];var o=e[a.id];if(o!==a.isSelected){a.isSelected=o;this.view.updateItem(a.id,a)}}this.updateSelectAll();this.updateFlags();this.sortItems()}finally{this.view.endUpdate()}};i=__decorate([t.Decorators.registerEditor("Serenity.CheckTreeEditor",[t.IGetEditValue,t.ISetEditValue,t.IReadOnly]),t.Decorators.element("<div/>")],i);return i}(t.DataGrid);t.CheckTreeEditor=e;var i=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t,i)||this;r.enableUpdateItems=true;r.setCascadeFrom(r.options.cascadeFrom);r.updateItems();Q.ScriptData.bindToChange("Lookup."+r.getLookupKey(),r.uniqueName,function(){return r.updateItems()});return r}i.prototype.updateItems=function(){if(this.enableUpdateItems)e.prototype.updateItems.call(this)};i.prototype.getLookupKey=function(){return this.options.lookupKey};i.prototype.getButtons=function(){return Q.coalesce(e.prototype.getButtons.call(this),this.options.hideSearch?null:[])};i.prototype.createToolbarExtensions=function(){var i=this;e.prototype.createToolbarExtensions.call(this);t.GridUtils.addQuickSearchInputCustom(this.toolbar.element,function(t,e){i.searchText=Select2.util.stripDiacritics(e||"").toUpperCase();i.view.setItems(i.view.getItems(),true)})};i.prototype.getSelectAllText=function(){if(!this.options.showSelectAll)return null;return e.prototype.getSelectAllText.call(this)};i.prototype.cascadeItems=function(e){var i=this.get_cascadeValue();if(i==null||i===""){if(!Q.isEmptyOrNull(this.get_cascadeField())){return[]}return e}var r=i.toString();var n=this.get_cascadeField();return e.filter(function(e){var i=Q.coalesce(e[n],t.ReflectionUtils.getPropertyValue(e,n));return!!(i!=null&&i.toString()===r)})};i.prototype.filterItems=function(e){var i=this.get_filterValue();if(i==null||i===""){return e}var r=i.toString();var n=this.get_filterField();return e.filter(function(e){var i=Q.coalesce(e[n],t.ReflectionUtils.getPropertyValue(e,n));return!!(i!=null&&i.toString()===r)})};i.prototype.getLookupItems=function(t){return this.filterItems(this.cascadeItems(t.items))};i.prototype.getTreeItems=function(){var t=Q.getLookup(this.options.lookupKey);var e=this.getLookupItems(t);return e.map(function(e){return{id:Q.coalesce(e[t.idField],"").toString(),text:Q.coalesce(e[t.textField],"").toString(),source:e}})};i.prototype.onViewFilter=function(t){return e.prototype.onViewFilter.call(this,t)&&(Q.isEmptyOrNull(this.searchText)||Select2.util.stripDiacritics(t.text||"").toUpperCase().indexOf(this.searchText)>=0)};i.prototype.moveSelectedUp=function(){return this.options.checkedOnTop};i.prototype.get_cascadeFrom=function(){return this.options.cascadeFrom};Object.defineProperty(i.prototype,"cascadeFrom",{get:function(){return this.get_cascadeFrom()},set:function(t){this.set_cascadeFrom(t)},enumerable:true,configurable:true});i.prototype.getCascadeFromValue=function(e){return t.EditorUtils.getValue(e)};i.prototype.setCascadeFrom=function(e){var i=this;if(Q.isEmptyOrNull(e)){if(this.cascadeLink!=null){this.cascadeLink.set_parentID(null);this.cascadeLink=null}this.options.cascadeFrom=null;return}this.cascadeLink=new t.CascadedWidgetLink(t.Widget,this,function(t){i.set_cascadeValue(i.getCascadeFromValue(t))});this.cascadeLink.set_parentID(e);
this.options.cascadeFrom=e};i.prototype.set_cascadeFrom=function(t){if(t!==this.options.cascadeFrom){this.setCascadeFrom(t);this.updateItems()}};i.prototype.get_cascadeField=function(){return Q.coalesce(this.options.cascadeField,this.options.cascadeFrom)};Object.defineProperty(i.prototype,"cascadeField",{get:function(){return this.get_cascadeField()},set:function(t){this.set_cascadeField(t)},enumerable:true,configurable:true});i.prototype.set_cascadeField=function(t){this.options.cascadeField=t};i.prototype.get_cascadeValue=function(){return this.options.cascadeValue};Object.defineProperty(i.prototype,"cascadeValue",{get:function(){return this.get_cascadeValue()},set:function(t){this.set_cascadeValue(t)},enumerable:true,configurable:true});i.prototype.set_cascadeValue=function(t){if(this.options.cascadeValue!==t){this.options.cascadeValue=t;this.value=[];this.updateItems()}};i.prototype.get_filterField=function(){return this.options.filterField};Object.defineProperty(i.prototype,"filterField",{get:function(){return this.get_filterField()},set:function(t){this.set_filterField(t)},enumerable:true,configurable:true});i.prototype.set_filterField=function(t){this.options.filterField=t};i.prototype.get_filterValue=function(){return this.options.filterValue};Object.defineProperty(i.prototype,"filterValue",{get:function(){return this.get_filterValue()},set:function(t){this.set_filterValue(t)},enumerable:true,configurable:true});i.prototype.set_filterValue=function(t){if(this.options.filterValue!==t){this.options.filterValue=t;this.value=null;this.updateItems()}};i=__decorate([t.Decorators.registerEditor("Serenity.CheckLookupEditor")],i);return i}(e);t.CheckLookupEditor=i})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t,i)||this;r.initValidator();r.initTabs();r.initToolbar();return r}i.prototype.destroy=function(){if(this.tabs){this.tabs.tabs("destroy");this.tabs=null}if(this.toolbar){this.toolbar.destroy();this.toolbar=null}if(this.validator){this.byId("Form").remove();this.validator=null}e.prototype.destroy.call(this)};i.prototype.arrange=function(){this.element.find(".require-layout").filter(":visible").each(function(t,e){$(e).triggerHandler("layout")})};i.prototype.getToolbarButtons=function(){return[]};i.prototype.getValidatorOptions=function(){return{}};i.prototype.initTabs=function(){var t=this.byId("Tabs");if(t.length===0){return}this.tabs=t.tabs({})};i.prototype.initToolbar=function(){var e=this.byId("Toolbar");if(e.length===0){return}var i={buttons:this.getToolbarButtons()};this.toolbar=new t.Toolbar(e,i)};i.prototype.initValidator=function(){var t=this.byId("Form");if(t.length>0){var e=this.getValidatorOptions();this.validator=t.validate(Q.validateOptions(e))}};i.prototype.resetValidation=function(){if(this.validator){this.validator.resetAll()}};i.prototype.validateForm=function(){return this.validator==null||!!this.validator.form()};return i}(t.TemplatedWidget);t.TemplatedPanel=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t,i)||this;if(!r.isAsyncWidget()){r.initPropertyGrid();r.loadInitialEntity()}return r}i.prototype.destroy=function(){if(this.propertyGrid){this.propertyGrid.destroy();this.propertyGrid=null}if(this.validator){this.byId("Form").remove();this.validator=null}e.prototype.destroy.call(this)};i.prototype.initPropertyGrid=function(){var e=this.byId("PropertyGrid");if(e.length<=0){return}var i=this.getPropertyGridOptions();this.propertyGrid=new t.PropertyGrid(e,i).init(null);if(this.element.closest(".ui-Panel").hasClass("s-Flexify")){this.propertyGrid.element.children(".categories").flexHeightOnly(1)}};i.prototype.initPropertyGridAsync=function(){var e=this;return Promise.resolve().then(function(){var i=e.byId("PropertyGrid");if(i.length<=0){return Promise.resolve()}return e.getPropertyGridOptionsAsync().then(function(r){e.propertyGrid=new t.PropertyGrid(i,r);if(e.element.closest(".ui-Panel").hasClass("s-Flexify")){e.propertyGrid.element.children(".categories").flexHeightOnly(1)}return e.propertyGrid.initialize()})})};i.prototype.loadInitialEntity=function(){if(this.propertyGrid){this.propertyGrid.load(new Object)}};i.prototype.initializeAsync=function(){var t=this;return e.prototype.initializeAsync.call(this).then(function(){return t.initPropertyGridAsync()}).then(function(){return t.loadInitialEntity()})};i.prototype.getFormKey=function(){var e=ss.getAttributes(ss.getInstanceType(this),t.FormKeyAttribute,true);if(e.length>=1){return e[0].value}var i=ss.getTypeFullName(ss.getInstanceType(this));var r=i.indexOf(".");if(r>=0){i=i.substring(r+1)}if(Q.endsWith(i,"Panel")){i=i.substr(0,i.length-6)}else if(Q.endsWith(i,"Panel")){i=i.substr(0,i.length-5)}return i};i.prototype.getPropertyGridOptions=function(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,useCategories:false,localTextPrefix:"Forms."+this.getFormKey()+"."}};i.prototype.getPropertyGridOptionsAsync=function(){var t=this;return this.getPropertyItemsAsync().then(function(e){return{idPrefix:t.idPrefix,items:e,mode:1,useCategories:false,localTextPrefix:"Forms."+t.getFormKey()+"."}})};i.prototype.getPropertyItems=function(){var t=this.getFormKey();return Q.getForm(t)};i.prototype.getPropertyItemsAsync=function(){var t=this;return Promise.resolve().then(function(){var e=t.getFormKey();return Q.getFormAsync(e)})};i.prototype.getSaveEntity=function(){var t=new Object;if(this.propertyGrid){this.propertyGrid.save(t)}return t};i.prototype.get_entity=function(){return this._entity};i.prototype.get_entityId=function(){return this._entityId};i.prototype.set_entity=function(t){this._entity=Q.coalesce(t,new Object)};i.prototype.set_entityId=function(t){this._entityId=t};i.prototype.validateBeforeSave=function(){return this.validator.form()};i=__decorate([t.Decorators.registerClass("Serenity.PropertyPanel")],i);return i}(t.TemplatedPanel);t.PropertyPanel=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(){function e(){}e=__decorate([t.Decorators.registerInterface("Serenity.IEditDialog")],e);return e}();t.IEditDialog=e;var i=function(e){__extends(i,e);function i(t){var i=e.call(this,t)||this;if(!i.isAsyncWidget()){i.initPropertyGrid();i.initLocalizationGrid()}return i}i.prototype.initializeAsync=function(){var t=this;return e.prototype.initializeAsync.call(this).then(function(){return t.initPropertyGridAsync()}).then(function(){return t.initLocalizationGridAsync()})};i.prototype.destroy=function(){if(this.propertyGrid){this.propertyGrid.destroy();this.propertyGrid=null}if(this.localizationGrid){this.localizationGrid.destroy();this.localizationGrid=null}this.undeleteButton=null;this.applyChangesButton=null;this.deleteButton=null;this.saveAndCloseButton=null;e.prototype.destroy.call(this)};i.prototype.get_entity=function(){return this.entity};i.prototype.set_entity=function(t){this.entity=t||new Object};i.prototype.get_entityId=function(){return this.entityId};i.prototype.set_entityId=function(t){this.entityId=t};i.prototype.getEntityNameFieldValue=function(){return Q.coalesce(this.get_entity()[this.getNameProperty()],"").toString()};i.prototype.getEntityTitle=function(){if(!this.isEditMode()){return Q.format(Q.text("Controls.EntityDialog.NewRecordTitle"),this.getEntitySingular())}else{var t=Q.coalesce(this.getEntityNameFieldValue(),"");return Q.format(Q.text("Controls.EntityDialog.EditRecordTitle"),this.getEntitySingular(),Q.isEmptyOrNull(t)?"":" ("+t+")")}};i.prototype.updateTitle=function(){this.dialogTitle=this.getEntityTitle()};i.prototype.isCloneMode=function(){return false};i.prototype.isEditMode=function(){return this.get_entityId()!=null&&!this.isCloneMode()};i.prototype.isDeleted=function(){if(this.get_entityId()==null){return false}var t=this.getIsDeletedProperty();if(t){return!!this.get_entity()[t]}var e=this.get_entity()[this.getIsActiveProperty()];if(e==null){return false}return e<0};i.prototype.isNew=function(){return this.get_entityId()==null};i.prototype.isNewOrDeleted=function(){return this.isNew()||this.isDeleted()};i.prototype.getDeleteOptions=function(t){return{}};i.prototype.deleteHandler=function(t,e){Q.serviceCall(t)};i.prototype.doDelete=function(t){var e=this;var i=this;var r={EntityId:this.get_entityId()};var n={service:this.getService()+"/Delete",request:r,onSuccess:function(n){i.onDeleteSuccess(n);if(t!=null){t(n)}i.element.triggerHandler("ondatachange",[{entityId:r.EntityId,entity:e.entity,type:"delete"}])}};var a=this.getDeleteOptions(t);var o=$.extend(n,a);this.deleteHandler(o,t)};i.prototype.onDeleteSuccess=function(t){};i.prototype.attrs=function(t){return ss.getAttributes(ss.getInstanceType(this),t,true)};i.prototype.getEntityType=function(){if(this.entityType!=null)return this.entityType;var e=this.attrs(t.EntityTypeAttribute);if(e.length===1)return this.entityType=e[0].value;var i=ss.getTypeFullName(ss.getInstanceType(this));var r=i.indexOf(".");if(r>=0)i=i.substring(r+1);if(Q.endsWith(i,"Dialog")||Q.endsWith(i,"Control"))i=i.substr(0,i.length-6);else if(Q.endsWith(i,"Panel"))i=i.substr(0,i.length-5);return this.entityType=i};i.prototype.getFormKey=function(){if(this.formKey!=null)return this.formKey;var e=this.attrs(t.FormKeyAttribute);if(e.length>=1)return this.formKey=e[0].value;return this.formKey=this.getEntityType()};i.prototype.getLocalTextDbPrefix=function(){if(this.localTextDbPrefix!=null)return this.localTextDbPrefix;this.localTextDbPrefix=Q.coalesce(this.getLocalTextPrefix(),"");if(this.localTextDbPrefix.length>0&&!Q.endsWith(this.localTextDbPrefix,"."))this.localTextDbPrefix="Db."+this.localTextDbPrefix+".";return this.localTextDbPrefix};i.prototype.getLocalTextPrefix=function(){var e=this.attrs(t.LocalTextPrefixAttribute);if(e.length>=1)return e[0].value;return this.getEntityType()};i.prototype.getEntitySingular=function(){if(this.entitySingular!=null)return this.entitySingular;var e=this.attrs(t.ItemNameAttribute);if(e.length>=1){this.entitySingular=e[0].value;this.entitySingular=Q.LT.getDefault(this.entitySingular,this.entitySingular)}else{var i=Q.tryGetText(this.getLocalTextDbPrefix()+"EntitySingular");if(i==null)i=this.getEntityType();this.entitySingular=i}return this.entitySingular};i.prototype.getNameProperty=function(){if(this.nameProperty!=null)return this.nameProperty;var e=this.attrs(t.NamePropertyAttribute);if(e.length>=1)this.nameProperty=e[0].value;else this.nameProperty="Name";return this.nameProperty};i.prototype.getIdProperty=function(){if(this.idProperty!=null)return this.idProperty;var e=this.attrs(t.IdPropertyAttribute);if(e.length>=1)this.idProperty=e[0].value;else this.idProperty="ID";return this.idProperty};i.prototype.getIsActiveProperty=function(){if(this.isActiveProperty!=null)return this.isActiveProperty;var e=this.attrs(t.IsActivePropertyAttribute);if(e.length>=1)this.isActiveProperty=e[0].value;else this.isActiveProperty="IsActive";return this.isActiveProperty};i.prototype.getIsDeletedProperty=function(){return null};i.prototype.getService=function(){if(this.service!=null)return this.service;var e=this.attrs(t.ServiceAttribute);if(e.length>=1)this.service=e[0].value;else this.service=Q.replaceAll(this.getEntityType(),".","/");return this.service};i.prototype.load=function(t,e,i){var r=this;var n=function(){if(t==null){r.loadResponse({});e&&e();return}var i=typeof t;if(i==="string"||i==="number"){var n=t;r.loadById(n,function(t){if(e)window.setTimeout(e,0)},null);return}var a=t||new Object;r.loadResponse({Entity:a});e&&e()};if(i==null){n();return}try{n()}catch(a){var o=ss.Exception.wrap(a);i(o)}};i.prototype.loadNewAndOpenDialog=function(t){this.loadResponse({});this.dialogOpen(t)};i.prototype.loadEntityAndOpenDialog=function(t,e){this.loadResponse({Entity:t});this.dialogOpen(e)};i.prototype.loadResponse=function(t){t=t||{};this.onLoadingData(t);var e=t.Entity||new Object;this.beforeLoadEntity(e);this.loadEntity(e);this.set_entity(e);this.afterLoadEntity()};i.prototype.loadEntity=function(t){var e=this.getIdProperty();if(e!=null)this.set_entityId(t[e]);this.set_entity(t);if(this.propertyGrid!=null){this.propertyGrid.set_mode(this.isEditMode()?2:1);this.propertyGrid.load(t)}};i.prototype.beforeLoadEntity=function(t){this.localizationPendingValue=null;this.localizationLastValue=null};i.prototype.afterLoadEntity=function(){this.updateInterface();this.updateTitle()};i.prototype.loadByIdAndOpenDialog=function(t,e){var i=this;this.loadById(t,function(t){return window.setTimeout(function(){return i.dialogOpen(e)},0)},function(){if(!i.element.is(":visible")){i.element.remove()}})};i.prototype.onLoadingData=function(t){};i.prototype.getLoadByIdOptions=function(t,e){return{}};i.prototype.getLoadByIdRequest=function(t){var e={};e.EntityId=t;return e};i.prototype.reloadById=function(){this.loadById(this.get_entityId())};i.prototype.loadById=function(t,e,i){var r=this;var n={service:this.getService()+"/Retrieve",blockUI:true,request:this.getLoadByIdRequest(t),onSuccess:function(t){r.loadResponse(t);e&&e(t)},onCleanup:function(){if(r.validator!=null){Q.validatorAbortHandler(r.validator)}}};var a=this.getLoadByIdOptions(t,e);var o=$.extend(n,a);this.loadByIdHandler(o,e,i)};i.prototype.loadByIdHandler=function(t,e,i){var r=Q.serviceCall(t);i&&r.fail(i)};i.prototype.initLocalizationGrid=function(){var t=this.byId("PropertyGrid");if(t.length<=0){return}var e=this.getPropertyGridOptions();this.initLocalizationGridCommon(e)};i.prototype.initLocalizationGridAsync=function(){var t=this;return Promise.resolve().then(function(){var e=t.byId("PropertyGrid");if(e.length<=0){return Promise.resolve()}return t.getPropertyGridOptionsAsync().then(function(e){t.initLocalizationGridCommon(e)})})};i.prototype.initLocalizationGridCommon=function(e){var i=this.byId("PropertyGrid");if(!Q.any(e.items,function(t){return t.localizable===true}))return;var r=$("<div/>").attr("id",this.idPrefix+"LocalizationGrid").hide().insertAfter(i);e.idPrefix=this.idPrefix+"Localization_";var n=[];for(var a=0,o=e.items;a<o.length;a++){var l=o[a];var s=null;if(l.localizable===true){var u=$.extend({},l);u.oneWay=true;u.readOnly=true;u.required=false;u.defaultValue=null;n.push(u);if(s==null)s=this.getLangs();for(var c=0,d=s;c<d.length;c++){var f=d[c];u=$.extend({},l);u.name=f[0]+"$"+u.name;u.title=f[1];u.cssClass=[u.cssClass,"translation"].join(" ");u.insertable=true;u.updatable=true;u.oneWay=false;u.required=false;u.localizable=false;u.defaultValue=null;n.push(u)}}}e.items=n;this.localizationGrid=new t.PropertyGrid(r,e).init(null);r.addClass("s-LocalizationGrid")};i.prototype.isLocalizationMode=function(){return this.localizationButton!=null&&this.localizationButton.hasClass("pressed")};i.prototype.isLocalizationModeAndChanged=function(){if(!this.isLocalizationMode()){return false}var t=this.getLocalizationGridValue();return $.toJSON(this.localizationLastValue)!=$.toJSON(t)};i.prototype.localizationButtonClick=function(){if(this.isLocalizationMode()&&!this.validateForm()){return}if(this.isLocalizationModeAndChanged()){var t=this.getLocalizationGridValue();this.localizationLastValue=t;this.localizationPendingValue=t}this.localizationButton.toggleClass("pressed");this.updateInterface();if(this.isLocalizationMode()){this.loadLocalization()}};i.prototype.getLanguages=function(){if(t.EntityDialog.defaultLanguageList!=null)return t.EntityDialog.defaultLanguageList()||[];return[]};i.prototype.getLangs=function(){var t=this.getLanguages();var e=ss.safeCast(t,Array);if(e==null||e.length===0||e[0]==null||!Q.isArray(e[0])){e=Array.prototype.slice.call(t.map(function(t){return[t.item1,t.item2]}))}return e};i.prototype.loadLocalization=function(){var t=this;if(this.localizationLastValue==null&&this.isNew()){this.localizationGrid.load({});this.setLocalizationGridCurrentValues();this.localizationLastValue=this.getLocalizationGridValue();return}if(this.localizationLastValue!=null){this.localizationGrid.load(this.localizationLastValue);this.setLocalizationGridCurrentValues();return}var e={service:this.getService()+"/Retrieve",blockUI:true,request:{EntityId:this.get_entityId(),ColumnSelection:"keyOnly",IncludeColumns:["Localizations"]},onSuccess:function(e){var i=$.extend(new Object,t.get_entity());if(e.Localizations){for(var r=0,n=Object.keys(e.Localizations);r<n.length;r++){var a=n[r];var o=e.Localizations[a];for(var l=0,s=Object.keys(o);l<s.length;l++){var u=s[l];i[a+"$"+u]=o[u]}}}t.localizationGrid.load(i);t.setLocalizationGridCurrentValues();t.localizationPendingValue=null;t.localizationLastValue=t.getLocalizationGridValue()}};Q.serviceCall(e)};i.prototype.setLocalizationGridCurrentValues=function(){var t=this;var e={};this.localizationGrid.enumerateItems(function(i,r){if(i.name.indexOf("$")<0&&r.element.is(":input")){e[i.name]=t.byId(i.name).val();r.element.val(e[i.name])}});this.localizationGrid.enumerateItems(function(t,i){var r=t.name.indexOf("$");if(r>=0&&i.element.is(":input")){var n=e[t.name.substr(r+1)];if(n!=null&&n.length>0){i.element.attr("title",n).attr("placeholder",n)}}})};i.prototype.getLocalizationGridValue=function(){var t={};this.localizationGrid.save(t);for(var e=0,i=Object.keys(t);e<i.length;e++){var r=i[e];if(r.indexOf("$")<0){delete t[r]}}return t};i.prototype.getPendingLocalizations=function(){if(this.localizationPendingValue==null){return null}var t={};var e=this.getIdProperty();var i=this.getLangs();for(var r=0,n=i;r<n.length;r++){var a=n[r];var o=a[0];var l={};if(e!=null){l[e]=this.get_entityId()}var s=o+"$";for(var u=0,c=Object.keys(this.localizationPendingValue);u<c.length;u++){var d=c[u];if(Q.startsWith(d,s))l[d.substr(s.length)]=this.localizationPendingValue[d]}t[o]=l}return t};i.prototype.initPropertyGrid=function(){var e=this.byId("PropertyGrid");if(e.length<=0){return}var i=this.getPropertyGridOptions();this.propertyGrid=new t.PropertyGrid(e,i).init(null);if(this.element.closest(".ui-dialog").hasClass("s-Flexify")){this.propertyGrid.element.children(".categories").flexHeightOnly(1)}};i.prototype.initPropertyGridAsync=function(){var e=this;return Promise.resolve().then(function(){var i=e.byId("PropertyGrid");if(i.length<=0){return Promise.resolve()}return e.getPropertyGridOptionsAsync().then(function(r){e.propertyGrid=new t.PropertyGrid(i,r);if(e.element.closest(".ui-dialog").hasClass("s-Flexify"))e.propertyGrid.element.children(".categories").flexHeightOnly(1);return e.propertyGrid.init()})})};i.prototype.getPropertyItems=function(){var t=this.getFormKey();return Q.getForm(t)};i.prototype.getPropertyGridOptions=function(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,localTextPrefix:"Forms."+this.getFormKey()+".",useCategories:true}};i.prototype.getPropertyGridOptionsAsync=function(){var t=this;return this.getPropertyItemsAsync().then(function(e){return{idPrefix:t.idPrefix,items:e,mode:1,localTextPrefix:"Forms."+t.getFormKey()+".",useCategories:true}})};i.prototype.getPropertyItemsAsync=function(){var t=this;return Promise.resolve().then(function(){var e=t.getFormKey();return Q.getFormAsync(e)})};i.prototype.validateBeforeSave=function(){return true};i.prototype.getSaveOptions=function(t){var e=this;var i={};i.service=this.getService()+"/"+(this.isEditMode()?"Update":"Create"),i.onSuccess=function(r){e.onSaveSuccess(r);t&&t(r);var n=e.isEditMode()?"update":"create";var a=i.request==null?null:i.request.Entity;var o=e.isEditMode()?e.get_entityId():r==null?null:r.EntityId;var l={type:n,entity:a,entityId:o};e.element.triggerHandler("ondatachange",[l])};i.onCleanup=function(){e.validator&&Q.validatorAbortHandler(e.validator)};i.request=this.getSaveRequest();return i};i.prototype.getSaveEntity=function(){var t=new Object;if(this.propertyGrid!=null){this.propertyGrid.save(t)}if(this.isEditMode()){var e=this.getIdProperty();if(e!=null&&t[e]==null){t[e]=this.get_entityId()}}return t};i.prototype.getSaveRequest=function(){var t=this.getSaveEntity();var e={};e.Entity=t;if(this.isEditMode()){var i=this.getIdProperty();if(i!=null){e.EntityId=this.get_entityId()}}if(this.localizationPendingValue!=null){e.Localizations=this.getPendingLocalizations()}return e};i.prototype.onSaveSuccess=function(t){};i.prototype.save_submitHandler=function(t){var e=this.getSaveOptions(t);this.saveHandler(e,t)};i.prototype.save=function(e){var i=this;return t.ValidationHelper.submit(this.byId("Form"),function(){return i.validateBeforeSave()},function(){return i.save_submitHandler(e)})};i.prototype.saveHandler=function(t,e){Q.serviceCall(t)};i.prototype.initToolbar=function(){e.prototype.initToolbar.call(this);if(!this.toolbar)return;this.saveAndCloseButton=this.toolbar.findButton("save-and-close-button");this.applyChangesButton=this.toolbar.findButton("apply-changes-button");this.deleteButton=this.toolbar.findButton("delete-button");this.undeleteButton=this.toolbar.findButton("undo-delete-button");this.cloneButton=this.toolbar.findButton("clone-button");this.localizationButton=this.toolbar.findButton("localization-button")};i.prototype.showSaveSuccessMessage=function(t){Q.notifySuccess(Q.text("Controls.EntityDialog.SaveSuccessMessage"),"",null)};i.prototype.getToolbarButtons=function(){var e=this;var i=[];i.push({title:Q.text("Controls.EntityDialog.SaveButton"),cssClass:"save-and-close-button",hotkey:"alt+s",onClick:function(){e.save(function(t){e.dialogClose()})}});i.push({title:"",hint:Q.text("Controls.EntityDialog.ApplyChangesButton"),cssClass:"apply-changes-button",hotkey:"alt+a",onClick:function(){e.save(function(t){if(e.isEditMode()){var i=t.EntityId;if(i==null){i=e.get_entityId()}e.loadById(i)}else{e.loadById(t.EntityId)}e.showSaveSuccessMessage(t)})}});i.push({title:Q.text("Controls.EntityDialog.DeleteButton"),cssClass:"delete-button",hotkey:"alt+x",onClick:function(){Q.confirm(Q.text("Controls.EntityDialog.DeleteConfirmation"),function(){e.doDelete(function(){return e.dialogClose()})})}});i.push({title:Q.text("Controls.EntityDialog.UndeleteButton"),cssClass:"undo-delete-button",onClick:function(){if(e.isDeleted()){Q.confirm(Q.text("Controls.EntityDialog.UndeleteConfirmation"),function(){e.undelete(function(){return e.loadById(e.get_entityId())})})}}});i.push({title:Q.text("Controls.EntityDialog.LocalizationButton"),cssClass:"localization-button",onClick:function(){return e.localizationButtonClick()}});i.push({title:Q.text("Controls.EntityDialog.CloneButton"),cssClass:"clone-button",onClick:function(){if(!e.isEditMode()){return}var i=e.getCloningEntity();t.Widget.create({type:ss.getInstanceType(e),init:function(r){return t.SubDialogHelper.bubbleDataChange(t.SubDialogHelper.cascade(r,e.element),e,true).loadEntityAndOpenDialog(i,null)}})}});return i};i.prototype.getCloningEntity=function(){var t=new Object;t=$.extend(t,this.get_entity());var e=this.getIdProperty();if(!Q.isEmptyOrNull(e)){delete t[e]}var i=this.getIsActiveProperty();if(!Q.isEmptyOrNull(i)){delete t[i]}var r=this.getIsDeletedProperty();if(!Q.isEmptyOrNull(r)){delete t[r]}return t};i.prototype.updateInterface=function(){var e=this.isDeleted();var i=this.isLocalizationMode();if(this.tabs!=null){t.TabsExtensions.setDisabled(this.tabs,"Log",this.isNewOrDeleted())}if(this.propertyGrid!=null){this.propertyGrid.element.toggle(!i)}if(this.localizationGrid!=null){this.localizationGrid.element.toggle(i)}if(this.localizationButton!=null){this.localizationButton.toggle(this.localizationGrid!=null);this.localizationButton.find(".button-inner").text(this.isLocalizationMode()?Q.text("Controls.EntityDialog.LocalizationBack"):Q.text("Controls.EntityDialog.LocalizationButton"))}if(i){if(this.toolbar!=null)this.toolbar.findButton("tool-button").not(".localization-hidden").addClass(".localization-hidden").hide();this.localizationButton&&this.localizationButton.show();return}this.toolbar.findButton("localization-hidden").removeClass("localization-hidden").show();this.deleteButton&&this.deleteButton.toggle(this.isEditMode()&&!e);this.undeleteButton&&this.undeleteButton.toggle(this.isEditMode()&&e);if(this.saveAndCloseButton){this.saveAndCloseButton.toggle(!e);this.saveAndCloseButton.find(".button-inner").text(Q.text(this.isNew()?"Controls.EntityDialog.SaveButton":"Controls.EntityDialog.UpdateButton"))}this.applyChangesButton&&this.applyChangesButton.toggle(!e);this.cloneButton&&this.cloneButton.toggle(false)};i.prototype.getUndeleteOptions=function(t){return{}};i.prototype.undeleteHandler=function(t,e){Q.serviceCall(t)};i.prototype.undelete=function(t){var e=this;var i={};i.service=this.getService()+"/Undelete";var r={};r.EntityId=this.get_entityId();i.request=r;i.onSuccess=function(i){t&&t(i);e.element.triggerHandler("ondatachange",[{entityId:e.get_entityId(),entity:e.entity,type:"undelete"}])};var n=this.getUndeleteOptions(t);var a=$.extend(i,n);this.undeleteHandler(a,t)};i=__decorate([t.Decorators.registerClass("Serenity.EntityDialog",[t["IEditDialog"]])],i);return i}(t.TemplatedDialog);t.EntityDialog=i})(Serenity||(Serenity={}));var Serenity;(function(t){var e;(function(e){var i=function(e){__extends(i,e);function i(t){var i=e.call(this,t)||this;if(t.reportKey){i.loadReport(t.reportKey)}return i}i.prototype.createPropertyGrid=function(){if(this.propertyGrid){this.byId("PropertyGrid").html("").attr("class","");this.propertyGrid=null}this.propertyGrid=new t.PropertyGrid(this.byId("PropertyGrid"),{idPrefix:this.idPrefix,useCategories:true,items:this.propertyItems}).init(null)};i.prototype.loadReport=function(t){var e=this;Q.serviceCall({service:"Report/Retrieve",request:{ReportKey:t},onSuccess:function(i){e.reportKey=Q.coalesce(i.ReportKey,t);e.propertyItems=i.Properties||[];e.dialogTitle=i.Title;e.createPropertyGrid();var r=i.InitialSettings;if(r==null){r=new Object}e.propertyGrid.load(r);e.toolbar.findButton("print-preview-button").toggle(!i.IsDataOnlyReport);e.toolbar.findButton("export-pdf-button").toggle(!i.IsDataOnlyReport);e.toolbar.findButton("export-docx-button").toggle(!i.IsDataOnlyReport);e.dialogOpen(null)}})};i.prototype.executeReport=function(t,e){if(!this.validateForm()){return}var i=new Object;this.propertyGrid.save(i);Q.postToService({service:"Report/Execute",request:{ReportKey:this.reportKey,DesignId:"Default",ExportType:e,Parameters:i},target:t})};i.prototype.getToolbarButtons=function(){var t=this;var e=[];e.push({title:"Önizleme",cssClass:"print-preview-button",onClick:function(){t.executeReport("_blank",null)}});e.push({title:"PDF",cssClass:"export-pdf-button",onClick:function(){t.executeReport("","Pdf")}});e.push({title:"Excel",cssClass:"export-xlsx-button",onClick:function(){t.executeReport("","Xlsx")}});e.push({title:"Word",cssClass:"export-docx-button",onClick:function(){t.executeReport("","Docx")}});return e};i=__decorate([t.Decorators.registerClass("Serenity.Reporting.ReportDialog")],i);return i}(t.TemplatedDialog);e.ReportDialog=i;var r=function(e){__extends(r,e);function r(i){var r=e.call(this,i)||this;$(".report-link").click(function(t){return r.reportLinkClick(t)});$("div.line").click(function(t){return r.categoryClick(t)});var n=r;new t.QuickSearchInput($("#QuickSearchInput"),{onSearch:function(t,e,i){n.updateMatchFlags(e);i(true)}});return r}r.prototype.updateMatchFlags=function(t){var e=$("#ReportList").find("li").removeClass("non-match");t=Q.trimToNull(t);if(t==null){e.children("ul").hide();e.show().removeClass("expanded");return}var i=ss.netSplit(t,[44,32].map(function(t){return String.fromCharCode(t)}),null,1);for(var r=0;r<i.length;r++){i[r]=Q.trimToNull(Select2.util.stripDiacritics(i[r]).toUpperCase())}var n=e.filter(".report-item");n.each(function(t,e){var r=$(e);var n=Select2.util.stripDiacritics(Q.coalesce(r.text(),"").toUpperCase());for(var a=0;a<i.length;a++){var o=i[a];if(o!=null&&!(n.indexOf(o)!==-1)){r.addClass("non-match");break}}});var a=n.not(".non-match");var o=a.parents("li").add(a);var l=e.not(o);l.hide().addClass("non-match");o.show();if(o.length<=100){e.children("ul").show();e.addClass("expanded")}};r.prototype.categoryClick=function(t){var e=$(t.target).closest("li");if(e.hasClass("expanded")){e.find("ul").hide("fast");e.removeClass("expanded");e.find("li").removeClass("expanded")}else{e.addClass("expanded");e.children("ul").show("fast");if(e.children("ul").children("li").length===1&&!e.children("ul").children("li").hasClass("expanded")){e.children("ul").children("li").children(".line").click()}}};r.prototype.reportLinkClick=function(t){t.preventDefault();var e=new i({reportKey:$(t.target).data("key")})};r=__decorate([t.Decorators.registerClass("Serenity.Reporting.ReportPage")],r);return r}(t.Widget);e.ReportPage=r})(e=t.Reporting||(t.Reporting={}))})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(){var i=e.call(this)||this;new t.QuickSearchInput(i.byId("Search"),{onSearch:function(t,e,r){e=Q.trimToNull(e);if(e!=null)e=Select2.util.stripDiacritics(e.toLowerCase());i.element.find("li").each(function(t,i){$(i).toggle(!e||Select2.util.stripDiacritics($(i).text().toLowerCase()).indexOf(e)>=0)})}});i.ulVisible=i.byId("VisibleCols");i.ulHidden=i.byId("HiddenCols");return i}i.createToolButton=function(e){function i(){var i=new t.ColumnPickerDialog;i.allColumns=e.allColumns;if(e.initialSettings){var r=e.initialSettings;if(r.columns&&r.columns.length)i.defaultColumns=r.columns.map(function(t){return t.id})}i.visibleColumns=e.slickGrid.getColumns().map(function(t){return t.id});i.done=function(){e.allColumns=i.allColumns;var t=i.allColumns.filter(function(t){return t.visible===true});e.slickGrid.setColumns(t);e.persistSettings();e.refresh()};Q.Router.dialog(e.element,i.element,function(){return"columns"});i.dialogOpen()}e.element.on("handleroute."+e.uniqueName,function(t,e){if(e&&!e.handled&&e.route=="columns"){i()}});return{hint:Q.text("Controls.ColumnPickerDialog.Title"),cssClass:"column-picker-button",onClick:i}};i.prototype.getDialogOptions=function(){var t=this;var i=e.prototype.getDialogOptions.call(this);i.title=Q.text("Controls.ColumnPickerDialog.Title");i.width=600;i.buttons=[{text:Q.text("Controls.ColumnPickerDialog.RestoreDefaults"),click:function(){var e={};t.ulVisible.children().add(t.ulHidden.children()).each(function(t,i){var r=$(i);e[r.data("key")]=r});var i=null;for(var r=0,n=t.defaultColumns;r<n.length;r++){var a=n[r];var o=e[a];if(!o)continue;if(i==null)o.prependTo(t.ulVisible);else o.insertAfter(i);i=o;var l=o.data("key");delete e[l]}for(var l in e)e[l].appendTo(t.ulHidden);t.updateListStates()}},{text:Q.text("Dialogs.OkButton"),click:function(){var e=[];for(var i=0,r=t.allColumns;i<r.length;i++){var n=r[i];n.visible=false}t.visibleColumns=t.ulVisible.children().toArray().map(function(i){var r=$(i).data("key");var n=t.colById[r];n.visible=true;e.push(n);return r});for(var a=0,o=t.allColumns;a<o.length;a++){var n=o[a];if(!n.visible)e.push(n)}t.allColumns=e;t.done&&t.done();t.dialogClose()}},{text:Q.text("Dialogs.CancelButton"),click:function(){t.dialogClose()}}];return i};i.prototype.getTitle=function(t){if(t.id=="__select__")return"[x]";return t.name||t.toolTip||t.id};i.prototype.allowHide=function(t){return t.sourceItem==null||t.sourceItem.allowHide==null||t.sourceItem.allowHide};i.prototype.createLI=function(t){var e=this.allowHide(t);return $('\n<li data-key="'+t.id+'" class="'+(e?"":"cant-hide")+'">\n  <span class="drag-handle">☰</span>\n  '+Q.htmlEncode(this.getTitle(t))+"\n  "+(e?'<i class="js-hide" title="'+Q.text("Controls.ColumnPickerDialog.HideHint")+'">✖</i>':"")+'\n  <i class="js-show fa fa-eye" title="'+Q.text("Controls.ColumnPickerDialog.ShowHint")+'"></i>\n</li>')};i.prototype.updateListStates=function(){this.ulVisible.children().removeClass("bg-info").addClass("bg-success");this.ulHidden.children().removeClass("bg-success").addClass("bg-info")};i.prototype.setupColumns=function(){var t=this;this.allColumns=this.allColumns||[];this.visibleColumns=this.visibleColumns||[];var e={};for(var i=0,r=this.visibleColumns;i<r.length;i++){var n=r[i];e[n]=true}this.colById={};for(var a=0,o=this.allColumns;a<o.length;a++){var l=o[a];this.colById[l.id]=l
}if(this.defaultColumns==null)this.defaultColumns=this.visibleColumns.slice(0);var s=[];for(var u=0,c=this.allColumns;u<c.length;u++){var d=c[u];if(!e[d.id]&&(!d.sourceItem||d.sourceItem.filterOnly!==true&&(d.sourceItem.readPermission==null||Q.Authorization.hasPermission(d.sourceItem.readPermission)))){s.push(d)}}var f=s.sort(function(e,i){return Q.turkishLocaleCompare(t.getTitle(e),t.getTitle(i))});for(var p=0,h=this.visibleColumns;p<h.length;p++){var n=h[p];var g=this.colById[n];if(!g)continue;this.createLI(g).appendTo(this.ulVisible)}for(var v=0,y=f;v<y.length;v++){var m=y[v];this.createLI(m).appendTo(this.ulHidden)}this.updateListStates();if(typeof Sortable!=="undefined"&&Sortable.create){Sortable.create(this.ulVisible[0],{group:this.uniqueName+"_group",filter:".js-hide",onFilter:function(e){$(e.item).appendTo(t.ulHidden);t.updateListStates()},onMove:function(e){if($(e.dragged).hasClass("cant-hide")&&e.from==t.ulVisible[0]&&e.to!==e.from)return false;return true},onEnd:function(e){return t.updateListStates()}});Sortable.create(this.ulHidden[0],{group:this.uniqueName+"_group",sort:false,filter:".js-show",onFilter:function(e){$(e.item).appendTo(t.ulVisible);t.updateListStates()},onEnd:function(e){return t.updateListStates()}})}};i.prototype.onDialogOpen=function(){e.prototype.onDialogOpen.call(this);this.element.find("input").removeAttr("disabled");this.element.closest(".ui-dialog").children(".ui-dialog-buttonpane").find("button").eq(0).addClass("restore-defaults").next().focus();this.setupColumns();Q.centerDialog(this.element)};i.prototype.getTemplate=function(){return'\n<div class="search"><input id="~_Search" type="text" disabled /></div>\n<div class="columns-container">\n<div class="column-list visible-list bg-success">\n  <h5><i class="fa fa-eye"></i> '+Q.text("Controls.ColumnPickerDialog.VisibleColumns")+'</h5>\n  <ul id="~_VisibleCols"></ul>\n</div>\n<div class="column-list hidden-list bg-info">\n  <h5><i class="fa fa-list"></i> '+Q.text("Controls.ColumnPickerDialog.HiddenColumns")+'</h5>\n  <ul id="~_HiddenCols"></ul>\n</div>\n</div>'};i=__decorate([t.Decorators.registerClass(),t.Decorators.resizable(),t.Decorators.responsive()],i);return i}(t.TemplatedDialog);t.ColumnPickerDialog=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(){function e(i){this.options=i;var r=this.dataGrid=i.grid;var n=r.getIdProperty();var a=this.getId=function(t){return t[n]};r.element.find(".grid-container").on("click",function(e){if($(e.target).hasClass("s-TreeToggle")){var i=r.slickGrid.getCellFromEvent(e);if(i.cell>=0&&i.row>=0){t.SlickTreeHelper.toggleClick(e,i.row,i.row,r.view,a)}}});var o=r.onViewFilter;r.onViewFilter=function(e){if(!o.apply(this,[e]))return false;return t.SlickTreeHelper.filterById(e,r.view,i.getParentId)};var l=r.onViewProcessData;r.onViewProcessData=function(r){r=l.apply(this,[r]);r.Entities=e.applyTreeOrdering(r.Entities,a,i.getParentId);t.SlickTreeHelper.setIndents(r.Entities,a,i.getParentId,i.initialCollapse&&i.initialCollapse()||false);return r};if(i.toggleField){var s=Q.tryFirst(r["allColumns"]||r.slickGrid.getColumns()||[],function(t){return t.field==i.toggleField});if(s){s.format=t.SlickFormatting.treeToggle(function(){return r.view},a,s.format||function(t){return Q.htmlEncode(t.value)});s.formatter=t.SlickHelper.convertToFormatter(s.format)}}}e.prototype.toggleAll=function(){t.SlickTreeHelper.setCollapsed(this.dataGrid.view.getItems(),!this.dataGrid.view.getItems().every(function(t){return t._collapsed==true}));this.dataGrid.view.setItems(this.dataGrid.view.getItems(),true)};e.prototype.collapseAll=function(){t.SlickTreeHelper.setCollapsed(this.dataGrid.view.getItems(),true);this.dataGrid.view.setItems(this.dataGrid.view.getItems(),true)};e.prototype.expandAll=function(){t.SlickTreeHelper.setCollapsed(this.dataGrid.view.getItems(),false);this.dataGrid.view.setItems(this.dataGrid.view.getItems(),true)};e.applyTreeOrdering=function(t,e,i){var r=[];var n=Q.toGrouping(t,e);var a=Q.toGrouping(t,i);var o={};function l(t){if(o[t])return;o[t]=true;for(var i=0,n=a[t]||[];i<n.length;i++){var s=n[i];r.push(s);l(e(s))}}for(var s=0,u=t;s<u.length;s++){var c=u[s];var d=i(c);if(d==null||!(n[d]||[]).length){r.push(c);l(e(c))}}return r};return e}();t.TreeGridMixin=e})(Serenity||(Serenity={}));if($.fn.button&&$.fn.button.noConflict){var btn=$.fn.button.noConflict();$.fn.btn=btn}$.fn.flexHeightOnly=function(t){if(t===void 0){t=1}return this.flexWidthHeight(0,t)};$.fn.flexWidthOnly=function(t){if(t===void 0){t=1}return this.flexWidthHeight(t,0)};$.fn.flexWidthHeight=function(t,e){if(t===void 0){t=1}if(e===void 0){e=1}return this.addClass("flexify").data("flex-x",t).data("flex-y",e)};$.fn.flexX=function(t){return this.data("flex-x",t)};$.fn.flexY=function(t){return this.data("flex-y",t)};if($.fn.button&&$.fn.button.noConflict){var btn=$.fn.button.noConflict();$.fn.btn=btn}(function(t){t.widget("ui.slickPager",{options:{view:null,showRowsPerPage:true,rowsPerPageOptions:[20,100,500,2e3]},_create:function(){var e=this;var i=e.options;var r=i.view;if(!r)throw"SlickPager requires view option to be set!";this.element.addClass("s-SlickPager slick-pg").html('<div class="slick-pg-in">'+'<div class="slick-pg-grp">'+'<div class="slick-pg-first slick-pg-btn"><span class="slick-pg-btn-span"></span></div>'+'<div class="slick-pg-prev slick-pg-btn"><span class="slick-pg-btn-span"></span></div>'+'</div><div class="slick-pg-sep"></div><div class="slick-pg-grp">'+'<span class="slick-pg-control">&nbsp;'+Q.text("Controls.Pager.Page")+'&nbsp;<input class="slick-pg-current" type="text" size="4" value="1" /> / '+'<span class="slick-pg-total"> 1 </span></span>'+'</div><div class="slick-pg-sep"></div><div class="slick-pg-grp">'+'<div class="slick-pg-next slick-pg-btn"><span class="slick-pg-btn-span"></span></div>'+'<div class="slick-pg-last slick-pg-btn"><span class="slick-pg-btn-span"></span></div>'+'</div><div class="slick-pg-sep"></div><div class="slick-pg-grp">'+'<div class="slick-pg-reload slick-pg-btn"><span class="slick-pg-btn-span"></span></div>'+'</div><div class="slick-pg-sep"></div>'+'<div class="slick-pg-grp"><span class="slick-pg-stat"></span></div></div>');t(".slick-pg-reload",this.element).click(function(){r.populate()});t(".slick-pg-first",this.element).click(function(){e._changePage("first")});t(".slick-pg-prev",this.element).click(function(){e._changePage("prev")});t(".slick-pg-next",this.element).click(function(){e._changePage("next")});t(".slick-pg-last",this.element).click(function(){e._changePage("last")});t(".slick-pg-current",this.element).keydown(function(t){if(t.keyCode==13)e._changePage("input")});if(e.options.showRowsPerPage){var n,a="";for(var o=0;o<i.rowsPerPageOptions.length;o++){if(r.rowsPerPage==i.rowsPerPageOptions[o])a='selected="selected"';else a="";n+="<option value='"+i.rowsPerPageOptions[o]+"' "+a+" >"+i.rowsPerPageOptions[o]+"&nbsp;&nbsp;</option>"}t(".slick-pg-in",this.element).prepend('<div class="slick-pg-grp"><select class="slick-pg-size" name="rp">'+n+'</select></div><div class="slick-pg-sep"></div>');t("select.slick-pg-size",this.element).change(function(){if(i.onRowsPerPageChange)i.onRowsPerPageChange(+this.value);else{r.newp=1;r.setPagingOptions({page:1,rowsPerPage:+this.value})}})}r.onPagingInfoChanged.subscribe(function(){e._updatePager()})},destroy:function(){t.Widget.prototype.destroy.apply(this,arguments)},_changePage:function(e){var i=this.options.view;if(!i||i.loading)return true;var r=i.getPagingInfo();var n=!r.rowsPerPage||!r.totalCount?1:Math.ceil(r.totalCount/r.rowsPerPage);var a;switch(e){case"first":a=1;break;case"prev":if(r.page>1)a=parseInt(r.page)-1;break;case"next":if(r.page<n)a=parseInt(r.page)+1;break;case"last":a=n;break;case"input":var o=parseInt(t("input.slick-pg-current",this.element).val());if(isNaN(o))o=1;else if(o<1)o=1;else if(o>n)o=n;t(".slick-pg-current",this.element).val(o);a=o;break}if(a==r.page)return false;if(this.options.onChangePage)this.options.onChangePage(a);else{i.setPagingOptions({page:a})}},_updatePager:function(){var e=this.options.view;var i=e.getPagingInfo();var r=!i.rowsPerPage||!i.totalCount?1:Math.ceil(i.totalCount/i.rowsPerPage);t(".slick-pg-current",this.element).val(i.page);t(".slick-pg-total",this.element).html(r);var n=(i.page-1)*i.rowsPerPage+1;var a=n+i.rowsPerPage-1;if(i.totalCount<a)a=i.totalCount;var o;if(i.loading){o=Q.text("Controls.Pager.LoadingStatus")}else if(i.error){o=i.error}else if(i.totalCount>0){o=Q.text("Controls.Pager.PageStatus");o=o.replace(/{from}/,n);o=o.replace(/{to}/,a);o=o.replace(/{total}/,i.totalCount)}else o=Q.text("Controls.Pager.NoRowStatus");t(".slick-pg-stat",this.element).html(o);t(".slick-pg-size",this.element).val((i.rowsPerPage||0).toString())},_setOption:function(e,i){t.Widget.prototype._setOption.apply(this,arguments)}})})(jQuery);var Slick;(function(t){var e;(function(t){var e})(e=t.Data||(t.Data={}))})(Slick||(Slick={}));(function(t){var e=function(){function e(e){var i=this;var r={groupItemMetadataProvider:null,inlineFilters:false};var n;var a=[];var o=[];var l={};var s=null;var u=null;var c=null;var d=0;var f=true;var p;var h;var g={};var v={};var y;var m=[];var b;var C;var _=[];var x={getter:null,formatter:null,comparer:function(t,e){return t.value===e.value?0:t.value>e.value?1:-1},predefinedValues:[],aggregateEmpty:false,aggregateCollapsed:false,aggregateChildGroups:false,collapsed:false,displayTotalsRow:true,lazyTotalsCalculation:false};var S={};var w=[];var T=[];var I=[];var k=":|:";var F=1;var D=0;var E=new t.Event;var O=new t.Event;var P=new t.Event;var A=false;var N=null;var V=0;var R=0;var L;var B;var G=null;var z=new t.Event;var M=new t.Event;var q=new t.Event;var H=new t.Event;var W;function j(){d++}function U(){d--;if(d<=0)Ke()}function K(t){g=t}function Y(t){y=t}function J(t){t=t||0;var e;for(var i=t,r=a.length;i<r;i++){e=a[i][n];if(e===undefined){var o="Each data element must implement a unique '"+n+"' property. Object at index '"+i+"' "+"has no identity value: ";o+=$.toJSON(a[i]);throw o}l[e]=i}}function X(){var t;for(var e=0,i=a.length;e<i;e++){t=a[e][n];if(t===undefined||l[t]!==e){var r="Each data element must implement a unique '"+n+"' property. Object at index '"+e+"' ";if(t==undefined)r+="has no identity value: ";else r+="has repeated identity value '"+t+"': ";r+=$.toJSON(a[e]);throw r}}}function Z(){return a}function te(t){a=m=t;l={};s=null;S.totals={};J();X();if(d){Ue(a)}else{Ke()}z.notify({dataView:i},null,i)}function ee(t){var e=false;if(t.rowsPerPage!=undefined&&W.rowsPerPage!=t.rowsPerPage){W.rowsPerPage=t.rowsPerPage;e=true}if(t.page!=undefined){var i;if(!W.rowsPerPage)i=1;else if(G==null)i=t.page;else i=Math.min(t.page,Math.ceil(G/W.rowsPerPage)+1);if(i<1)i=1;if(i!=F){W.seekToPage=i;e=true}}if(e)Ze()}function ie(){return{rowsPerPage:W.rowsPerPage,page:F,totalCount:G,loading:A,error:N,dataView:i}}function re(t,e){f=e;h=t;p=null;if(e===false){a.reverse()}a.sort(t);if(e===false){a.reverse()}l={};J();Ke()}function ne(t,e){f=e;p=t;h=null;var i=Object.prototype.toString;Object.prototype.toString=typeof t==="function"?t:function(){return this[t]};if(e===false){a.reverse()}a.sort();Object.prototype.toString=i;if(e===false){a.reverse()}l={};J();Ke()}function ae(){if(h){re(h,f)}else if(p){ne(p,f)}}function oe(t){u=t;if(e.inlineFilters){b=ze();C=Me()}Ke()}function le(){return w}function se(t){t=t||{};S.aggregators=t.aggregators||[];S.compiledAccumulators=[];S.totals={};var e=S.aggregators.length;while(e--){S.compiledAccumulators[e]=Ge(S.aggregators[e])}ce(w||[])}function ue(){S.totals=S.totals||{};if(!S.totals.initialized){S.aggregators=S.aggregators||[];S.compiledAccumulators=S.compiledAccumulators||[];var t,e=S.aggregators.length;while(e--){t=S.aggregators[e];t.init();S.compiledAccumulators[e].call(t,a);t.storeResult(S.totals)}S.totals.initialized=true}return S.totals}function ce(i){if(!e.groupItemMetadataProvider){e.groupItemMetadataProvider=new t.Data.GroupItemMetadataProvider}T=[];I=[];i=i||[];w=i instanceof Array?i:[i];for(var r=0;r<w.length;r++){var n=w[r]=$.extend(true,{},x,w[r]);n.aggregators=n.aggregators||S.aggregators||[];n.getterIsAFn=typeof n.getter==="function";n.compiledAccumulators=[];var a=n.aggregators.length;while(a--){n.compiledAccumulators[a]=Ge(n.aggregators[a])}I[r]={}}Ke()}function de(t){return a[t]}function fe(t){return l[t]}function pe(){if(!s){s={};for(var t=0,e=o.length;t<e;t++){s[o[t][n]]=t}}}function he(t){pe();return s[t]}function ge(t){return a[l[t]]}function ve(t){var e=[];pe();for(var i=0,r=t.length;i<r;i++){var n=s[t[i]];if(n!=null){e[e.length]=n}}return e}function ye(t){var e=[];for(var i=0,r=t.length;i<r;i++){if(t[i]<o.length){e[e.length]=o[t[i]][n]}}return e}function me(t,e){if(l[t]===undefined||t!==e[n]){throw"Invalid or non-matching id"}a[l[t]]=e;if(!c){c={}}c[t]=true;Ke()}function be(t,e){a.splice(t,0,e);J(t);Ke()}function Ce(t){a.push(t);J(a.length-1);Ke()}function _e(t){var e=l[t];if(e===undefined){throw"Invalid id"}delete l[t];a.splice(e,1);J(e);Ke()}function xe(){return o}function Se(){return o.length}function we(t){var e=o[t];if(e&&e.__group&&e.totals&&!e.totals.initialized){var i=w[e.level];if(!i.displayTotalsRow){$e(e.totals);e.title=i.formatter?i.formatter(e):e.value}}else if(e&&e.__groupTotals&&!e.initialized){$e(e)}return e}function Te(t){var i=o[t];if(i===undefined){return null}if(i.__group){return e.groupItemMetadataProvider.getGroupRowMetadata(i)}if(i.__groupTotals){return e.groupItemMetadataProvider.getTotalsRowMetadata(i)}return e.getItemMetadata&&e.getItemMetadata(i,t)||null}function Ie(t,e){if(t==null){for(var i=0;i<w.length;i++){I[i]={};w[i].collapsed=e}}else{I[t]={};w[t].collapsed=e}Ke()}function ke(t){Ie(t,true)}function Fe(t){Ie(t,false)}function Qe(t){var e=t[0];if(t.length===1&&e.indexOf(k)!==-1){return{level:e.split(k).length-1,groupingKey:e}}else{return{level:t.length-1,groupingKey:t.join(k)}}}function De(t,e){var i=Qe(t);I[i.level][i.groupingKey]=w[i.level].collapsed^e;Ke()}function Ee(t){var e=Array.prototype.slice.call(arguments);De(e,true)}function Oe(t){var e=Array.prototype.slice.call(arguments);De(e,false)}function Pe(){return T}function Ae(e,i,r,n,a){var o=e[i];if(!o){o=new t.Group;o.value=i;o.level=r;o.groupingKey=(n?n.groupingKey+k:"")+i;a[a.length]=o;e[i]=o}return o}function Ne(t,e){var i;var r;var n=[];var a={};var o;var l=e?e.level+1:0;var s=w[l];for(var u=0,c=s.predefinedValues.length;u<c;u++){r=s.predefinedValues[u];i=Ae(a,r,l,e,n)}for(var u=0,c=t.length;u<c;u++){o=t[u];r=s.getterIsAFn?s.getter(o):o[s.getter];i=Ae(a,r,l,e,n);i.rows[i.count++]=o}if(l<w.length-1){for(var u=0;u<n.length;u++){i=n[u];i.groups=Ne(i.rows,i)}}n.sort(w[l].comparer);return n}function $e(t){var e=t.group;var i=w[e.level];var r=e.level==w.length;var n,a=i.aggregators.length;if(!r&&i.aggregateChildGroups){var o=e.groups.length;while(o--){if(!e.groups[o].totals.initialized){$e(e.groups[o].totals)}}}while(a--){n=i.aggregators[a];n.init();if(!r&&i.aggregateChildGroups){i.compiledAccumulators[a].call(n,e.groups)}else{i.compiledAccumulators[a].call(n,e.rows)}n.storeResult(t)}t.initialized=true}function Ve(e){var i=w[e.level];var r=new t.GroupTotals;r.group=e;e.totals=r;if(!i.lazyTotalsCalculation){$e(r)}}function Re(t,e){e=e||0;var i=w[e];var r=i.collapsed;var n=I[e];var a=t.length,o;while(a--){o=t[a];if(o.collapsed&&!i.aggregateCollapsed){continue}if(o.groups){Re(o.groups,e+1)}if(i.aggregators.length&&(i.aggregateEmpty||o.rows.length||o.groups&&o.groups.length)){Ve(o)}o.collapsed=r^n[o.groupingKey];o.title=i.formatter?i.formatter(o):o.value}}function Le(t,e){e=e||0;var i=w[e];var r=[],n,a=0,o;for(var l=0,s=t.length;l<s;l++){o=t[l];r[a++]=o;if(!o.collapsed){n=o.groups?Le(o.groups,e+1):o.rows;for(var u=0,c=n.length;u<c;u++){r[a++]=n[u]}}if(o.totals&&i.displayTotalsRow&&(!o.collapsed||i.aggregateCollapsed)){r[a++]=o.totals}}return r}function Be(t){var e=/^function[^(]*\(([^)]*)\)\s*{([\s\S]*)}$/;var i=t.toString().match(e);return{params:i[1].split(","),body:i[2]}}function Ge(t){var e=Be(t.accumulate);var i=new Function("_items","for (var "+e.params[0]+", _i=0, _il=_items.length; _i<_il; _i++) {"+e.params[0]+" = _items[_i]; "+e.body+"}");i.displayName=i.name="compiledAccumulatorLoop";return i}function ze(){var t=Be(u);var e=t.body.replace(/return false\s*([;}]|$)/gi,"{ continue _coreloop; }$1").replace(/return true\s*([;}]|$)/gi,"{ _retval[_idx++] = $item$; continue _coreloop; }$1").replace(/return ([^;}]+?)\s*([;}]|$)/gi,"{ if ($1) { _retval[_idx++] = $item$; }; continue _coreloop; }$2");var i=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","$filter$; ","} ","return _retval; "].join("");i=i.replace(/\$filter\$/gi,e);i=i.replace(/\$item\$/gi,t.params[0]);i=i.replace(/\$args\$/gi,t.params[1]);var r=new Function("_items,_args",i);r.displayName=r.name="compiledFilter";return r}function Me(){var t=Be(u);var e=t.body.replace(/return false\s*([;}]|$)/gi,"{ continue _coreloop; }$1").replace(/return true\s*([;}]|$)/gi,"{ _cache[_i] = true;_retval[_idx++] = $item$; continue _coreloop; }$1").replace(/return ([^;}]+?)\s*([;}]|$)/gi,"{ if ((_cache[_i] = $1)) { _retval[_idx++] = $item$; }; continue _coreloop; }$2");var i=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","if (_cache[_i]) { ","_retval[_idx++] = $item$; ","continue _coreloop; ","} ","$filter$; ","} ","return _retval; "].join("");i=i.replace(/\$filter\$/gi,e);i=i.replace(/\$item\$/gi,t.params[0]);i=i.replace(/\$args\$/gi,t.params[1]);var r=new Function("_items,_args,_cache",i);r.displayName=r.name="compiledFilterWithCaching";return r}function qe(t,e){var i=[],r=0;for(var n=0,a=t.length;n<a;n++){if(u(t[n],e)){i[r++]=t[n]}}return i}function He(t,e,i){var r=[],n=0,a;for(var o=0,l=t.length;o<l;o++){a=t[o];if(i[o]){r[n++]=a}else if(u(a,e)){r[n++]=a;i[o]=true}}return r}function We(t){if(u){var i=e.inlineFilters?b:qe;var r=e.inlineFilters?C:He;if(g.isFilterNarrowing){m=i(m,y)}else if(g.isFilterExpanding){m=r(t,y,_)}else if(!g.isFilterUnchanged){m=i(t,y)}}else{m=t.concat()}return{totalRows:m.length,rows:m}}function je(t,e){var i,r,a,o=[];var l=0,s=e.length;if(g&&g.ignoreDiffsBefore){l=Math.max(0,Math.min(e.length,g.ignoreDiffsBefore))}if(g&&g.ignoreDiffsAfter){s=Math.min(e.length,Math.max(0,g.ignoreDiffsAfter))}for(var u=l,d=t.length;u<s;u++){if(u>=d){o[o.length]=u}else{i=e[u];r=t[u];if(w.length&&(a=i.__nonDataRow||r.__nonDataRow)&&i.__group!==r.__group||i.__group&&!i.equals(r)||a&&(i.__groupTotals||r.__groupTotals)||i[n]!=r[n]||c&&c[i[n]]){o[o.length]=u}}}return o}function Ue(t){s=null;if(g.isFilterNarrowing!=v.isFilterNarrowing||g.isFilterExpanding!=v.isFilterExpanding){_=[]}var e=We(t);D=e.totalRows;var i=e.rows;S.totals={};T=[];if(w.length){T=Ne(i);if(T.length){Re(T);i=Le(T)}}var r=je(o,i);o=i;return r}function Ke(){if(d){return}var t=o.length;var e=D;var r=Ue(a);c=null;v=g;g={};if(e!==D){P.notify(ie(),null,i)}if(t!==o.length){E.notify({previous:t,current:o.length,dataView:i},null,i)}if(r.length>0){O.notify({rows:r,dataView:i},null,i)}}function Ye(e,i,r){var n=this;var a;var o=n.mapRowsToIds(e.getSelectedRows());var l=new t.Event;function s(i){if(o.join(",")==i.join(",")){return}o=i;l.notify({grid:e,ids:o,dataView:n},new t.EventData,n)}function u(){if(o.length>0){a=true;var t=n.mapIdsToRows(o);if(!i){s(n.mapRowsToIds(t))}e.setSelectedRows(t);a=false}}e.onSelectedRowsChanged.subscribe(function(t,i){if(a){return}var l=n.mapRowsToIds(e.getSelectedRows());if(!r||!e.getOptions().multiSelect){s(l)}else{var u=$.grep(o,function(t){return n.getRowById(t)===undefined});s(u.concat(l))}});this.onRowsChanged.subscribe(u);this.onRowCountChanged.subscribe(u);return l}function Je(t,e){var i;var r;a(t.getCellCssStyles(e));function a(t){i={};for(var e in t){var r=o[e][n];i[r]=t[e]}}function l(){if(i){r=true;pe();var n={};for(var a in i){var o=s[a];if(o!=undefined){n[o]=i[a]}}t.setCellCssStyles(e,n);r=false}}t.onCellCssStylesChanged.subscribe(function(t,i){if(r){return}if(e!=i.key){return}if(i.hash){a(i.hash)}});this.onRowsChanged.subscribe(l);this.onRowCountChanged.subscribe(l)}function Xe(t){if(W.onProcessData&&t)t=W.onProcessData(t,W)||t;N=null;A&&A.abort();A=false;if(!t){N=W.errormsg;P.notify(ie());return false}var e=t;t.TotalCount=t.TotalCount||0;t.Entities=t.Entities||[];if(!t.Skip||!W.rowsPerPage&&!t.Take)t.Page=1;else t.Page=Math.ceil(t.Skip/(t.Take||W.rowsPerPage))+1;F=t.Page;G=t.TotalCount;te(t.Entities);P.notify(ie())}function Ze(){if(V>0){R++;return}R=0;A&&A.abort();if(W.onSubmit){var t=W.onSubmit(W);if(t===false)return false}M.notify(this);if(!W.url)return false;if(!W.seekToPage)W.seekToPage=1;var e={};var i=(W.seekToPage-1)*W.rowsPerPage;if(i)e.Skip=i;if(W.rowsPerPage)e.Take=W.rowsPerPage;if(W.sortBy&&W.sortBy.length){if($.isArray(W.sortBy))e.Sort=W.sortBy;else{e.Sort=[W.sortBy]}}if(W.params){e=$.extend(e,W.params)}var r=B;var n=this;var a={cache:false,type:W.method,contentType:L,url:W.url,data:e,dataType:r,success:function(t){A=false;if(t.Error)Q.notifyError(t.Error.Message||t.Error.Code);else Xe(t);q.notify(this)},error:function(t,e,i){A=false;if((t.getResponseHeader("content-type")||"").toLowerCase().indexOf("application/json")>=0){var r=$.parseJSON(t.responseText);if(r!=null&&r.Error!=null){Q.notifyError(r.Error.Message||r.Error.Code);P.notify(ie());q.notify(this);return}}N=t.errormsg;P.notify(ie());q.notify(this)},complete:function(){A=false}};if(W.onAjaxCall){var o=W.onAjaxCall(this,a);if(o===false){A=false;P.notify(ie());return false}}a.data=$.toJSON(a.data);P.notify(ie());A=$.ajax(a)}function ti(){if(V==0)R=0;V++}function ei(){if(V>0){V--;if(V==0&&R>0)Ze()}}W={beginUpdate:j,endUpdate:U,setPagingOptions:ee,getPagingInfo:ie,getRows:xe,getItems:Z,setItems:te,setFilter:oe,sort:re,fastSort:ne,reSort:ae,setSummaryOptions:se,getGrandTotals:ue,setGrouping:ce,getGrouping:le,collapseAllGroups:ke,expandAllGroups:Fe,collapseGroup:Ee,expandGroup:Oe,getGroups:Pe,getIdxById:fe,getRowById:he,getItemById:ge,getItemByIdx:de,mapRowsToIds:ye,mapIdsToRows:ve,setRefreshHints:K,setFilterArgs:Y,refresh:Ke,updateItem:me,insertItem:be,addItem:Ce,deleteItem:_e,syncGridSelection:Ye,syncGridCellCssStyles:Je,getLength:Se,getItem:we,getItemMetadata:Te,onRowCountChanged:E,onRowsChanged:O,onPagingInfoChanged:P,addData:Xe,populate:Ze,populateLock:ti,populateUnlock:ei,onDataChanged:z,onDataLoaded:q,onDataLoading:M};n=e.idField||"id";L=e.contentType||"application/json";B=e.dataType||"json";u=e.filter||null;W.params=e.params||{};W.onSubmit=e.onSubmit||null;W.url=e.url||null;W.rowsPerPage=e.rowsPerPage||0;W.seekToPage=e.seekToPage||1;W.onAjaxCall=e.onAjaxCall||null;W.onProcessData=e.onProcessData||null;W.method=e.method||"POST";W.errormsg=W.errormsg||Q.text("Controls.Pager.DefaultLoadError");W.sortBy=e.sortBy||[];W.idField=n;if(e.url&&e.autoLoad){Ze()}return W}return e}();t.RemoteView=e})(Slick||(Slick={}));(function(t){var e;(function(t){function e(t){this.field_=t;this.init=function(){this.count_=0;this.nonNullCount_=0;this.sum_=0};this.accumulate=function(t){var e=t[this.field_];this.count_++;if(e!=null&&e!==""&&!isNaN(e)){this.nonNullCount_++;this.sum_+=parseFloat(e)}};this.storeResult=function(t){if(!t.avg){t.avg={}}if(this.nonNullCount_!=0){t.avg[this.field_]=this.sum_/this.nonNullCount_}}}t.Avg=e;function i(t,e){this.field_=t;this.weightedField_=e;this.init=function(){this.sum_=0;this.weightedSum_=0};this.accumulate=function(t){var e=t[this.field_];var i=t[this.weightedField_];if(this.isValid(e)&&this.isValid(i)){this.weightedSum_+=parseFloat(i);this.sum_+=parseFloat(e)*parseFloat(i)}};this.storeResult=function(t){if(!t.avg){t.avg={}}if(this.sum_&&this.weightedSum_){t.avg[this.field_]=this.sum_/this.weightedSum_}};this.isValid=function(t){return t!==null&&t!==""&&!isNaN(t)}}t.WeightedAvg=i;function r(t){this.field_=t;this.init=function(){this.min_=null};this.accumulate=function(t){var e=t[this.field_];if(e!=null&&e!==""&&!isNaN(e)){if(this.min_==null||e<this.min_){this.min_=e}}};this.storeResult=function(t){if(!t.min){t.min={}}t.min[this.field_]=this.min_}}t.Min=r;function n(t){this.field_=t;this.init=function(){this.max_=null};this.accumulate=function(t){var e=t[this.field_];if(e!=null&&e!==""&&!isNaN(e)){if(this.max_==null||e>this.max_){this.max_=e}}};this.storeResult=function(t){if(!t.max){t.max={}}t.max[this.field_]=this.max_}}t.Max=n;function a(t){this.field_=t;this.init=function(){this.sum_=null};this.accumulate=function(t){var e=t[this.field_];if(e!=null&&e!==""&&!isNaN(e)){this.sum_+=parseFloat(e)}};this.storeResult=function(t){if(!t.sum){t.sum={}}t.sum[this.field_]=this.sum_}}t.Sum=a})(e=t.Aggregators||(t.Aggregators={}))})(Slick||(Slick={}));var Q;(function(t){var e;function i(t,i){e.call(this,t,i);this.errorsFor(t).each(function(e,i){if($(t).hasClass("error"))$(i).removeClass("checked");$(i).attr("title",$(i).text())})}function r(){if($.validator.methods["customValidate"]==null){$.validator.addMethod("customValidate",function(t,e){var i=this.optional(e);if(e==null||!!i){return i}var r=$._data(e,"events");if(!r){return true}var n=r.customValidate;if(n==null||n.length===0){return true}var a=$(e);for(var o=0;!!(o<n.length);o++){var l=ss.safeCast(n[o].handler,Function);if(l){var s=l(a);if(s!=null){a.data("customValidationMessage",s);return false}}}return true},function(t,e){return $(e).data("customValidationMessage")})}}function n(){r();var n=$.validator;n=n.prototype;e=n.showLabel;n.showLabel=i;$.validator.addMethod("dateQ",function(e,i){var r=this.optional(i);if(r)return r;var n=t.parseDate(e);if(!n)return false;var a=new Date(n);a.setHours(0,0,0,0);return a.getTime()===n.getTime()});$.validator.addMethod("hourAndMin",function(e,i){return this.optional(i)||!isNaN(t.parseHourAndMin(e))});$.validator.addMethod("dayHourAndMin",function(e,i){return this.optional(i)||!isNaN(t.parseDayHourAndMin(e))});$.validator.addMethod("decimalQ",function(e,i){return this.optional(i)||!isNaN(t.parseDecimal(e))});$.validator.addMethod("integerQ",function(e,i){return this.optional(i)||!isNaN(t.parseInteger(e))});var a=$.validator.methods["email"];$.validator.addMethod("email",function(e,i){if(!t.Config.emailAllowOnlyAscii)return a.call(this,e,i);return this.optional(i)||/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e)});$.validator.addMethod("emailMultiple",function(t,e){var i=this.optional(e);if(i)return i;if(t.indexOf(";")>=0)t=t.split(";");else t=t.split(",");for(var r=0;r<t.length;r++){i=$.validator.methods["email"].call(this,t[r],e);if(!i)return i}return i});$.validator.addMethod("anyvalue",function(t,e){return true});var o=$.validator.defaults;o.ignoreTitle=true;o.onchange=function(t){this.element(t)};n.oldinit=n.init;n.init=function(){n.oldinit.call(this);function t(t){if(this.form==null)return;var e=$.data(this.form,"validator"),i="on"+t.type.replace(/^validate/,"");e&&e.settings[i]&&e.settings[i].call(e,this)}function e(e){var i=this[0];if(!$.data(i,"changebound")){$(i).change(t);$.data(i,"changebound",true)}}$(this.currentForm).on(":text, :password, :file, select, textarea","focusin.validate",e)};n.oldfocusInvalid=n.focusInvalid;n.focusInvalid=function(){if(this.settings.abortHandler)this.settings.abortHandler(this);this.oldfocusInvalid.call(this)};n.oldstopRequest=n.focusInvalid;n.stopRequest=function(t,e){var i=this.formSubmitted;this.oldfocusInvalid.call(this,[t,e]);if(!e&&this.pendingRequest==0&&i&&this.settings.abortHandler){this.settings.abortHandler(this)}};n.resetAll=function(){this.submitted={};this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass)};jQuery(function(){$.extend($.validator.messages,{email:t.text("Validation.Email"),required:t.text("Validation.Required"),minlength:t.text("Validation.MinLength"),maxlength:t.text("Validation.MaxLength"),digits:t.text("Validation.Digits"),range:t.text("Validation.Range"),xss:t.text("Validation.Xss"),dateQ:t.text("Validation.DateInvalid"),decimalQ:t.text("Validation.Decimal"),integerQ:t.text("Validation.Integer"),url:t.text("Validation.Url")})})}function a(t){t.settings.abortHandler=null;t.settings.submitHandler=function(){return false}}t.validatorAbortHandler=a;function o(e){return $.extend({ignore:":hidden",meta:"v",errorClass:"error",errorPlacement:function(t,e){var i=null;var r=e.attr("data-vx-id");if(r){i=$("#"+r);if(!i.length)i=null;else i=i[0]}if(i==null){i=e.parents("div.field");if(i.length){var n=$("div.vx",i[0]);if(n.length)i=n[0]}else i=e.parent()}t.appendTo(i)},submitHandler:function(){return false},invalidHandler:function(e,i){t.notifyError(t.text("Validation.InvalidFormMessage"));$(i.errorList.map(function(t){return t.element})).closest(".category.collapsed").children(".category-title").each(function(t,e){$(e).click();return true});if(i.errorList.length){var r=i.errorList[0].element;if(r){var n=$(r).closest(".tab-pane");if(!n.hasClass("active")&&n.parent().hasClass("tab-content")){var a=n.attr("id");if(a){$('a[href="#'+a+'"]').click()}}if($.fn.tooltip){$.fn.tooltip&&$(r).tooltip({title:i.errorList[0].message,trigger:"manual"}).tooltip("show");window.setTimeout(function(){$(r).tooltip("destroy")},1500)}}}},success:function(t){t.addClass("checked")}},e)}t.validateOptions=o;if(window["jQuery"]&&window["jQuery"]["validator"])n();else if(window["jQuery"]){jQuery(function(t){if(t.validator)n()})}function l(){var e=t.Culture.dateOrder;var i=t.Culture.dateSeparator;var r=($("html").attr("lang")||"en").toLowerCase();if(!$.datepicker.regional[r]){r=r.split("-")[0];if(!$.datepicker.regional[r]){r="en"}}$.datepicker.setDefaults($.datepicker.regional["en"]);$.datepicker.setDefaults($.datepicker.regional[r]);$.datepicker.setDefaults({dateFormat:e=="mdy"?"mm"+i+"dd"+i+"yy":e=="ymd"?"yy"+i+"mm"+i+"dd":"dd"+i+"mm"+i+"yy",buttonImage:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuNvyMY98AAAHNSURBVEhLtZU/S8NAGIf7FfpJHDoX136ADp3s4qDgUpeCDlJEEIcubk7ZFJ06OBRcdJAOdhCx6CAWodJFrP8KFexrnhcv3sVLVYyBp/fLXe75hbSkGRFxaLVaEgSBMMbXkpi0Rz8eVlbkrlhUdnM56XQ6Opq57/DtwRkVMCFMhJzn89JoNHQ0c9/h26NOU3BdKMh4eVneFhflcGpK1rNZHTn/CfE9uHA6BSyMFhZkODsrt2E7I+c/Ib4Hl1NwOT0dXcgx2N6Wh+FQx16vp/O/ARdO3FrAs2PhcWZGm3l+9sj8b8Cl34ddwMKgVEoFXE5BUK9zkurx4fwseBuPUyWxYKfZTCQIf+txtvb2HLwFm7WaTg5fX1V0cnWlxPPR2ZmC2GSkB+22QsaBC6dTwMLzaPTnAhy4vhSwcP/yEl1s2D8+ngjFNjhwJRZwt9wB2Jm79WVuws4TC3qDgUrJYGekvozUzjjITsFGtarNpsBw2u0654ghnhEbcODCmVjAewjsjMyXkdo5seDm6Uku+n2VcgHYGakvI7UzDlxOwWql4hT4QOoDqY0pwBkVLM3NRQVpgAtnVFApl3UyTXBGBWvhX9x8+JpNE5xRwf8hmXe+7B9dZrOuOwAAAABJRU5ErkJggg==",buttonImageOnly:true,showOn:"both",showButtonPanel:true,changeMonth:true,changeYear:true})}if(window["jQuery"]&&window["jQuery"]["datepicker"]&&window["jQuery"]["datepicker"]["regional"]&&window["jQuery"]["datepicker"]["regional"]["en"]){l()}else{jQuery(function(t){if(t.datepicker)l()})}function s(){$.ui.dialog.prototype._allowInteraction=function(t){if($(t.target).closest(".ui-dialog").length){return true}return!!$(t.target).closest(".ui-datepicker, .select2-drop, .cke, .cke_dialog, #support-modal").length};(function(t){$.ui.dialog.prototype._focusTabbable=function(){if($(document.body).hasClass("mobile-device")){this.uiDialog&&this.uiDialog.focus();return}t.call(this)}})($.ui.dialog.prototype._focusTabbable);(function(t){$.ui.dialog.prototype._createTitlebar=function(){t.call(this);this.uiDialogTitlebar.find(".ui-dialog-titlebar-close").html('<i class="fa fa-times" />')}})($.ui.dialog.prototype._createTitlebar)}if(jQuery.ui){s()}else{jQuery(function(){if(jQuery.ui)s()})}jQuery.cleanData=function(t){return function(e){var i,r,n,a;var o=e;for(n=0;(r=o[n])!=null;n++){try{i=$._data(r,"events");if(i&&i.remove){if(o===e)o=Array.prototype.slice.call(e);$(r).triggerHandler("remove");delete i.remove}}catch(a){}}t(e)}}(jQuery.cleanData);function u(){ss.Exception.prototype.toString=function(){return this.get_message()
}}if(ss&&ss.Exception)u();else{jQuery(function(t){if(ss&&ss.Exception)u()})}function c(){Vue.component("editor",{props:{type:{type:String,required:true},id:{type:String,required:false},name:{type:String,required:false},placeholder:{type:String,required:false},value:{required:false},options:{required:false},maxLength:{required:false}},render:function(t){var e=Serenity.EditorTypeRegistry.get(this.type);var i=ss.getAttributes(e,Serenity.ElementAttribute,true);var r=i.length>0?i[0].value:"<input/>";var n={};var a=$(r)[0];var o=a.attributes;for(var l=0;l<o.length;l++){var s=o.item(l);n[s.name]=s.value}if(this.id!=null)n.id=this.id;if(this.name!=null)n.name=this.name;if(this.placeholder!=null)n.placeholder=this.placeholder;var u=this.options;var c=null;var d=this;var f=t(a.tagName,{domProps:n});this.$editorType=e;return f},watch:{value:function(t){Serenity.EditorUtils.setValue(this.$widget,t)}},mounted:function(){var t=this;this.$widget=new this.$editorType($(this.$el),this.options);this.$widget.initialize();if(this.maxLength){Serenity.PropertyGrid.$setMaxLength(this.$widget,this.maxLength)}if(this.options)Serenity.ReflectionOptionsSetter.set(this.$widget,this.options);if(this.value!=null)Serenity.EditorUtils.setValue(this.$widget,this.value);if($(this.$el).data("select2"))Serenity.WX.changeSelect2(this.$widget,function(){t.$emit("input",Serenity.EditorUtils.getValue(t.$widget))});else Serenity.WX.change(this.$widget,function(){t.$emit("input",Serenity.EditorUtils.getValue(t.$widget))})},destroyed:function(){if(this.$widget){this.$widget.destroy();this.$widget=null}}})}window["Vue"]?c():$(function(){window["Vue"]&&c()})})(Q||(Q={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(t,i){return e.call(this,t,i)||this}i.prototype.getLookupKey=function(){return Q.coalesce(this.options.lookupKey,e.prototype.getLookupKey.call(this))};i=__decorate([t.Decorators.registerEditor("Serenity.AsyncLookupEditor",[t.ISetEditValue,t.IGetEditValue,t.IStringValue,t.IReadOnly,t.IAsyncInit])],i);return i}(t.LookupEditorBase);t.AsyncLookupEditor=e})(Serenity||(Serenity={}));(function(t){var e=function(){function e(t,e,i){var r=this;this.parentType=t;this.widget=e;this.parentChange=i;this.bind();this.widget.element.bind("remove."+e.uniqueName+"cwh",function(t){r.unbind();r.widget=null;r.parentChange=null})}e.prototype.bind=function(){var t=this;if(Q.isEmptyOrNull(this._parentID)){return null}var e=Q.findElementWithRelativeId(this.widget.element,this._parentID).tryGetWidget(this.parentType);if(e!=null){e.element.bind("change."+this.widget.uniqueName,function(){t.parentChange(e)});return e}else{Q.notifyError("Can't find cascaded parent element with ID: "+this._parentID+"!","",null);return null}};e.prototype.unbind=function(){if(Q.isEmptyOrNull(this._parentID)){return null}var t=Q.findElementWithRelativeId(this.widget.element,this._parentID).tryGetWidget(this.parentType);if(t!=null){t.element.unbind("."+this.widget.uniqueName)}return t};e.prototype.get_parentID=function(){return this._parentID};e.prototype.set_parentID=function(t){if(this._parentID!==t){this.unbind();this._parentID=t;this.bind()}};e=__decorate([t.Decorators.registerClass("Serenity.CascadedWidgetLink")],e);return e}();t.CascadedWidgetLink=e})(Serenity||(Serenity={}));(function(t){var e;(function(e){function i(e){var i=new t.Flexify(e.closest(".ui-dialog"),{});return e}e.dialogFlexify=i;function r(t,e,i,r,n){var a=t.dialog();a.dialog("option","resizable",true);if(r!=null){a.dialog("option","minWidth",r)}if(e!=null){a.dialog("option","width",e)}if(n!=null){a.dialog("option","minHeight",n)}if(i!=null){a.dialog("option","height",i)}return t}e.dialogResizable=r;function n(t){t.dialogExtend({closable:true,maximizable:true,dblclick:"maximize",icons:{maximize:"ui-icon-maximize-window"}});return t}e.dialogMaximizable=n;function a(t){t.bind("keydown",function(t){if(t.which!==13){return}var e=t.target.tagName.toLowerCase();if(e==="button"||e==="select"||e==="textarea"||e==="input"&&t.target.getAttribute("type")==="button"){return}var i=$(this);if(!i.hasClass("ui-dialog")){i=i.closest(".ui-dialog")}var r=i.children(".ui-dialog-buttonpane").find("button");if(r.length>0){var n=r.find(".default-button");if(n.length>0){r=n}}var a=r.eq(0);if(!a.is(":disabled")){t.preventDefault();a.trigger("click")}});return t}e.dialogCloseOnEnter=a})(e=t.DialogExtensions||(t.DialogExtensions={}))})(Serenity||(Serenity={}));(function(t){var e;(function(e){function i(e){var i=ss.getType(e);if(i!=null&&ss.isAssignableFrom(t.IDialog,i)){return i}for(var r=0,n=Q.Config.rootNamespaces;r<n.length;r++){var a=n[r];i=ss.getType(a+"."+e);if(i!=null&&ss.isAssignableFrom(t.IDialog,i)){return i}}return null}var r={};function n(t){if(r[t]==null){var e=t;var n=i(e);if(n==null&&!Q.endsWith(t,"Dialog")){e=t+"Dialog";n=i(e)}if(n==null){return null}r[t]=n;return n}return r[t]}e.tryGet=n;function a(t){var e=n(t);if(e==null){var i=t+" dialog class is not found! Make sure there is a dialog class with this name, "+"it is under your project root namespace, and your namespace parts start with capital letters, "+"e.g. MyProject.Pascal.Cased namespace. If you got this error from an editor with InplaceAdd option "+"check that lookup key and dialog type name matches (case sensitive, excluding Dialog suffix). "+"You need to change lookup key or specify DialogType property in LookupEditor attribute if that's not the case.";Q.notifyError(i,"",null);throw new ss.Exception(i)}return e}e.get=a})(e=t.DialogTypeRegistry||(t.DialogTypeRegistry={}))})(Serenity||(Serenity={}));